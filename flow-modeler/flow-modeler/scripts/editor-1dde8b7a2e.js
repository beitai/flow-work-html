function Svg(){}function PathParser(){this._lexer=new PathLexer,this._handler=null}function PathLexer(e){null==e&&(e=""),this.setPathData(e)}function PathToken(e,t){arguments.length>0&&this.init(e,t)}function assert(e,t){if(!e)throw t}function DMCommand(e,t){this.action=e,this.triple=t,this.toString=function(){return"Command("+e+", "+t+")"}}function DMCommandHandler(e){this.__setNext=function(t){var i=this.__next;return this.__next=e,!i||i},this.__setNext(e),this.__invokeNext=function(e){return!!this.__next&&this.__next.handle(e)},this.handle=function(e){return!!this.process(e)||this.__invokeNext(e)},this.process=function(e){return!1}}function MetaTagHandler(next){DMCommandHandler.apply(this,[next]),this.process=function(command){with(command.triple)if(!(subject instanceof ERDF.Resource&&subject.isCurrentDocument()&&object instanceof ERDF.Literal))return!1}}function printf(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=e.replace("%"+(t-1),arguments[t]);return e}function _evenMoreEvilHack(e,t){if(window.ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.loadXML(e),i}if(window.XMLHttpRequest){var n=new XMLHttpRequest;return n.open("GET","data:"+(t||"application/xml")+";charset=utf-8,"+encodeURIComponent(e),!1),n.overrideMimeType&&n.overrideMimeType(t),n.send(null),n.responseXML}}function _evilSafariHack(e){var t=e,i="data:text/xml;charset=utf-8,"+encodeURIComponent(t),n=null,s=new XMLHttpRequest;return s.open("GET",i),s.onload=function(){n=s.responseXML},s.send(null),n}function init(){if(ORYX.Log.debug("Querying editor instances"),ORYX.Editor.setMissingClasses(),window.onOryxResourcesLoaded)window.onOryxResourcesLoaded();else{var e=window.location.search.substring(4),t="./service/model/"+e+"/json";ORYX.Editor.createByUrl(t)}}if(Svg.VERSION=1,Svg.NAMESPACE="http://www.w3.org/2000/svg",PathParser.PARAMCOUNT={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},PathParser.METHODNAME={A:"arcAbs",a:"arcRel",C:"curvetoCubicAbs",c:"curvetoCubicRel",H:"linetoHorizontalAbs",h:"linetoHorizontalRel",L:"linetoAbs",l:"linetoRel",M:"movetoAbs",m:"movetoRel",Q:"curvetoQuadraticAbs",q:"curvetoQuadraticRel",S:"curvetoCubicSmoothAbs",s:"curvetoCubicSmoothRel",T:"curvetoQuadraticSmoothAbs",t:"curvetoQuadraticSmoothRel",V:"linetoVerticalAbs",v:"linetoVerticalRel",Z:"closePath",z:"closePath"},PathParser.prototype.parsePath=function(e){if(null==e||e.namespaceURI!=Svg.NAMESPACE||"path"!=e.localName)throw new Error("PathParser.parsePath: The first parameter must be an SVG path element");this.parseData(e.getAttributeNS(null,"d"))},PathParser.prototype.parseData=function(e){if("string"!=typeof e)throw new Error("PathParser.parseData: The first parameter must be a string");null!=this._handler&&null!=this._handler.beginParse&&this._handler.beginParse();var t=this._lexer;t.setPathData(e);for(var i="BOP",n=t.getNextToken();!n.typeis(PathToken.EOD);){var s,o=new Array;switch(n.type){case PathToken.COMMAND:if("BOP"==i&&"M"!=n.text&&"m"!=n.text)throw new Error("PathParser.parseData: a path must begin with a moveto command");i=n.text,s=PathParser.PARAMCOUNT[n.text.toUpperCase()],n=t.getNextToken();break;case PathToken.NUMBER:break;default:throw new Error("PathParser.parseData: unrecognized token type: "+n.type)}for(var a=0;a<s;a++){switch(n.type){case PathToken.COMMAND:throw new Error("PathParser.parseData: parameter must be a number: "+n.text);case PathToken.NUMBER:o[a]=n.text-0;break;default:throw new Errot("PathParser.parseData: unrecognized token type: "+n.type)}n=t.getNextToken()}if(null!=this._handler){var r=this._handler,h=PathParser.METHODNAME[i];null!=r[h]&&r[h].apply(r,o)}"M"==i&&(i="L"),"m"==i&&(i="l")}},PathParser.prototype.setHandler=function(e){this._handler=e},PathLexer.VERSION=1,PathLexer.prototype.setPathData=function(e){if("string"!=typeof e)throw new Error("PathLexer.setPathData: The first parameter must be a string");this._pathData=e},PathLexer.prototype.getNextToken=function(){for(var e=null,t=this._pathData;null==e;)if(null==t||""==t)e=new PathToken(PathToken.EOD,"");else if(t.match(/^([ \t\r\n,]+)/))t=t.substr(RegExp.$1.length);else if(t.match(/^([AaCcHhLlMmQqSsTtVvZz])/))e=new PathToken(PathToken.COMMAND,RegExp.$1),t=t.substr(RegExp.$1.length);else{if(!t.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))throw new Error("PathLexer.getNextToken: unrecognized path data "+t);e=new PathToken(PathToken.NUMBER,parseFloat(RegExp.$1)),t=t.substr(RegExp.$1.length)}return this._pathData=t,e},PathToken.UNDEFINED=0,PathToken.COMMAND=1,PathToken.NUMBER=2,PathToken.EOD=3,PathToken.prototype.init=function(e,t){this.type=e,this.text=t},PathToken.prototype.typeis=function(e){return this.type==e},!ORYX)var ORYX={};if(ORYX.I18N||(ORYX.I18N={}),ORYX.I18N.Language="en_us",ORYX.I18N.Oryx||(ORYX.I18N.Oryx={}),ORYX.I18N.Oryx.title="Oryx",ORYX.I18N.Oryx.noBackendDefined="Caution! \nNo Backend defined.\n The requested model cannot be loaded. Try to load a configuration with a save plugin.",ORYX.I18N.Oryx.pleaseWait="Please wait while loading...",ORYX.I18N.Oryx.notLoggedOn="Not logged on",ORYX.I18N.Oryx.editorOpenTimeout="The editor does not seem to be started yet. Please check, whether you have a popup blocker enabled and disable it or allow popups for this site. We will never display any commercials on this site.",ORYX.I18N.AddDocker||(ORYX.I18N.AddDocker={}),ORYX.I18N.AddDocker.group="Docker",ORYX.I18N.AddDocker.add="Add Docker",ORYX.I18N.AddDocker.addDesc="Add a Docker to an edge, by clicking on it",ORYX.I18N.AddDocker.del="Delete Docker",ORYX.I18N.AddDocker.delDesc="Delete a Docker",ORYX.I18N.Arrangement||(ORYX.I18N.Arrangement={}),ORYX.I18N.Arrangement.groupZ="Z-Order",ORYX.I18N.Arrangement.btf="Bring To Front",ORYX.I18N.Arrangement.btfDesc="Bring to Front",ORYX.I18N.Arrangement.btb="Bring To Back",ORYX.I18N.Arrangement.btbDesc="Bring To Back",ORYX.I18N.Arrangement.bf="Bring Forward",ORYX.I18N.Arrangement.bfDesc="Bring Forward",ORYX.I18N.Arrangement.bb="Bring Backward",ORYX.I18N.Arrangement.bbDesc="Bring Backward",ORYX.I18N.Arrangement.groupA="Alignment",ORYX.I18N.Arrangement.ab="Alignment Bottom",ORYX.I18N.Arrangement.abDesc="Bottom",ORYX.I18N.Arrangement.am="Alignment Middle",ORYX.I18N.Arrangement.amDesc="Middle",ORYX.I18N.Arrangement.at="Alignment Top",ORYX.I18N.Arrangement.atDesc="Top",ORYX.I18N.Arrangement.al="Alignment Left",ORYX.I18N.Arrangement.alDesc="Left",ORYX.I18N.Arrangement.ac="Alignment Center",ORYX.I18N.Arrangement.acDesc="Center",ORYX.I18N.Arrangement.ar="Alignment Right",ORYX.I18N.Arrangement.arDesc="Right",ORYX.I18N.Arrangement.as="Alignment Same Size",ORYX.I18N.Arrangement.asDesc="Same Size",ORYX.I18N.Edit||(ORYX.I18N.Edit={}),ORYX.I18N.Edit.group="Edit",ORYX.I18N.Edit.cut="Cut",ORYX.I18N.Edit.cutDesc="Cuts the selection into an Oryx clipboard",ORYX.I18N.Edit.copy="Copy",ORYX.I18N.Edit.copyDesc="Copies the selection into an Oryx clipboard",ORYX.I18N.Edit.paste="Paste",ORYX.I18N.Edit.pasteDesc="Pastes the Oryx clipboard to the canvas",ORYX.I18N.Edit.del="Delete",ORYX.I18N.Edit.delDesc="Deletes all selected shapes",ORYX.I18N.EPCSupport||(ORYX.I18N.EPCSupport={}),ORYX.I18N.EPCSupport.group="EPC",ORYX.I18N.EPCSupport.exp="Export EPC",ORYX.I18N.EPCSupport.expDesc="Export diagram to EPML",ORYX.I18N.EPCSupport.imp="Import EPC",ORYX.I18N.EPCSupport.impDesc="Import an EPML file",ORYX.I18N.EPCSupport.progressExp="Exporting model",ORYX.I18N.EPCSupport.selectFile="Select an EPML (.empl) file to import.",ORYX.I18N.EPCSupport.file="File",ORYX.I18N.EPCSupport.impPanel="Import EPML File",ORYX.I18N.EPCSupport.impBtn="Import",ORYX.I18N.EPCSupport.close="Close",ORYX.I18N.EPCSupport.error="Error",ORYX.I18N.EPCSupport.progressImp="Import...",ORYX.I18N.ERDFSupport||(ORYX.I18N.ERDFSupport={}),ORYX.I18N.ERDFSupport.exp="Export to ERDF",ORYX.I18N.ERDFSupport.expDesc="Export to ERDF",ORYX.I18N.ERDFSupport.imp="Import from ERDF",ORYX.I18N.ERDFSupport.impDesc="Import from ERDF",ORYX.I18N.ERDFSupport.impFailed="Request for import of ERDF failed.",ORYX.I18N.ERDFSupport.impFailed2="An error while importing occurs! <br/>Please check error message: <br/><br/>",ORYX.I18N.ERDFSupport.error="Error",ORYX.I18N.ERDFSupport.noCanvas="The xml document has no Oryx canvas node included!",ORYX.I18N.ERDFSupport.noSS="The Oryx canvas node has no stencil set definition included!",ORYX.I18N.ERDFSupport.wrongSS="The given stencil set does not fit to the current editor!",ORYX.I18N.ERDFSupport.selectFile="Select an ERDF (.xml) file or type in the ERDF to import it!",ORYX.I18N.ERDFSupport.file="File",ORYX.I18N.ERDFSupport.impERDF="Import ERDF",ORYX.I18N.ERDFSupport.impBtn="Import",ORYX.I18N.ERDFSupport.impProgress="Importing...",ORYX.I18N.ERDFSupport.close="Close",ORYX.I18N.ERDFSupport.deprTitle="Really export to eRDF?",ORYX.I18N.ERDFSupport.deprText="Exporting to eRDF is not recommended anymore because the support will be stopped in future versions of the Oryx editor. If possible, export the model to JSON. Do you want to export anyway?",ORYX.I18N.jPDLSupport||(ORYX.I18N.jPDLSupport={}),ORYX.I18N.jPDLSupport.group="ExecBPMN",ORYX.I18N.jPDLSupport.exp="Export to jPDL",ORYX.I18N.jPDLSupport.expDesc="Export to jPDL",ORYX.I18N.jPDLSupport.imp="Import from jPDL",ORYX.I18N.jPDLSupport.impDesc="Import jPDL File",ORYX.I18N.jPDLSupport.impFailedReq="Request for import of jPDL failed.",ORYX.I18N.jPDLSupport.impFailedJson="Transformation of jPDL failed.",ORYX.I18N.jPDLSupport.impFailedJsonAbort="Import aborted.",ORYX.I18N.jPDLSupport.loadSseQuestionTitle="jBPM stencil set extension needs to be loaded",ORYX.I18N.jPDLSupport.loadSseQuestionBody="In order to import jPDL, the stencil set extension has to be loaded. Do you want to proceed?",ORYX.I18N.jPDLSupport.expFailedReq="Request for export of model failed.",ORYX.I18N.jPDLSupport.expFailedXml="Export to jPDL failed. Exporter reported: ",ORYX.I18N.jPDLSupport.error="Error",ORYX.I18N.jPDLSupport.selectFile="Select an jPDL (.xml) file or type in the jPDL to import it!",ORYX.I18N.jPDLSupport.file="File",ORYX.I18N.jPDLSupport.impJPDL="Import jPDL",ORYX.I18N.jPDLSupport.impBtn="Import",ORYX.I18N.jPDLSupport.impProgress="Importing...",ORYX.I18N.jPDLSupport.close="Close",ORYX.I18N.Save||(ORYX.I18N.Save={}),ORYX.I18N.Save.group="File",ORYX.I18N.Save.save="Save",ORYX.I18N.Save.saveDesc="Save",ORYX.I18N.Save.saveAs="Save As...",ORYX.I18N.Save.saveAsDesc="Save As...",ORYX.I18N.Save.unsavedData="There are unsaved data, please save before you leave, otherwise your changes get lost!",ORYX.I18N.Save.newProcess="New Process",ORYX.I18N.Save.saveAsTitle="Save as...",ORYX.I18N.Save.saveBtn="Save",ORYX.I18N.Save.close="Close",ORYX.I18N.Save.savedAs="Saved As",ORYX.I18N.Save.saved="Saved!",ORYX.I18N.Save.failed="Saving failed.",ORYX.I18N.Save.noRights="You have no rights to save changes.",ORYX.I18N.Save.saving="Saving",ORYX.I18N.Save.saveAsHint="The process diagram is stored under:",ORYX.I18N.File||(ORYX.I18N.File={}),ORYX.I18N.File.group="File",ORYX.I18N.File.print="Print",ORYX.I18N.File.printDesc="Print current model",ORYX.I18N.File.pdf="Export as PDF",ORYX.I18N.File.pdfDesc="Export as PDF",ORYX.I18N.File.info="Info",ORYX.I18N.File.infoDesc="Info",ORYX.I18N.File.genPDF="Generating PDF",ORYX.I18N.File.genPDFFailed="Generating PDF failed.",ORYX.I18N.File.printTitle="Print",ORYX.I18N.File.printMsg="We are currently experiencing problems with the printing function. We recommend using the PDF Export to print the diagram. Do you really want to continue printing?",ORYX.I18N.Grouping||(ORYX.I18N.Grouping={}),ORYX.I18N.Grouping.grouping="Grouping",ORYX.I18N.Grouping.group="Group",ORYX.I18N.Grouping.groupDesc="Groups all selected shapes",ORYX.I18N.Grouping.ungroup="Ungroup",ORYX.I18N.Grouping.ungroupDesc="Deletes the group of all selected Shapes",ORYX.I18N.Loading||(ORYX.I18N.Loading={}),ORYX.I18N.Loading.waiting="Please wait...",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.name="Name",ORYX.I18N.PropertyWindow.value="Value",ORYX.I18N.PropertyWindow.selected="selected",ORYX.I18N.PropertyWindow.clickIcon="Click Icon",ORYX.I18N.PropertyWindow.add="Add",ORYX.I18N.PropertyWindow.rem="Remove",ORYX.I18N.PropertyWindow.complex="Editor for a Complex Type",ORYX.I18N.PropertyWindow.text="Editor for a Text Type",ORYX.I18N.PropertyWindow.ok="Ok",ORYX.I18N.PropertyWindow.cancel="Cancel",ORYX.I18N.PropertyWindow.dateFormat="m/d/y",ORYX.I18N.ShapeMenuPlugin||(ORYX.I18N.ShapeMenuPlugin={}),ORYX.I18N.ShapeMenuPlugin.drag="Drag",ORYX.I18N.ShapeMenuPlugin.clickDrag="Click or drag",ORYX.I18N.ShapeMenuPlugin.morphMsg="Morph shape",ORYX.I18N.SyntaxChecker||(ORYX.I18N.SyntaxChecker={}),ORYX.I18N.SyntaxChecker.group="Verification",ORYX.I18N.SyntaxChecker.name="Syntax Checker",ORYX.I18N.SyntaxChecker.desc="Check Syntax",ORYX.I18N.SyntaxChecker.noErrors="There are no syntax errors.",ORYX.I18N.SyntaxChecker.invalid="Invalid answer from server.",ORYX.I18N.SyntaxChecker.checkingMessage="Checking ...",ORYX.I18N.FormHandler||(ORYX.I18N.FormHandler={}),ORYX.I18N.FormHandler.group="FormHandling",ORYX.I18N.FormHandler.name="FormHandler",ORYX.I18N.FormHandler.desc="Testing from handling",ORYX.I18N.Deployer||(ORYX.I18N.Deployer={}),ORYX.I18N.Deployer.group="Deployment",ORYX.I18N.Deployer.name="Deployer",ORYX.I18N.Deployer.desc="Deploy to engine",ORYX.I18N.Tester||(ORYX.I18N.Tester={}),ORYX.I18N.Tester.group="Testing",ORYX.I18N.Tester.name="Test process",ORYX.I18N.Tester.desc="Open the test component to test this process definition",ORYX.I18N.Undo||(ORYX.I18N.Undo={}),ORYX.I18N.Undo.group="Undo",ORYX.I18N.Undo.undo="Undo",ORYX.I18N.Undo.undoDesc="Undo the last action",ORYX.I18N.Undo.redo="Redo",ORYX.I18N.Undo.redoDesc="Redo the last undone action",ORYX.I18N.View||(ORYX.I18N.View={}),ORYX.I18N.View.group="Zoom",ORYX.I18N.View.zoomIn="Zoom In",ORYX.I18N.View.zoomInDesc="Zoom into the model",ORYX.I18N.View.zoomOut="Zoom Out",ORYX.I18N.View.zoomOutDesc="Zoom out of the model",ORYX.I18N.View.zoomStandard="Zoom Standard",ORYX.I18N.View.zoomStandardDesc="Zoom to the standard level",ORYX.I18N.View.zoomFitToModel="Zoom fit to model",ORYX.I18N.View.zoomFitToModelDesc="Zoom to fit the model size",ORYX.I18N.XFormsSerialization||(ORYX.I18N.XFormsSerialization={}),ORYX.I18N.XFormsSerialization.group="XForms Serialization",ORYX.I18N.XFormsSerialization.exportXForms="XForms Export",ORYX.I18N.XFormsSerialization.exportXFormsDesc="Export XForms+XHTML markup",ORYX.I18N.XFormsSerialization.importXForms="XForms Import",ORYX.I18N.XFormsSerialization.importXFormsDesc="Import XForms+XHTML markup",ORYX.I18N.XFormsSerialization.noClientXFormsSupport="No XForms support",ORYX.I18N.XFormsSerialization.noClientXFormsSupportDesc='<h2>Your browser does not support XForms. Please install the <a href="https://addons.mozilla.org/firefox/addon/824" target="_blank">Mozilla XForms Add-on</a> for Firefox.</h2>',ORYX.I18N.XFormsSerialization.ok="Ok",ORYX.I18N.XFormsSerialization.selectFile="Select a XHTML (.xhtml) file or type in the XForms+XHTML markup to import it!",ORYX.I18N.XFormsSerialization.selectCss="Please insert url of css file",ORYX.I18N.XFormsSerialization.file="File",ORYX.I18N.XFormsSerialization.impFailed="Request for import of document failed.",ORYX.I18N.XFormsSerialization.impTitle="Import XForms+XHTML document",ORYX.I18N.XFormsSerialization.expTitle="Export XForms+XHTML document",ORYX.I18N.XFormsSerialization.impButton="Import",ORYX.I18N.XFormsSerialization.impProgress="Importing...",ORYX.I18N.XFormsSerialization.close="Close",ORYX.I18N.PropertyWindow.title="Properties",ORYX.I18N.ShapeRepository||(ORYX.I18N.ShapeRepository={}),ORYX.I18N.ShapeRepository.title="Shape Repository",ORYX.I18N.Save.dialogDesciption="Please enter a name, a description and a comment.",ORYX.I18N.Save.dialogLabelTitle="Title",ORYX.I18N.Save.dialogLabelDesc="Description",ORYX.I18N.Save.dialogLabelType="Type",ORYX.I18N.Save.dialogLabelComment="Revision comment",ORYX.I18N.Perspective||(ORYX.I18N.Perspective={}),ORYX.I18N.Perspective.no="No Perspective",ORYX.I18N.Perspective.noTip="Unload the current perspective",ORYX.I18N.JSONSupport={imp:{name:"Import from JSON",desc:"Imports a model from JSON",group:"Export",selectFile:"Select an JSON (.json) file or type in JSON to import it!",file:"File",btnImp:"Import",btnClose:"Close",progress:"Importing ...",syntaxError:"Syntax error"},exp:{name:"Export to JSON",desc:"Exports current model to JSON",group:"Export"}},ORYX.I18N.JSONImport||(ORYX.I18N.JSONImport={}),ORYX.I18N.JSONImport.title="JSON Import",ORYX.I18N.JSONImport.wrongSS="The stencil set of the imported file ({0}) does not match to the loaded stencil set ({1}).",ORYX.I18N.RDFExport||(ORYX.I18N.RDFExport={}),ORYX.I18N.RDFExport.group="Export",ORYX.I18N.RDFExport.rdfExport="Export to RDF",ORYX.I18N.RDFExport.rdfExportDescription="Exports current model to the XML serialization defined for the Resource Description Framework (RDF)",ORYX.I18N.SyntaxChecker.BPMN||(ORYX.I18N.SyntaxChecker.BPMN={}),ORYX.I18N.SyntaxChecker.BPMN_NO_SOURCE="An edge must have a source.",ORYX.I18N.SyntaxChecker.BPMN_NO_TARGET="An edge must have a target.",ORYX.I18N.SyntaxChecker.BPMN_DIFFERENT_PROCESS="Source and target node must be contained in the same process.",ORYX.I18N.SyntaxChecker.BPMN_SAME_PROCESS="Source and target node must be contained in different pools.",ORYX.I18N.SyntaxChecker.BPMN_FLOWOBJECT_NOT_CONTAINED_IN_PROCESS="A flow object must be contained in a process.",ORYX.I18N.SyntaxChecker.BPMN_ENDEVENT_WITHOUT_INCOMING_CONTROL_FLOW="An end event must have an incoming sequence flow.",ORYX.I18N.SyntaxChecker.BPMN_STARTEVENT_WITHOUT_OUTGOING_CONTROL_FLOW="A start event must have an outgoing sequence flow.",ORYX.I18N.SyntaxChecker.BPMN_STARTEVENT_WITH_INCOMING_CONTROL_FLOW="Start events must not have incoming sequence flows.",ORYX.I18N.SyntaxChecker.BPMN_ATTACHEDINTERMEDIATEEVENT_WITH_INCOMING_CONTROL_FLOW="Attached intermediate events must not have incoming sequence flows.",ORYX.I18N.SyntaxChecker.BPMN_ATTACHEDINTERMEDIATEEVENT_WITHOUT_OUTGOING_CONTROL_FLOW="Attached intermediate events must have exactly one outgoing sequence flow.",ORYX.I18N.SyntaxChecker.BPMN_ENDEVENT_WITH_OUTGOING_CONTROL_FLOW="End events must not have outgoing sequence flows.",ORYX.I18N.SyntaxChecker.BPMN_EVENTBASEDGATEWAY_BADCONTINUATION="Event-based gateways must not be followed by gateways or subprocesses.",ORYX.I18N.SyntaxChecker.BPMN_NODE_NOT_ALLOWED="Node type is not allowed.",ORYX.I18N.SyntaxChecker.IBPMN||(ORYX.I18N.SyntaxChecker.IBPMN={}),ORYX.I18N.SyntaxChecker.IBPMN_NO_ROLE_SET="Interactions must have a sender and a receiver role set",ORYX.I18N.SyntaxChecker.IBPMN_NO_INCOMING_SEQFLOW="This node must have incoming sequence flow.",ORYX.I18N.SyntaxChecker.IBPMN_NO_OUTGOING_SEQFLOW="This node must have outgoing sequence flow.",ORYX.I18N.SyntaxChecker.InteractionNet||(ORYX.I18N.SyntaxChecker.InteractionNet={}),ORYX.I18N.SyntaxChecker.InteractionNet_SENDER_NOT_SET="Sender not set",ORYX.I18N.SyntaxChecker.InteractionNet_RECEIVER_NOT_SET="Receiver not set",ORYX.I18N.SyntaxChecker.InteractionNet_MESSAGETYPE_NOT_SET="Message type not set",ORYX.I18N.SyntaxChecker.InteractionNet_ROLE_NOT_SET="Role not set",ORYX.I18N.SyntaxChecker.EPC||(ORYX.I18N.SyntaxChecker.EPC={}),ORYX.I18N.SyntaxChecker.EPC_NO_SOURCE="Each edge must have a source.",ORYX.I18N.SyntaxChecker.EPC_NO_TARGET="Each edge must have a target.",ORYX.I18N.SyntaxChecker.EPC_NOT_CONNECTED="Node must be connected with edges.",ORYX.I18N.SyntaxChecker.EPC_NOT_CONNECTED_2="Node must be connected with more edges.",ORYX.I18N.SyntaxChecker.EPC_TOO_MANY_EDGES="Node has too many connected edges.",ORYX.I18N.SyntaxChecker.EPC_NO_CORRECT_CONNECTOR="Node is no correct connector.",ORYX.I18N.SyntaxChecker.EPC_MANY_STARTS="There must be only one start event.",ORYX.I18N.SyntaxChecker.EPC_FUNCTION_AFTER_OR="There must be no functions after a splitting OR/XOR.",ORYX.I18N.SyntaxChecker.EPC_PI_AFTER_OR="There must be no process interface after a splitting OR/XOR.",ORYX.I18N.SyntaxChecker.EPC_FUNCTION_AFTER_FUNCTION="There must be no function after a function.",ORYX.I18N.SyntaxChecker.EPC_EVENT_AFTER_EVENT="There must be no event after an event.",ORYX.I18N.SyntaxChecker.EPC_PI_AFTER_FUNCTION="There must be no process interface after a function.",ORYX.I18N.SyntaxChecker.EPC_FUNCTION_AFTER_PI="There must be no function after a process interface.",ORYX.I18N.SyntaxChecker.EPC_SOURCE_EQUALS_TARGET="Edge must connect two distinct nodes.",ORYX.I18N.SyntaxChecker.PetriNet||(ORYX.I18N.SyntaxChecker.PetriNet={}),ORYX.I18N.SyntaxChecker.PetriNet_NOT_BIPARTITE="The graph is not bipartite",ORYX.I18N.SyntaxChecker.PetriNet_NO_LABEL="Label not set for a labeled transition",ORYX.I18N.SyntaxChecker.PetriNet_NO_ID="There is a node without id",ORYX.I18N.SyntaxChecker.PetriNet_SAME_SOURCE_AND_TARGET="Two flow relationships have the same source and target",ORYX.I18N.SyntaxChecker.PetriNet_NODE_NOT_SET="A node is not set for a flowrelationship",ORYX.I18N.Edge="Edge",ORYX.I18N.Node="Node",ORYX.I18N.SyntaxChecker.notice="Move the mouse over a red cross icon to see the error message.",ORYX.I18N.RESIZE||(ORYX.I18N.RESIZE={}),ORYX.I18N.RESIZE.tipGrow="Increase canvas size:",ORYX.I18N.RESIZE.tipShrink="Decrease canvas size:",ORYX.I18N.RESIZE.N="Top",ORYX.I18N.RESIZE.W="Left",ORYX.I18N.RESIZE.S="Down",ORYX.I18N.RESIZE.E="Right",ORYX.I18N.Layouting||(ORYX.I18N.Layouting={}),ORYX.I18N.Layouting.doing="Layouting...",ORYX.I18N.SyntaxChecker.MULT_ERRORS="Multiple Errors",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.oftenUsed="Often used",ORYX.I18N.PropertyWindow.moreProps="More Properties",ORYX.I18N.SyntaxChecker.BPMN2||(ORYX.I18N.SyntaxChecker.BPMN2={}),ORYX.I18N.SyntaxChecker.BPMN2_DATA_INPUT_WITH_INCOMING_DATA_ASSOCIATION="A Data Input must not have any incoming Data Associations.",ORYX.I18N.SyntaxChecker.BPMN2_DATA_OUTPUT_WITH_OUTGOING_DATA_ASSOCIATION="A Data Output must not have any outgoing Data Associations.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_TARGET_WITH_TOO_MANY_INCOMING_SEQUENCE_FLOWS="Targets of Event-based Gateways may only have one incoming Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WITH_TOO_LESS_OUTGOING_SEQUENCE_FLOWS="An Event-based Gateway must have two or more outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_EVENT_TARGET_CONTRADICTION="If Message Intermediate Events are used in the configuration, then Receive Tasks must not be used and vice versa.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WRONG_TRIGGER="Only the following Intermediate Event triggers are valid: Message, Signal, Timer, Conditional and Multiple.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WRONG_CONDITION_EXPRESSION="The outgoing Sequence Flows of the Event Gateway must not have a condition expression.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_NOT_INSTANTIATING="The Gateway does not meet the conditions to instantiate the process. Please use a start event or an instantiating attribute for the gateway.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAYDIRECTION_MIXED_FAILURE="The Gateway must have both multiple incoming and outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAYDIRECTION_CONVERGING_FAILURE="The Gateway must have multiple incoming but most NOT have multiple outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAYDIRECTION_DIVERGING_FAILURE="The Gateway must NOT have multiple incoming but must have multiple outgoing Sequence Flows.",ORYX.I18N.SyntaxChecker.BPMN2_GATEWAY_WITH_NO_OUTGOING_SEQUENCE_FLOW="A Gateway must have a minimum of one outgoing Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN2_RECEIVE_TASK_WITH_ATTACHED_EVENT="Receive Tasks used in Event Gateway configurations must not have any attached Intermediate Events.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_SUBPROCESS_BAD_CONNECTION="An Event Subprocess must not have any incoming or outgoing Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN_MESSAGE_FLOW_NOT_CONNECTED="At least one side of the Message Flow has to be connected.",ORYX.I18N.SyntaxChecker.BPMN2_TOO_MANY_INITIATING_MESSAGES="A Choreography Activity may only have one initiating message.",ORYX.I18N.SyntaxChecker.BPMN_MESSAGE_FLOW_NOT_ALLOWED="A Message Flow is not allowed here.",ORYX.I18N.SyntaxChecker.BPMN2_EVENT_BASED_WITH_TOO_LESS_INCOMING_SEQUENCE_FLOWS="An Event-based Gateway that is not instantiating must have a minimum of one incoming Sequence Flow.",ORYX.I18N.SyntaxChecker.BPMN2_TOO_FEW_INITIATING_PARTICIPANTS="A Choreography Activity must have one initiating Participant (white).",ORYX.I18N.SyntaxChecker.BPMN2_TOO_MANY_INITIATING_PARTICIPANTS="A Choreography Acitivity must not have more than one initiating Participant (white).",ORYX.I18N.SyntaxChecker.COMMUNICATION_AT_LEAST_TWO_PARTICIPANTS="The communication must be connected to at least two participants.",ORYX.I18N.SyntaxChecker.MESSAGEFLOW_START_MUST_BE_PARTICIPANT="The message flow's source must be a participant.",ORYX.I18N.SyntaxChecker.MESSAGEFLOW_END_MUST_BE_PARTICIPANT="The message flow's target must be a participant.",ORYX.I18N.SyntaxChecker.CONV_LINK_CANNOT_CONNECT_CONV_NODES="The conversation link must connect a communication or sub conversation node with a participant.",ORYX.I18N.PropertyWindow.dateFormat="d/m/y",ORYX.I18N.View.East="Attributes",ORYX.I18N.View.West="Modeling Elements",ORYX.I18N.Oryx.title="Signavio",ORYX.I18N.Oryx.pleaseWait="Please wait while the Signavio Process Editor is loading...",ORYX.I18N.Edit.cutDesc="Cuts the selection into the clipboard",ORYX.I18N.Edit.copyDesc="Copies the selection into the clipboard",ORYX.I18N.Edit.pasteDesc="Pastes the clipboard to the canvas",ORYX.I18N.ERDFSupport.noCanvas="The xml document has no canvas node included!",ORYX.I18N.ERDFSupport.noSS="The Signavio Process Editor canvas node has no stencil set definition included!",ORYX.I18N.ERDFSupport.deprText="Exporting to eRDF is not recommended anymore because the support will be stopped in future versions of the Signavio Process Editor. If possible, export the model to JSON. Do you want to export anyway?",ORYX.I18N.Save.pleaseWait="Please wait<br/>while saving...",ORYX.I18N.Save.saveAs="Save a copy...",ORYX.I18N.Save.saveAsDesc="Save a copy...",ORYX.I18N.Save.saveAsTitle="Save a copy...",ORYX.I18N.Save.savedAs="Copy saved",ORYX.I18N.Save.savedDescription="The process diagram is stored under",ORYX.I18N.Save.notAuthorized="You are currently not logged in. Please <a href='/p/login' target='_blank'>log in</a> in a new window so that you can save the current diagram.",ORYX.I18N.Save.transAborted="The saving request took too long. You may use a faster internet connection. If you use wireless LAN, please check the strength of your connection.",ORYX.I18N.Save.noRights="You do not have the required rights to store that model. Please check in the <a href='/p/explorer' target='_blank'>Signavio Explorer</a>, if you still have the rights to write in the target directory.",ORYX.I18N.Save.comFailed="The communication with the Signavio server failed. Please check your internet connection. If the problem resides, please contact the Signavio Support via the envelope symbol in the toolbar.",ORYX.I18N.Save.failed="Something went wrong when trying to save your diagram. Please try again. If the problem resides, please contact the Signavio Support via the envelope symbol in the toolbar.",ORYX.I18N.Save.exception="Some exceptions are raised while trying to save your diagram. Please try again. If the problem resides, please contact the Signavio Support via the envelope symbol in the toolbar.",ORYX.I18N.Save.retrieveData="Please wait, data is retrieving.",ORYX.I18N.ShapeMenuPlugin||(ORYX.I18N.ShapeMenuPlugin={}),ORYX.I18N.ShapeMenuPlugin.morphMsg="Transform shape",ORYX.I18N.ShapeMenuPlugin.morphWarningTitleMsg="Transform shape",ORYX.I18N.ShapeMenuPlugin.morphWarningMsg="There are child shape which can not be contained in the transformed element.<br/>Do you want to transform anyway?",!Signavio)var Signavio={};if(Signavio.I18N||(Signavio.I18N={}),Signavio.I18N.Editor||(Signavio.I18N.Editor={}),Signavio.I18N.Editor.Linking||(Signavio.I18N.Editor.Linking={}),Signavio.I18N.Editor.Linking.CreateDiagram="Create a new diagram",Signavio.I18N.Editor.Linking.UseDiagram="Use existing diagram",Signavio.I18N.Editor.Linking.UseLink="Use web link",Signavio.I18N.Editor.Linking.Close="Close",Signavio.I18N.Editor.Linking.Cancel="Cancel",Signavio.I18N.Editor.Linking.UseName="Adopt diagram name",Signavio.I18N.Editor.Linking.UseNameHint="Replaces the current name of the modeling element ({type}) with the name of the linked diagram.",Signavio.I18N.Editor.Linking.CreateTitle="Establish link",Signavio.I18N.Editor.Linking.AlertSelectModel="You have to select a model.",Signavio.I18N.Editor.Linking.ButtonLink="Link diagram",Signavio.I18N.Editor.Linking.LinkNoAccess="You have no access to this diagram.",Signavio.I18N.Editor.Linking.LinkUnavailable="The diagram is unavailable.",Signavio.I18N.Editor.Linking.RemoveLink="Remove link",Signavio.I18N.Editor.Linking.EditLink="Edit Link",Signavio.I18N.Editor.Linking.OpenLink="Open",Signavio.I18N.Editor.Linking.BrokenLink="The link is broken!",Signavio.I18N.Editor.Linking.PreviewTitle="Preview",Signavio.I18N.Glossary_Support||(Signavio.I18N.Glossary_Support={}),Signavio.I18N.Glossary_Support.renameEmpty="No dictionary entry",Signavio.I18N.Glossary_Support.renameLoading="Searching...",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.oftenUsed="Main properties",ORYX.I18N.PropertyWindow.moreProps="More properties",ORYX.I18N.PropertyWindow.btnOpen="Open",ORYX.I18N.PropertyWindow.btnRemove="Remove",ORYX.I18N.PropertyWindow.btnEdit="Edit",ORYX.I18N.PropertyWindow.btnUp="Move up",ORYX.I18N.PropertyWindow.btnDown="Move down",ORYX.I18N.PropertyWindow.createNew="Create new",ORYX.I18N.PropertyWindow||(ORYX.I18N.PropertyWindow={}),ORYX.I18N.PropertyWindow.oftenUsed="Main attributes",ORYX.I18N.PropertyWindow.moreProps="More attributes",ORYX.I18N.PropertyWindow.characteristicNr="Cost &amp; Resource Analysis",ORYX.I18N.PropertyWindow.meta="Custom attributes",ORYX.I18N.PropertyWindow.Category||(ORYX.I18N.PropertyWindow.Category={}),ORYX.I18N.PropertyWindow.Category.popular="Main Attributes",ORYX.I18N.PropertyWindow.Category.characteristicnr="Cost &amp; Resource Analysis",ORYX.I18N.PropertyWindow.Category.others="More Attributes",ORYX.I18N.PropertyWindow.Category.meta="Custom Attributes",ORYX.I18N.PropertyWindow.ListView||(ORYX.I18N.PropertyWindow.ListView={}),ORYX.I18N.PropertyWindow.ListView.title="Edit: ",ORYX.I18N.PropertyWindow.ListView.dataViewLabel="Already existing entries.",ORYX.I18N.PropertyWindow.ListView.dataViewEmptyText="No list entries.",ORYX.I18N.PropertyWindow.ListView.addEntryLabel="Add a new entry",ORYX.I18N.PropertyWindow.ListView.buttonAdd="Add",ORYX.I18N.PropertyWindow.ListView.save="Save",ORYX.I18N.PropertyWindow.ListView.cancel="Cancel",Signavio.I18N.Buttons||(Signavio.I18N.Buttons={}),Signavio.I18N.Buttons.save="Save",Signavio.I18N.Buttons.cancel="Cancel",Signavio.I18N.Buttons.remove="Remove",Signavio.I18N.btn||(Signavio.I18N.btn={}),Signavio.I18N.btn.btnEdit="Edit",Signavio.I18N.btn.btnRemove="Remove",Signavio.I18N.btn.moveUp="Move up",Signavio.I18N.btn.moveDown="Move down",Signavio.I18N.field||(Signavio.I18N.field={}),Signavio.I18N.field.Url="URL",Signavio.I18N.field.UrlLabel="Label",!ORYX)var ORYX={};ORYX.Utils={getParamFromUrl:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",i=new RegExp(t),n=i.exec(window.location.href);return null==n?null:n[1]},adjustLightness:function(){return arguments[0]},adjustGradient:function(e,t){if(ORYX.CONFIG.DISABLE_GRADIENT&&e){var i=t.getAttributeNS(null,"stop-color")||"#ffffff";$A(e.getElementsByTagName("stop")).each(function(e){e!=t&&e.setAttributeNS(null,"stop-color",i)})}}},XMLNS={ATOM:"http://www.w3.org/2005/Atom",XHTML:"http://www.w3.org/1999/xhtml",ERDF:"http://purl.org/NET/erdf/profile",RDFS:"http://www.w3.org/2000/01/rdf-schema#",RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",
RAZIEL:"http://b3mn.org/Raziel",SCHEMA:""};var Kickstart={started:!1,callbacks:[],alreadyLoaded:[],PATH:"",load:function(){Kickstart.kick()},kick:function(){Kickstart.started||(Kickstart.started=!0,Kickstart.callbacks.each(function(e){window.setTimeout(e,1)}))},register:function(callback){with(Kickstart)started?window.setTimeout(callback,1):Kickstart.callbacks.push(callback)},require:function(e){return!Kickstart.alreadyLoaded.member(e)&&Kickstart.include(e)},include:function(e){var t=document.getElementsByTagNameNS(XMLNS.XHTML,"head")[0],i=document.createElementNS(XMLNS.XHTML,"script");return i.setAttributeNS(XMLNS.XHTML,"type","text/javascript"),i.src=Kickstart.PATH+e,t.appendChild(i),Kickstart.alreadyLoaded.push(e),!0}};Event.observe(window,"load",Kickstart.load);var ERDF={LITERAL:1,RESOURCE:2,DELIMITERS:[".","-"],HASH:"#",HYPHEN:"-",schemas:[],callback:void 0,log:void 0,init:function(e){ERDF.callback=e,ERDF.registerSchema("schema",XMLNS.SCHEMA),ERDF.registerSchema("rdfs",XMLNS.RDFS)},run:function(){return ERDF._checkProfile()&&ERDF.parse()},parse:function(){ERDF.__startTime=new Date;var e=document.getElementsByTagNameNS(XMLNS.XHTML,"body"),t={type:ERDF.RESOURCE,value:""},i=ERDF._parseDocumentMetadata()&&ERDF._parseFromTag(e[0],t);ERDF.__stopTime=new Date;(ERDF.__stopTime-ERDF.__startTime)/1e3;return i},_parseDocumentMetadata:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head"),t=e[0].getElementsByTagNameNS(XMLNS.XHTML,"link"),i=e[0].getElementsByTagNameNS(XMLNS.XHTML,"meta");return $A(t).each(function(e){var t=e.getAttribute("rel"),i=e.getAttribute("rev"),n=e.getAttribute("href");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.RESOURCE,n),ERDF._parseTriplesFrom(ERDF.RESOURCE,n,i,ERDF.RESOURCE,"")}),$A(i).each(function(e){var t=e.getAttribute("name"),i=e.getAttribute("content");ERDF._parseTriplesFrom(ERDF.RESOURCE,"",t,ERDF.LITERAL,i)}),!0},_parseFromTag:function(e,t,i){if(e&&e.namespaceURI&&e.namespaceURI==XMLNS.XHTML){i||(i=0);var n=e.getAttribute("id");if(e.nodeName.endsWith(":a")||"a"==e.nodeName){var s=e.getAttribute("rel"),o=e.getAttribute("rev"),a=e.getAttribute("href"),r=e.getAttribute("title"),h=e.textContent;ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.RESOURCE,a,function(e){var t=r?r:h;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)}),ERDF._parseTriplesFrom(t.type,t.value,o,ERDF.RESOURCE,""),ERDF._parseTypeTriplesFrom(t.type,t.value,s)}else if(e.nodeName.endsWith(":img")||"img"==e.nodeName){var s=e.getAttribute("class"),a=e.getAttribute("src"),c=e.getAttribute("alt");ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.RESOURCE,a,function(e){var t=c;ERDF._parseTriplesFrom(e.object.type,e.object.value,"rdfs.label",ERDF.LITERAL,t)})}var s=e.getAttribute("class"),r=e.getAttribute("title"),h=e.textContent,d=r?r:h;ERDF._parseTriplesFrom(t.type,t.value,s,ERDF.LITERAL,d),n&&(t={type:ERDF.RESOURCE,value:ERDF.HASH+n}),ERDF._parseTypeTriplesFrom(t.type,t.value,s);var l=e.childNodes;l&&$A(l).each(function(e){e.nodeType==e.ELEMENT_NODE&&ERDF._parseFromTag(e,t,i+1)})}},_parseTriplesFrom:function(e,t,i,n,s,o){i&&i.toLowerCase().split(" ").each(function(e){var i=ERDF.schemas.find(function(t){return ERDF.DELIMITERS.find(function(i){return e.startsWith(t.prefix+i)})});if(i&&s){e=e.substring(i.prefix.length+1,e.length);var a=ERDF.registerTriple(new ERDF.Resource(t),{prefix:i.prefix,name:e},n==ERDF.RESOURCE?new ERDF.Resource(s):new ERDF.Literal(s));o&&o(a)}})},_parseTypeTriplesFrom:function(e,t,i,n){i&&i.toLowerCase().split(" ").each(function(i){var s=ERDF.schemas.find(function(e){return ERDF.DELIMITERS.find(function(t){return i.startsWith(ERDF.HYPHEN+e.prefix+t)})});if(s&&t){i=i.substring(s.prefix.length+2,i.length);var o=ERDF.registerTriple(e==ERDF.RESOURCE?new ERDF.Resource(t):new ERDF.Literal(t),{prefix:"rdf",name:"type"},new ERDF.Resource(s.namespace+i));n&&n(o)}})},_checkProfile:function(){var e=document.getElementsByTagNameNS(XMLNS.XHTML,"head"),t=e[0].getAttribute("profile");return!(!t||!t.split(" ").member(XMLNS.ERDF))},__stripHashes:function(e){return e&&"function"==typeof e.substring&&"#"==e.substring(0,1)?e.substring(1,e.length):e},registerSchema:function(e,t){ERDF.schemas.push({prefix:e,namespace:t})},registerTriple:function(e,t,i){"schema"==t.prefix.toLowerCase()&&this.registerSchema(t.name,i.value);var n=new ERDF.Triple(e,t,i);return ERDF.callback(n),n},__enhanceObject:function(){this.isResource=function(){return this.type==ERDF.RESOURCE},this.isLocal=function(){return this.isResource()&&this.value.startsWith("#")},this.isCurrentDocument=function(){return this.isResource()&&""==this.value},this.getId=function(){return!!this.isLocal()&&ERDF.__stripHashes(this.value)},this.isLiteral=function(){return this.type==ERDF.LIITERAL}},serialize:function(e){return e?e.constructor==String?e:e.constructor==Boolean?e?"true":"false":e.toString():""}};ERDF.Triple=function(e,t,i){this.subject=e,this.predicate=t,this.object=i,this.toString=function(){return"[ERDF.Triple] "+this.subject.toString()+" "+this.predicate.prefix+":"+this.predicate.name+" "+this.object.toString()}},ERDF.Resource=function(e){this.type=ERDF.RESOURCE,this.value=e,ERDF.__enhanceObject.apply(this),this.toString=function(){return"&lt;"+this.value+"&gt;"}},ERDF.Literal=function(e){this.type=ERDF.LITERAL,this.value=ERDF.serialize(e),ERDF.__enhanceObject.apply(this),this.toString=function(){return'"'+this.value+'"'}};var USE_ASYNCHRONOUS_REQUESTS=!0,DISCARD_UNUSED_TRIPLES=!0,PREFER_SPANS_OVER_DIVS=!0,PREFER_TITLE_OVER_TEXTNODE=!1,RESOURCE_ID_PREFIX="resource",SHOW_DEBUG_ALERTS_WHEN_SAVING=!1,SHOW_EXTENDED_DEBUG_INFORMATION=!1,USE_ARESS_WORKAROUNDS=!0,RESOURCE_CREATED=1,RESOURCE_REMOVED=2,RESOURCE_SAVED=4,RESOURCE_RELOADED=8,RESOURCE_SYNCHRONIZED=16,TRIPLE_REMOVE=1,TRIPLE_ADD=2,TRIPLE_RELOAD=4,TRIPLE_SAVE=8,PROCESSDATA_REF="processdata",DataManager={init:function(){ERDF.init(DataManager._registerTriple),DataManager.__synclocal()},_triples:[],_registerTriple:function(e){DataManager._triples.push(e)},__synclocal:function(){DataManager._triples=[],ERDF.run()},__synchronizeShape:function(e){var t=ResourceManager.getResource(e.resourceId),i=e.serialize();return i.each(function(t){var i="resource"==t.type,n=new ERDF.Triple(new ERDF.Resource(e.resourceId),{prefix:t.prefix,name:t.name},i?new ERDF.Resource(t.value):new ERDF.Literal(t.value));DataManager.setObject(n)}),t},__storeShape:function(e){var t=DataManager.__synchronizeShape(e);t.save()},__forceExistance:function(e){if($(e.resourceId)){var t=$(e.resourceId),i=$A(t.childNodes);i.each(function(e){t.removeChild(e)})}else $$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),DataManager.graft(XMLNS.XHTML,$$("."+PROCESSDATA_REF)[0],["div",{id:e.resourceId,"class":e instanceof ORYX.Core.Canvas?"-oryx-canvas":void 0}])},__persistShape:function(e){var t=e.serialize(),i=new ERDF.Resource(e.resourceId);DataManager.removeTriples(DataManager.query(i,void 0,void 0)),t.each(function(e){var t="resource"==e.type?new ERDF.Resource(e.value):new ERDF.Literal(e.value);DataManager.addTriple(new ERDF.Triple(i,{prefix:e.prefix,name:e.name},t))})},__persistDOM:function(e){var t=e.getCanvas(),i=t.getChildShapes(!0),n="";return i.each(function(e){DataManager.__forceExistance(e)}),DataManager.__renderCanvas(e),n+=DataManager.serialize($(ERDF.__stripHashes(e.getCanvas().resourceId)),!0),i.each(function(e){DataManager.__persistShape(e),n+=DataManager.serialize($(ERDF.__stripHashes(e.resourceId)),!0)}),n},__renderCanvas:function(e){var t=e.getCanvas(),i=e.getStencilSets(),n=t.getChildShapes(!0);DataManager.__forceExistance(t),DataManager.__persistShape(t);var s=new ERDF.Resource(t.resourceId);DataManager.removeTriples(DataManager.query(s,void 0,void 0)),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"mode"},new ERDF.Literal("writable"))),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"mode"},new ERDF.Literal("fullscreen"))),i.values().each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"stencilset"},new ERDF.Resource(e.source().replace(/&/g,"%26")))),DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"ssnamespace"},new ERDF.Resource(e.namespace()))),e.extensions().keys().each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"ssextension"},new ERDF.Literal(e)))})}),n.each(function(e){DataManager.addTriple(new ERDF.Triple(s,{prefix:"oryx",name:"render"},new ERDF.Resource("#"+e.resourceId)))})},__counter:0,__provideId:function(){for(;$(RESOURCE_ID_PREFIX+DataManager.__counter);)DataManager.__counter++;return RESOURCE_ID_PREFIX+DataManager.__counter},serializeDOM:function(e){return DataManager.__persistDOM(e)},syncGlobal:function(e){return DataManager.__syncglobal(e)},__syncglobal:function(e){var t=e.getCanvas(),i=t.getChildShapes(!0);i.select(function(e){return!$(e.resourceId)}).each(function(e){if(USE_ARESS_WORKAROUNDS){var t=e.properties["raziel-type"],i='<div xmlns="http://www.w3.org/1999/xhtml"><span class="raziel-type">'+t+"</span></div>",n=ResourceManager.__createResource(i);e.resourceId=n.id()}else{var n=ResourceManager.__createResource();e.resourceId=n.id()}}),i.each(function(e){DataManager.__storeShape(e)})},serialize:function(e,t){if(e.nodeType==e.ELEMENT_NODE){var i=$A(e.childNodes),n=$A(e.attributes),s=new String(e.getAttribute("class")),o=s.split(" ").member("transient");if(o)return"";var a="<"+e.nodeName;return t||(a+=' xmlns="'+(e.namespaceURI?e.namespaceURI:XMLNS.XHTML)+'" xmlns:oryx="http://oryx-editor.org"'),n.each(function(e){a+=" "+e.nodeName+'="'+e.nodeValue+'"'}),0==i.length?a+="/>":(a+=">",i.each(function(e){a+=DataManager.serialize(e,!0)}),a+="</"+e.nodeName+">"),a}if(e.nodeType==e.TEXT_NODE)return e.nodeValue},addTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot add the triple "+e.toString()+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot add the triple "+e.toString()+' because the subject "'+t+'" is not in the document.';return e.object.type==ERDF.LITERAL?DataManager.graft(XMLNS.XHTML,i,["span",{"class":e.predicate.prefix+"-"+e.predicate.name},e.object.value.escapeHTML()]):DataManager.graft(XMLNS.XHTML,i,["a",{rel:e.predicate.prefix+"-"+e.predicate.name,href:e.object.value}]),!0},removeTriples:function(e){var t=e.select(function(e){return DataManager.__removeTriple(e)});return t},removeTriple:function(e){var t=DataManager.__removeTriple(e);return t},__removeTriple:function(e){if(!e.subject.type==ERDF.LITERAL)throw"Cannot remove the triple "+e.toString()+" because the subject is not a resource.";var t=ERDF.__stripHashes(e.subject.value),i=$(t);if(!i)throw"Cannot remove the triple "+e.toString()+" because the subject is not in the document.";if(e.object.type==ERDF.LITERAL){var n=DataManager.__removeTripleRecursively(e,i);return n}},__removeTripleRecursively:function(e,t){if(t.nodeType!=t.ELEMENT_NODE)return!1;var i=new String(t.getAttribute("class")),n=$A(t.childNodes);if(i.include(e.predicate.prefix+"-"+e.predicate.name)){var s=t.textContent;return e.object.type==ERDF.LITERAL&&e.object.value==s&&t.parentNode.removeChild(t),!0}return n.each(function(t){DataManager.__removeTripleRecursively(e,t)}),!1},graft:function(e,t,i,n){n=n||t&&t.ownerDocument||document;var s;if(void 0===i)echo("Can't graft an undefined value");else if(i.constructor==String)s=n.createTextNode(i);else for(var o=0;o<i.length;o++){if(0===o&&i[o].constructor==String){var a=i[o].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i);if(a){s=n.createElementNS(e,a[1]),s.setAttributeNS(null,"class",a[2]);continue}if(a=i[o].match(/^([a-z][a-z0-9]*)$/i)){s=n.createElementNS(e,a[1]);continue}s=n.createElementNS(e,"span"),s.setAttribute(null,"class","namelessFromLOL")}if(void 0===i[o])echo("Can't graft an undefined value in a list!");else if(i[o].constructor==String||i[o].constructor==Array)this.graft(e,s,i[o],n);else if(i[o].constructor==Number)this.graft(e,s,i[o].toString(),n);else if(i[o].constructor==Object)for(var r in i[o])s.setAttributeNS(null,r,i[o][r]);else{if(i[o].constructor!=Boolean)throw"Object "+i[o]+" is inscrutable as an graft arglet.";this.graft(e,s,i[o]?"true":"false",n)}}return t&&t.appendChild(s),Element.extend(s)},setObject:function(e){var t=DataManager.query(e.subject,e.predicate,void 0);return DataManager.removeTriples(t),DataManager.addTriple(e),!0},query:function(e,t,i){return DataManager._triples.select(function(n){var s=!e||n.subject.type==e.type&&n.subject.value==e.value;return t&&(s=s&&(!t.prefix||n.predicate.prefix==t.prefix),s=s&&(!t.name||n.predicate.name==t.name)),s=s&&(!i||n.object.type==i.type&&n.object.value==i.value)})}};Kickstart.register(DataManager.init);var chain=new MetaTagHandler,command=new DMCommand(TRIPLE_ADD,new ERDF.Triple(new ERDF.Resource(""),"rdf:tool",new ERDF.Literal("")));ResourceManager={__corrupt:!1,__latelyCreatedResource:void 0,__listeners:$H(),__token:1,addListener:function(e,t){if(!(e instanceof Function))throw"Resource event listener is not a function!";if(!t)throw"Invalid mask for resource event listener registration.";var i={listener:e,mask:t},n=ResourceManager.__token++;return ResourceManager.__listeners[n]=i,n},removeListener:function(e){return ResourceManager.__listners.remove(e)},__Event:function(e,t){this.action=e,this.resourceId=t},__dispatchEvent:function(e){ResourceManager.__listeners.values().each(function(t){if(e.action&t.mask)return t.listener(e)})},getResource:function(e){e=ERDF.__stripHashes(e);var t=DataManager.query(new ERDF.Resource("#"+e),{prefix:"raziel",name:"entry"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value;return new ResourceManager.__Resource(e,i)}throw"Resource with id "+e+" not recognized as such. "+(t.length>1?" There is more than one raziel:entry URL.":" There is no raziel:entry URL.")},__createResource:function(e){var t=DataManager.query(new ERDF.Resource(""),{prefix:"raziel",name:"collection"},void 0);if(1==t.length&&t[0].object.isResource()){var i=t[0].object.value,n=void 0,s=e?e:'<div xmlns="http://www.w3.org/1999/xhtml"></div>';return ResourceManager.__request("POST",i,s,function(){var e=this.responseXML,t=e.childNodes[0],i=t.getAttribute("id");$$("."+PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),$$("."+PROCESSDATA_REF)[0].appendChild(t.cloneNode(!0)),DataManager.__synclocal(),n=new ResourceManager.getResource(i),ResourceManager.__resourceActionSucceeded(this,RESOURCE_CREATED,void 0)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_CREATED,void 0)},!1),n}throw"Could not create resource! raziel:collection URL is missing!"},__Resource:function(e,t){this.__id=e,this.__url=t,this.id=function(){return this.__id},this.url=function(){return this.__url},this.reload=function(){var e=this.__url,t=this.__id;ResourceManager.__request("GET",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_RELOADED,t)},function(){ResourceManager.__resourceActionFailed(this,RESURCE_RELOADED,t)},USE_ASYNCHRONOUS_REQUESTS)},this.save=function(e){var t=this.__url,i=this.__id;data=DataManager.serialize($(i)),ResourceManager.__request("PUT",t,data,function(){ResourceManager.__resourceActionSucceeded(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE_SAVED,i)},function(){ResourceManager.__resourceActionFailed(this,e?RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:RESOURCE.SAVED,i)},USE_ASYNCHRONOUS_REQUESTS)},this.remove=function(){var e=this.__url,t=this.__id;ResourceManager.__request("DELETE",e,null,function(){ResourceManager.__resourceActionSucceeded(this,RESOURCE_REMOVED,t)},function(){ResourceManager.__resourceActionFailed(this,RESOURCE_REMOVED,t)},USE_ASYNCHRONOUS_REQUESTS)}},request:function(e,t){var i={method:"get",asynchronous:!0,parameters:{}};Object.extend(i,t||{});var n=Hash.toQueryString(i.parameters);return n&&(e+=(e.include("?")?"&":"?")+n),ResourceManager.__request(i.method,e,i.data,i.onSuccess instanceof Function?function(){i.onSuccess(this)}:void 0,i.onFailure instanceof Function?function(){i.onFailure(this)}:void 0,i.asynchronous&&USE_ASYNCHRONOUS_REQUESTS,i.headers)},__request:function(e,t,i,n,s,o,a){var r=Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")});if(!r){if(!this.__corrupt)throw"This browser does not provide any AJAX functionality. You will not be able to use the software provided with the page you are viewing. Please consider installing appropriate extensions.";return this.__corrupt=!0,!1}n instanceof Function&&(r.onload=n),s instanceof Function&&(r.onerror=s);var h=$H(a);h.keys().each(function(e){r.setRequestHeader(e,h[e])});try{SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(e+" "+t+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?i:""),r.open(e,t,!!o),r.send(i)}catch(c){return!1}return!0},__resourceActionSucceeded:function(e,t,i){var n=e.status,s=e.responseText;if(SHOW_DEBUG_ALERTS_WHEN_SAVING&&alert(n+" "+url+"\n"+SHOW_EXTENDED_DEBUG_INFORMATION?data:""),n>=300)throw"The server responded with an error: "+n+"\n"+(SHOW_EXTENDED_DEBUG_INFORMATION?+data:"If you need additional information here, including the data sent by the server, consider setting SHOW_EXTENDED_DEBUG_INFORMATION to true.");switch(t){case RESOURCE_REMOVED:var s=e.responseXML,o=s.childNodes[0],i=o.getAttribute("id"),a=document.getElementById(i);a.parentNode.removeChild(a);break;case RESOURCE_CREATED:break;case RESOURCE_SAVED|RESOURCE_SYNCHRONIZED:DataManager.__synclocal();case RESOURCE_SAVED:break;case RESOURCE_RELOADED:var s=e.responseXML,o=s.childNodes[0],i=o.getAttribute("id"),a=document.getElementById(i);a.parentNode.removeChild(a),$$(PROCESSDATA_REF)[0]||DataManager.graft(XMLNS.XHTML,document.getElementsByTagNameNS(XMLNS.XHTML,"body").item(0),["div",{"class":PROCESSDATA_REF,style:"display:none;"}]),$$(PROCESSDATA_REF)[0].appendChild(o.cloneNode(!0)),DataManager.__synclocal();break;default:DataManager.__synclocal()}ResourceManager.__dispatchEvent(new ResourceManager.__Event(t,i))},__resourceActionFailed:function(e,t,i){throw"Fatal: Resource action failed. There is something horribly wrong with either the server, the transport protocol or your online status. Sure you're online?"}};var Clazz=function(){};if(Clazz.prototype.construct=function(){},Clazz.extend=function(e){var t=function(){arguments[0]!==Clazz&&this.construct.apply(this,arguments)},i=new this(Clazz),n=this.prototype;for(var s in e){var o=e[s];o instanceof Function&&(o.$=n),i[s]=o}return t.prototype=i,t.extend=this.extend,t},!ORYX)var ORYX={};if(ORYX.CONFIG||(ORYX.CONFIG={}),ORYX.CONFIG.ROOT_PATH="editor/",ORYX.CONFIG.EXPLORER_PATH="explorer",ORYX.CONFIG.LIBS_PATH="libs",ORYX.CONFIG.SERVER_HANDLER_ROOT="service",ORYX.CONFIG.SERVER_EDITOR_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor",ORYX.CONFIG.SERVER_MODEL_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/model",ORYX.CONFIG.STENCILSET_HANDLER=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_stencilset?embedsvg=true&url=true&namespace=",ORYX.CONFIG.STENCIL_SETS_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_stencilset",ORYX.CONFIG.PLUGINS_CONFIG="plugins.xml",ORYX.CONFIG.SYNTAXCHECKER_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/syntaxchecker",ORYX.CONFIG.DEPLOY_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/model/deploy",ORYX.CONFIG.MODEL_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/models",ORYX.CONFIG.FORM_FLOW_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/formflows",ORYX.CONFIG.FORM_FLOW_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/formflow",ORYX.CONFIG.FORM_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/forms",ORYX.CONFIG.FORM_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/form",ORYX.CONFIG.SUB_PROCESS_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/subprocesses",ORYX.CONFIG.SUB_PROCESS_IMAGE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/subprocess",ORYX.CONFIG.TEST_SERVICE_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/service/",ORYX.CONFIG.SERVICE_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/services",ORYX.CONFIG.CONDITION_ELEMENT_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/conditionelements",ORYX.CONFIG.VARIABLEDEF_ELEMENT_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/variabledefinitionelements",ORYX.CONFIG.VALIDATOR_LIST_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/validators",ORYX.CONFIG.SS_EXTENSIONS_FOLDER=ORYX.CONFIG.ROOT_PATH+"stencilsets/extensions/",ORYX.CONFIG.SS_EXTENSIONS_CONFIG=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/editor_ssextensions",ORYX.CONFIG.ORYX_NEW_URL="/new",ORYX.CONFIG.BPMN_LAYOUTER=ORYX.CONFIG.ROOT_PATH+"bpmnlayouter",ORYX.CONFIG.EXPRESSION_METADATA_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/expression-metadata",ORYX.CONFIG.DATASOURCE_METADATA_URL=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/datasource-metadata",!ORYX)var ORYX={};ORYX.CONFIG||(ORYX.CONFIG={}),ORYX.CONFIG.BACKEND_SWITCH=!0,ORYX.CONFIG.PANEL_LEFT_WIDTH=250,ORYX.CONFIG.PANEL_RIGHT_COLLAPSED=!0,ORYX.CONFIG.PANEL_RIGHT_WIDTH=300,ORYX.CONFIG.APPNAME="Flowable",ORYX.CONFIG.WEB_URL=".",ORYX.CONFIG.BLANK_IMAGE=ORYX.CONFIG.LIBS_PATH+"/ext-2.0.2/resources/images/default/s.gif",ORYX.CONFIG.OFFSET_HEADER=61,ORYX.CONFIG.SHOW_GRIDLINE=!0,ORYX.CONFIG.MODE_READONLY="readonly",ORYX.CONFIG.MODE_FULLSCREEN="fullscreen",ORYX.CONFIG.WINDOW_HEIGHT=800,ORYX.CONFIG.PREVENT_LOADINGMASK_AT_READY=!1,ORYX.CONFIG.PLUGINS_ENABLED=!0,ORYX.CONFIG.PLUGINS_FOLDER="Plugins/",ORYX.CONFIG.BPMN20_SCHEMA_VALIDATION_ON=!0,ORYX.CONFIG.NAMESPACE_ORYX="http://www.b3mn.org/oryx",ORYX.CONFIG.NAMESPACE_SVG="http://www.w3.org/2000/svg",ORYX.CONFIG.CANVAS_WIDTH=1200,ORYX.CONFIG.CANVAS_HEIGHT=1050,ORYX.CONFIG.CANVAS_RESIZE_INTERVAL=100,ORYX.CONFIG.CANVAS_MIN_WIDTH=800,ORYX.CONFIG.CANVAS_MIN_HEIGHT=300,ORYX.CONFIG.SELECTED_AREA_PADDING=4,ORYX.CONFIG.CANVAS_BACKGROUND_COLOR="none",ORYX.CONFIG.GRID_DISTANCE=30,ORYX.CONFIG.GRID_ENABLED=!0,ORYX.CONFIG.ZOOM_OFFSET=.1,ORYX.CONFIG.DEFAULT_SHAPE_MARGIN=60,ORYX.CONFIG.SCALERS_SIZE=7,ORYX.CONFIG.MINIMUM_SIZE=20,ORYX.CONFIG.MAXIMUM_SIZE=1e4,ORYX.CONFIG.OFFSET_MAGNET=15,ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP=8,ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM=8,ORYX.CONFIG.OFFSET_EDGE_BOUNDS=5,ORYX.CONFIG.COPY_MOVE_OFFSET=30,ORYX.CONFIG.BORDER_OFFSET=14,ORYX.CONFIG.MAX_NUM_SHAPES_NO_GROUP=20,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET_CORNER=30,ORYX.CONFIG.SHAPEMENU_CREATE_OFFSET=45,ORYX.CONFIG.SHAPEMENU_RIGHT="Oryx_Right",ORYX.CONFIG.SHAPEMENU_BOTTOM="Oryx_Bottom",ORYX.CONFIG.SHAPEMENU_LEFT="Oryx_Left",ORYX.CONFIG.SHAPEMENU_TOP="Oryx_Top",ORYX.CONFIG.MORPHITEM_DISABLED="Oryx_MorphItem_disabled",ORYX.CONFIG.TYPE_STRING="string",ORYX.CONFIG.TYPE_BOOLEAN="boolean",ORYX.CONFIG.TYPE_INTEGER="integer",ORYX.CONFIG.TYPE_FLOAT="float",ORYX.CONFIG.TYPE_COLOR="color",ORYX.CONFIG.TYPE_DATE="date",ORYX.CONFIG.TYPE_CHOICE="choice",ORYX.CONFIG.TYPE_URL="url",ORYX.CONFIG.TYPE_DIAGRAM_LINK="diagramlink",ORYX.CONFIG.TYPE_COMPLEX="complex",ORYX.CONFIG.TYPE_MULTIPLECOMPLEX="multiplecomplex",ORYX.CONFIG.TYPE_TEXT="text",ORYX.CONFIG.TYPE_FLOWABLE_MULTIINSTANCE="flowable-multiinstance",ORYX.CONFIG.TYPE_MODEL_LINK="modellink",ORYX.CONFIG.TYPE_FORM_FLOW_LINK="formflowlink",ORYX.CONFIG.TYPE_FORM_LINK="formlink",ORYX.CONFIG.TYPE_SUB_PROCESS_LINK="subprocess-link",ORYX.CONFIG.TYPE_SERVICE_LINK="servicelink",ORYX.CONFIG.TYPE_CONDITIONS="conditions",ORYX.CONFIG.TYPE_VARIABLES="variables",ORYX.CONFIG.TYPE_LISTENER="listener",ORYX.CONFIG.TYPE_EPC_FREQ="epcfrequency",ORYX.CONFIG.TYPE_GLOSSARY_LINK="glossarylink",ORYX.CONFIG.TYPE_EXPRESSION="expression",ORYX.CONFIG.TYPE_DATASOURCE="datasource",ORYX.CONFIG.TYPE_DATASOURCE_MINIMAL="datasource-minimal",ORYX.CONFIG.TYPE_VALIDATORS="validators",ORYX.CONFIG.LABEL_LINE_DISTANCE=2,ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT=12,ORYX.CONFIG.ENABLE_MORPHMENU_BY_HOVER=!1,ORYX.CONFIG.EDITOR_ALIGN_BOTTOM=1,ORYX.CONFIG.EDITOR_ALIGN_MIDDLE=2,ORYX.CONFIG.EDITOR_ALIGN_TOP=4,ORYX.CONFIG.EDITOR_ALIGN_LEFT=8,ORYX.CONFIG.EDITOR_ALIGN_CENTER=16,ORYX.CONFIG.EDITOR_ALIGN_RIGHT=32,ORYX.CONFIG.EDITOR_ALIGN_SIZE=48,ORYX.CONFIG.EVENT_MOUSEDOWN="mousedown",ORYX.CONFIG.EVENT_MOUSEUP="mouseup",ORYX.CONFIG.EVENT_MOUSEOVER="mouseover",ORYX.CONFIG.EVENT_MOUSEOUT="mouseout",ORYX.CONFIG.EVENT_MOUSEMOVE="mousemove",ORYX.CONFIG.EVENT_DBLCLICK="dblclick",ORYX.CONFIG.EVENT_KEYDOWN="keydown",ORYX.CONFIG.EVENT_KEYUP="keyup",ORYX.CONFIG.EVENT_LOADED="editorloaded",ORYX.CONFIG.EVENT_SAVED="editorSaved",ORYX.CONFIG.EVENT_EXECUTE_COMMANDS="executeCommands",ORYX.CONFIG.EVENT_STENCIL_SET_LOADED="stencilSetLoaded",ORYX.CONFIG.EVENT_SELECTION_CHANGED="selectionchanged",ORYX.CONFIG.EVENT_SHAPEADDED="shapeadded",ORYX.CONFIG.EVENT_SHAPEREMOVED="shaperemoved",ORYX.CONFIG.EVENT_PROPERTY_CHANGED="propertyChanged",ORYX.CONFIG.EVENT_DRAGDROP_START="dragdrop.start",ORYX.CONFIG.EVENT_SHAPE_MENU_CLOSE="shape.menu.close",ORYX.CONFIG.EVENT_DRAGDROP_END="dragdrop.end",ORYX.CONFIG.EVENT_RESIZE_START="resize.start",ORYX.CONFIG.EVENT_RESIZE_END="resize.end",ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED="dragDocker.docked",ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW="highlight.showHighlight",ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE="highlight.hideHighlight",ORYX.CONFIG.EVENT_LOADING_ENABLE="loading.enable",ORYX.CONFIG.EVENT_LOADING_DISABLE="loading.disable",ORYX.CONFIG.EVENT_LOADING_STATUS="loading.status",ORYX.CONFIG.EVENT_OVERLAY_SHOW="overlay.show",ORYX.CONFIG.EVENT_OVERLAY_HIDE="overlay.hide",ORYX.CONFIG.EVENT_ARRANGEMENT_TOP="arrangement.setToTop",ORYX.CONFIG.EVENT_ARRANGEMENT_BACK="arrangement.setToBack",ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD="arrangement.setForward",ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD="arrangement.setBackward",ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED="propertyWindow.propertyChanged",ORYX.CONFIG.EVENT_LAYOUT_ROWS="layout.rows",ORYX.CONFIG.EVENT_LAYOUT_BPEL="layout.BPEL",ORYX.CONFIG.EVENT_LAYOUT_BPEL_VERTICAL="layout.BPEL.vertical",ORYX.CONFIG.EVENT_LAYOUT_BPEL_HORIZONTAL="layout.BPEL.horizontal",ORYX.CONFIG.EVENT_LAYOUT_BPEL_SINGLECHILD="layout.BPEL.singlechild",ORYX.CONFIG.EVENT_LAYOUT_BPEL_AUTORESIZE="layout.BPEL.autoresize",ORYX.CONFIG.EVENT_AUTOLAYOUT_LAYOUT="autolayout.layout",ORYX.CONFIG.EVENT_UNDO_EXECUTE="undo.execute",ORYX.CONFIG.EVENT_UNDO_ROLLBACK="undo.rollback",ORYX.CONFIG.EVENT_UNDO_RESET="undo.reset",ORYX.CONFIG.EVENT_BUTTON_UPDATE="toolbar.button.update",ORYX.CONFIG.EVENT_LAYOUT="layout.dolayout",ORYX.CONFIG.EVENT_GLOSSARY_LINK_EDIT="glossary.link.edit",ORYX.CONFIG.EVENT_GLOSSARY_SHOW="glossary.show.info",ORYX.CONFIG.EVENT_GLOSSARY_NEW="glossary.show.new",ORYX.CONFIG.EVENT_DOCKERDRAG="dragTheDocker",ORYX.CONFIG.EVENT_CANVAS_SCROLL="canvas.scroll",ORYX.CONFIG.EVENT_SHOW_PROPERTYWINDOW="propertywindow.show",ORYX.CONFIG.EVENT_ABOUT_TO_SAVE="file.aboutToSave",ORYX.CONFIG.EVENT_EDITOR_INIT_COMPLETED="editor.init.completed",ORYX.CONFIG.ACTION_DELETE_COMPLETED="delete.action.completed",ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE=5,ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR="#4444FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR2="#9999FF",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_CORNER="corner",ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE="rectangle",ORYX.CONFIG.SELECTION_VALID_COLOR="#00FF00",ORYX.CONFIG.SELECTION_INVALID_COLOR="#FF0000",ORYX.CONFIG.DOCKER_DOCKED_COLOR="#00FF00",ORYX.CONFIG.DOCKER_UNDOCKED_COLOR="#FF0000",ORYX.CONFIG.DOCKER_SNAP_OFFSET=10,ORYX.CONFIG.EDIT_OFFSET_PASTE=10,ORYX.CONFIG.KEY_CODE_X=88,ORYX.CONFIG.KEY_CODE_C=67,ORYX.CONFIG.KEY_CODE_V=86,ORYX.CONFIG.KEY_CODE_DELETE=46,ORYX.CONFIG.KEY_CODE_META=224,ORYX.CONFIG.KEY_CODE_BACKSPACE=8,ORYX.CONFIG.KEY_CODE_LEFT=37,ORYX.CONFIG.KEY_CODE_RIGHT=39,ORYX.CONFIG.KEY_CODE_UP=38,ORYX.CONFIG.KEY_CODE_DOWN=40,ORYX.CONFIG.KEY_Code_enter=12,ORYX.CONFIG.KEY_Code_left=37,ORYX.CONFIG.KEY_Code_right=39,ORYX.CONFIG.KEY_Code_top=38,ORYX.CONFIG.KEY_Code_bottom=40,ORYX.CONFIG.META_KEY_META_CTRL="metactrl",ORYX.CONFIG.META_KEY_ALT="alt",ORYX.CONFIG.META_KEY_SHIFT="shift",ORYX.CONFIG.KEY_ACTION_DOWN="down",ORYX.CONFIG.KEY_ACTION_UP="up",ORYX.CONFIG.FORM_ROW_WIDTH=350,ORYX.CONFIG.FORM_GROUP_MARGIN=5,ORYX.CONFIG.FORM_GROUP_EMPTY_HEIGHT=100,ORYX.CONFIG.FORM_ELEMENT_ID_PREFIX="http://b3mn.org/stencilset/xforms",ORYX.CONFIG.FORM_ELEMENT_TYPE_ROOT="http://b3mn.org/stencilset/xforms#XForm",ORYX.CONFIG.FORM_ELEMENT_TYPE_GROUP="http://b3mn.org/stencilset/xforms#Group",ORYX.CONFIG.FORM_ELEMENT_TYPE_REPEATING_GROUP="http://b3mn.org/stencilset/xforms#RepeatingGroup",ORYX.CONFIG.FORM_ELEMENT_TYPE_LABEL_FIELD="http://b3mn.org/stencilset/xforms#LabelField";var ORYX_LOGLEVEL_TRACE=5,ORYX_LOGLEVEL_DEBUG=4,ORYX_LOGLEVEL_INFO=3,ORYX_LOGLEVEL_WARN=2,ORYX_LOGLEVEL_ERROR=1,ORYX_LOGLEVEL_FATAL=0,ORYX_LOGLEVEL=3,ORYX_CONFIGURATION_DELAY=100,ORYX_CONFIGURATION_WAIT_ATTEMPTS=10;if(!ORYX)var ORYX={};if(ORYX=Object.extend(ORYX,{PATH:ORYX.CONFIG.ROOT_PATH,URLS:[],alreadyLoaded:[],configrationRetries:0,Version:"0.1.1",availablePlugins:[],Log:{__appenders:[{append:function(e){"undefined"!=typeof console&&void 0!==console.log&&console.log(e)}}],trace:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_TRACE&&ORYX.Log.__log("TRACE",arguments)},debug:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_DEBUG&&ORYX.Log.__log("DEBUG",arguments)},info:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_INFO&&ORYX.Log.__log("INFO",arguments)},warn:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_WARN&&ORYX.Log.__log("WARN",arguments)},error:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_ERROR&&ORYX.Log.__log("ERROR",arguments)},fatal:function(){ORYX_LOGLEVEL>=ORYX_LOGLEVEL_FATAL&&ORYX.Log.__log("FATAL",arguments)},__log:function(e,t){t[0]=(new Date).getTime()+" "+e+" "+t[0];var i=printf.apply(null,t);ORYX.Log.__appenders.each(function(e){e.append(i)})},addAppender:function(e){ORYX.Log.__appenders.push(e)}},load:function(){if(ORYX.Log.debug("Oryx begins loading procedure."),"undefined"==typeof Prototype||"undefined"==typeof Element||"undefined"==typeof Element.Methods||parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.5)throw"Application requires the Prototype JavaScript framework >= 1.5.3";ORYX.Log.debug("Prototype > 1.5 found."),ORYX._load()},_load:function(){ORYX.loadPlugins()},loadPlugins:function(){ORYX.CONFIG.PLUGINS_ENABLED?ORYX._loadPlugins():ORYX.Log.warn("Ignoring plugins, loading Core only."),init()},_loadPlugins:function(e){var t=jQuery.parseXML(e),i=[],n=$A(t.getElementsByTagName("properties"));n.each(function(e){var t=$A(e.childNodes);t.each(function(e){var t=new Hash,n=$A(e.attributes);n.each(function(e){t.set(e.nodeName,e.nodeValue)}),n.length>0&&i.push(t)})});var s=t.getElementsByTagName("plugin");$A(s).each(function(e){var t=new Hash;if($A(e.attributes).each(function(e){t.set(e.nodeName,e.nodeValue)}),!t.get("name"))return void ORYX.Log.error("A plugin is not providing a name. Ingnoring this plugin.");if(!t.get("source"))return void ORYX.Log.error("Plugin with name '%0' doesn't provide a source attribute.",t.get("name"));var n=e.getElementsByTagName("property"),s=[];$A(n).each(function(e){var t=new Hash,i=$A(e.attributes);i.each(function(e){t.set(e.nodeName,e.nodeValue)}),i.length>0&&s.push(t)}),s=s.concat(i),t.set("properties",s);var o,a=e.getElementsByTagName("requires");$A(a).each(function(e){var t=$A(e.attributes).find(function(e){return"namespace"==e.name});t&&t.nodeValue&&(o||(o={namespaces:[]}),o.namespaces.push(t.nodeValue))}),o&&t.set("requires",o);var r,h=e.getElementsByTagName("notUsesIn");$A(h).each(function(e){var t=$A(e.attributes).find(function(e){return"namespace"==e.name});t&&t.nodeValue&&(r||(r={namespaces:[]}),r.namespaces.push(t.nodeValue))}),r&&t.set("notUsesIn",r);var c=ORYX.PATH+ORYX.CONFIG.PLUGINS_FOLDER+t.get("source");ORYX.Log.debug("Requireing '%0'",c),ORYX.Log.info("Plugin '%0' successfully loaded.",t.get("name")),ORYX.availablePlugins.push(t)})},_loadPluginsOnFails:function(e){ORYX.Log.error("Plugin configuration file not available.")}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.EditPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.x=0,this.y=0,this.oldX=0,
this.oldY=0,this.deltaWidth=1,this.deltaHeight=1,this.d=""},init:function(e,t,i,n,s,o){this.x=e,this.y=t,this.oldX=i,this.oldY=n,this.deltaWidth=s,this.deltaHeight=o,this.d=""},editPointsAbs:function(e){if(e instanceof Array){for(var t,i,n=[],s=0;s<e.length;s++)t=(parseFloat(e[s])-this.oldX)*this.deltaWidth+this.x,s++,i=(parseFloat(e[s])-this.oldY)*this.deltaHeight+this.y,n.push(t),n.push(i);return n}},editPointsRel:function(e){if(e instanceof Array){for(var t,i,n=[],s=0;s<e.length;s++)t=parseFloat(e[s])*this.deltaWidth,s++,i=parseFloat(e[s])*this.deltaHeight,n.push(t),n.push(i);return n}},arcAbs:function(e,t,i,n,s,o,a){var r=this.editPointsAbs([o,a]),h=this.editPointsRel([e,t]);this.d=this.d.concat(" A"+h[0]+" "+h[1]+" "+i+" "+n+" "+s+" "+r[0]+" "+r[1]+" ")},arcRel:function(e,t,i,n,s,o,a){var r=this.editPointsRel([e,t,o,a]);this.d=this.d.concat(" a"+r[0]+" "+r[1]+" "+i+" "+n+" "+s+" "+r[2]+" "+r[3]+" ")},curvetoCubicAbs:function(e,t,i,n,s,o){var a=this.editPointsAbs([e,t,i,n,s,o]);this.d=this.d.concat(" C"+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+" "+a[4]+" "+a[5]+" ")},curvetoCubicRel:function(e,t,i,n,s,o){var a=this.editPointsRel([e,t,i,n,s,o]);this.d=this.d.concat(" c"+a[0]+" "+a[1]+" "+a[2]+" "+a[3]+" "+a[4]+" "+a[5]+" ")},linetoHorizontalAbs:function(e){var t=this.editPointsAbs([e,0]);this.d=this.d.concat(" H"+t[0]+" ")},linetoHorizontalRel:function(e){var t=this.editPointsRel([e,0]);this.d=this.d.concat(" h"+t[0]+" ")},linetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" L"+i[0]+" "+i[1]+" ")},linetoRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" l"+i[0]+" "+i[1]+" ")},movetoAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" M"+i[0]+" "+i[1]+" ")},movetoRel:function(e,t){var i;i=""===this.d?this.editPointsAbs([e,t]):this.editPointsRel([e,t]),this.d=this.d.concat(" m"+i[0]+" "+i[1]+" ")},curvetoQuadraticAbs:function(e,t,i,n){var s=this.editPointsAbs([e,t,i,n]);this.d=this.d.concat(" Q"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoQuadraticRel:function(e,t,i,n){var s=this.editPointsRel([e,t,i,n]);this.d=this.d.concat(" q"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoCubicSmoothAbs:function(e,t,i,n){var s=this.editPointsAbs([e,t,i,n]);this.d=this.d.concat(" S"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoCubicSmoothRel:function(e,t,i,n){var s=this.editPointsRel([e,t,i,n]);this.d=this.d.concat(" s"+s[0]+" "+s[1]+" "+s[2]+" "+s[3]+" ")},curvetoQuadraticSmoothAbs:function(e,t){var i=this.editPointsAbs([e,t]);this.d=this.d.concat(" T"+i[0]+" "+i[1]+" ")},curvetoQuadraticSmoothRel:function(e,t){var i=this.editPointsRel([e,t]);this.d=this.d.concat(" t"+i[0]+" "+i[1]+" ")},linetoVerticalAbs:function(e){var t=this.editPointsAbs([0,e]);this.d=this.d.concat(" V"+t[1]+" ")},linetoVerticalRel:function(e){var t=this.editPointsRel([0,e]);this.d=this.d.concat(" v"+t[1]+" ")},closePath:function(){this.d=this.d.concat(" z")}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.MinMaxPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.minX=void 0,this.minY=void 0,this.maxX=void 0,this.maxY=void 0,this._lastAbsX=void 0,this._lastAbsY=void 0},calculateMinMax:function(e){if(e instanceof Array)for(var t,i,n=0;n<e.length;n++)t=parseFloat(e[n]),n++,i=parseFloat(e[n]),this.minX=void 0!==this.minX?Math.min(this.minX,t):t,this.maxX=void 0!==this.maxX?Math.max(this.maxX,t):t,this.minY=void 0!==this.minY?Math.min(this.minY,i):i,this.maxY=void 0!==this.maxY?Math.max(this.maxY,i):i,this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,n,s,o,a){this.calculateMinMax([o,a])},arcRel:function(e,t,i,n,s,o,a){this.calculateMinMax([this._lastAbsX+o,this._lastAbsY+a])},curvetoCubicAbs:function(e,t,i,n,s,o){this.calculateMinMax([e,t,i,n,s,o])},curvetoCubicRel:function(e,t,i,n,s,o){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n,this._lastAbsX+s,this._lastAbsY+o])},linetoHorizontalAbs:function(e){this.calculateMinMax([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.calculateMinMax([e,t])},linetoRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.calculateMinMax([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t]):this.calculateMinMax([e,t])},curvetoQuadraticAbs:function(e,t,i,n){this.calculateMinMax([e,t,i,n])},curvetoQuadraticRel:function(e,t,i,n){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n])},curvetoCubicSmoothAbs:function(e,t,i,n){this.calculateMinMax([e,t,i,n])},curvetoCubicSmoothRel:function(e,t,i,n){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t,this._lastAbsX+i,this._lastAbsY+n])},curvetoQuadraticSmoothAbs:function(e,t){this.calculateMinMax([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.calculateMinMax([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.calculateMinMax([this._lastAbsX,e])},linetoVerticalRel:function(e){this.calculateMinMax([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.PointsPathHandler=Clazz.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.points=[],this._lastAbsX=void 0,this._lastAbsY=void 0},addPoints:function(e){if(e instanceof Array)for(var t,i,n=0;n<e.length;n++)t=parseFloat(e[n]),n++,i=parseFloat(e[n]),this.points.push(t),this.points.push(i),this._lastAbsX=t,this._lastAbsY=i},arcAbs:function(e,t,i,n,s,o,a){this.addPoints([o,a])},arcRel:function(e,t,i,n,s,o,a){this.addPoints([this._lastAbsX+o,this._lastAbsY+a])},curvetoCubicAbs:function(e,t,i,n,s,o){this.addPoints([s,o])},curvetoCubicRel:function(e,t,i,n,s,o){this.addPoints([this._lastAbsX+s,this._lastAbsY+o])},linetoHorizontalAbs:function(e){this.addPoints([e,this._lastAbsY])},linetoHorizontalRel:function(e){this.addPoints([this._lastAbsX+e,this._lastAbsY])},linetoAbs:function(e,t){this.addPoints([e,t])},linetoRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},movetoAbs:function(e,t){this.addPoints([e,t])},movetoRel:function(e,t){this._lastAbsX&&this._lastAbsY?this.addPoints([this._lastAbsX+e,this._lastAbsY+t]):this.addPoints([e,t])},curvetoQuadraticAbs:function(e,t,i,n){this.addPoints([i,n])},curvetoQuadraticRel:function(e,t,i,n){this.addPoints([this._lastAbsX+i,this._lastAbsY+n])},curvetoCubicSmoothAbs:function(e,t,i,n){this.addPoints([i,n])},curvetoCubicSmoothRel:function(e,t,i,n){this.addPoints([this._lastAbsX+i,this._lastAbsY+n])},curvetoQuadraticSmoothAbs:function(e,t){this.addPoints([e,t])},curvetoQuadraticSmoothRel:function(e,t){this.addPoints([this._lastAbsX+e,this._lastAbsY+t])},linetoVerticalAbs:function(e){this.addPoints([this._lastAbsX,e])},linetoVerticalRel:function(e){this.addPoints([this._lastAbsX,this._lastAbsY+e])},closePath:function(){}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGMarker=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.id=void 0,this.element=e,this.refX=void 0,this.refY=void 0,this.markerWidth=void 0,this.markerHeight=void 0,this.oldRefX=void 0,this.oldRefY=void 0,this.oldMarkerWidth=void 0,this.oldMarkerHeight=void 0,this.optional=!1,this.enabled=!0,this.minimumLength=void 0,this.resize=!1,this.svgShapes=[],this._init()},_init:function(){if("[object SVGMarkerElement]"!=this.element)throw"SVGMarker: Argument is not an instance of SVGMarkerElement.";this.id=this.element.getAttributeNS(null,"id");var e=this.element.getAttributeNS(null,"refX");e?this.refX=parseFloat(e):this.refX=0;var t=this.element.getAttributeNS(null,"refY");t?this.refY=parseFloat(t):this.refY=0;var i=this.element.getAttributeNS(null,"markerWidth");i?this.markerWidth=parseFloat(i):this.markerWidth=3;var n=this.element.getAttributeNS(null,"markerHeight");n?this.markerHeight=parseFloat(n):this.markerHeight=3,this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight;var s=this.element.getAttributeNS(NAMESPACE_ORYX,"optional");s?(s=s.strip(),this.optional="yes"===s.toLowerCase()):this.optional=!1;var o=this.element.getAttributeNS(NAMESPACE_ORYX,"enabled");o?(o=o.strip(),this.enabled=!("no"===o.toLowerCase())):this.enabled=!0;var a=this.element.getAttributeNS(NAMESPACE_ORYX,"minimumLength");a&&(this.minimumLength=parseFloat(a));var r=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");r?(r=r.strip(),this.resize="yes"===r.toLowerCase()):this.resize=!1},_getSVGShapes:function(e){if(e.hasChildNodes){var t=[],i=this;return $A(e.childNodes).each(function(e){try{var n=new ORYX.Core.SVG.SVGShape(e);t.push(n)}catch(s){t=t.concat(i._getSVGShapes(e))}}),t}},update:function(){this.oldRefX=this.refX,this.oldRefY=this.refY,this.oldMarkerWidth=this.markerWidth,this.oldMarkerHeight=this.markerHeight},toString:function(){return this.element?"SVGMarker "+this.element.id:"SVGMarker "+this.element}}),NAMESPACE_ORYX="http://www.b3mn.org/oryx",NAMESPACE_SVG="http://www.w3.org/2000/svg/",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.SVGShape=Clazz.extend({construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.type,this.element=e,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.oldX=void 0,this.oldY=void 0,this.oldWidth=void 0,this.oldHeight=void 0,this.radiusX=void 0,this.radiusY=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.anchorLeft=!1,this.anchorRight=!1,this.anchorTop=!1,this.anchorBottom=!1,this.allowDockers=!0,this.resizeMarkerMid=!1,this.editPathParser,this.editPathHandler,this.init()},init:function(){if(ORYX.Editor.checkClassType(this.element,SVGRectElement)||ORYX.Editor.checkClassType(this.element,SVGImageElement)){this.type="Rect";var e=this.element.getAttributeNS(null,"x");if(!e)throw"Missing attribute in element "+this.element;this.oldX=parseFloat(e);var t=this.element.getAttributeNS(null,"y");if(!t)throw"Missing attribute in element "+this.element;this.oldY=parseFloat(t);var i=this.element.getAttributeNS(null,"width");if(!i)throw"Missing attribute in element "+this.element;this.oldWidth=parseFloat(i);var n=this.element.getAttributeNS(null,"height");if(!n)throw"Missing attribute in element "+this.element;this.oldHeight=parseFloat(n)}else if(ORYX.Editor.checkClassType(this.element,SVGCircleElement)){this.type="Circle";var s=void 0,o=void 0,a=this.element.getAttributeNS(null,"cx");if(!a)throw"Missing attribute in element "+this.element;s=parseFloat(a);var r=this.element.getAttributeNS(null,"cy");if(!r)throw"Missing attribute in element "+this.element;o=parseFloat(r);var h=this.element.getAttributeNS(null,"r");if(!h)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(h),this.oldX=s-this.radiusX,this.oldY=o-this.radiusX,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusX}else if(ORYX.Editor.checkClassType(this.element,SVGEllipseElement)){this.type="Ellipse";var s=void 0,o=void 0,a=this.element.getAttributeNS(null,"cx");if(!a)throw"Missing attribute in element "+this.element;s=parseFloat(a);var r=this.element.getAttributeNS(null,"cy");if(!r)throw"Missing attribute in element "+this.element;o=parseFloat(r);var c=this.element.getAttributeNS(null,"rx");if(!c)throw"Missing attribute in element "+this.element;this.radiusX=parseFloat(c);var d=this.element.getAttributeNS(null,"ry");if(!d)throw"Missing attribute in element "+this.element;this.radiusY=parseFloat(d),this.oldX=s-this.radiusX,this.oldY=o-this.radiusY,this.oldWidth=2*this.radiusX,this.oldHeight=2*this.radiusY}else if(ORYX.Editor.checkClassType(this.element,SVGLineElement)){this.type="Line";var l=void 0,u=void 0,g=void 0,f=void 0,p=this.element.getAttributeNS(null,"x1");if(!p)throw"Missing attribute in element "+this.element;l=parseFloat(p);var O=this.element.getAttributeNS(null,"y1");if(!O)throw"Missing attribute in element "+this.element;u=parseFloat(O);var R=this.element.getAttributeNS(null,"x2");if(!R)throw"Missing attribute in element "+this.element;g=parseFloat(R);var S=this.element.getAttributeNS(null,"y2");if(!S)throw"Missing attribute in element "+this.element;f=parseFloat(S),this.oldX=Math.min(l,g),this.oldY=Math.min(u,f),this.oldWidth=Math.abs(l-g),this.oldHeight=Math.abs(u-f)}else if(ORYX.Editor.checkClassType(this.element,SVGPolylineElement)||ORYX.Editor.checkClassType(this.element,SVGPolygonElement)){this.type="Polyline";var m=[];if(this.element.points&&this.element.points.numberOfItems)for(var v=0,E=this.element.points.numberOfItems;v<E;v++)m.push(this.element.points.getItem(v).x),m.push(this.element.points.getItem(v).y);else{var N=this.element.getAttributeNS(null,"points");if(!N)throw"Missing attribute in element "+this.element;N=N.replace(/,/g," "),m=N.split(" "),m=m.without("")}if(!(m&&m.length&&m.length>1))throw"Missing attribute in element "+this.element;for(var C=parseFloat(m[0]),b=parseFloat(m[1]),_=parseFloat(m[0]),y=parseFloat(m[1]),v=0;v<m.length;v++)C=Math.min(C,parseFloat(m[v])),_=Math.max(_,parseFloat(m[v])),v++,b=Math.min(b,parseFloat(m[v])),y=Math.max(y,parseFloat(m[v]));this.oldX=C,this.oldY=b,this.oldWidth=_-C,this.oldHeight=y-b}else{if(!ORYX.Editor.checkClassType(this.element,SVGPathElement))throw"Element is not a shape.";this.type="Path",this.editPathParser=new PathParser,this.editPathHandler=new ORYX.Core.SVG.EditPathHandler,this.editPathParser.setHandler(this.editPathHandler);var I=new PathParser,Y=new ORYX.Core.SVG.MinMaxPathHandler;I.setHandler(Y),I.parsePath(this.element),this.oldX=Y.minX,this.oldY=Y.minY,this.oldWidth=Y.maxX-Y.minX,this.oldHeight=Y.maxY-Y.minY,delete I,delete Y}var X=this.element.getAttributeNS(NAMESPACE_ORYX,"resize");X?(X=X.toLowerCase(),X.match(/horizontal/)?this.isHorizontallyResizable=!0:this.isHorizontallyResizable=!1,X.match(/vertical/)?this.isVerticallyResizable=!0:this.isVerticallyResizable=!1):(this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1);var x=this.element.getAttributeNS(NAMESPACE_ORYX,"anchors");if(x){x=x.replace("/,/g"," ");for(var A=x.split(" ").without(""),v=0;v<A.length;v++)switch(A[v].toLowerCase()){case"left":this.anchorLeft=!0;break;case"right":this.anchorRight=!0;break;case"top":this.anchorTop=!0;break;case"bottom":this.anchorBottom=!0}}if(ORYX.Editor.checkClassType(this.element,SVGPathElement)){var k=this.element.getAttributeNS(NAMESPACE_ORYX,"allowDockers");k&&("no"===k.toLowerCase()?this.allowDockers=!1:this.allowDockers=!0);var T=this.element.getAttributeNS(NAMESPACE_ORYX,"resizeMarker-mid");T&&("yes"===T.toLowerCase()?this.resizeMarkerMid=!0:this.resizeMarkerMid=!1)}this.x=this.oldX,this.y=this.oldY,this.width=this.oldWidth,this.height=this.oldHeight},update:function(){if(this.x!==this.oldX||this.y!==this.oldY||this.width!==this.oldWidth||this.height!==this.oldHeight){switch(this.type){case"Rect":this.x!==this.oldX&&this.element.setAttributeNS(null,"x",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y",this.y),this.width!==this.oldWidth&&this.element.setAttributeNS(null,"width",this.width),this.height!==this.oldHeight&&this.element.setAttributeNS(null,"height",this.height);break;case"Circle":this.radiusX=(this.width<this.height?this.width:this.height)/2,this.element.setAttributeNS(null,"cx",this.x+this.width/2),this.element.setAttributeNS(null,"cy",this.y+this.height/2),this.element.setAttributeNS(null,"r",this.radiusX);break;case"Ellipse":this.radiusX=this.width/2,this.radiusY=this.height/2,this.element.setAttributeNS(null,"cx",this.x+this.radiusX),this.element.setAttributeNS(null,"cy",this.y+this.radiusY),this.element.setAttributeNS(null,"rx",this.radiusX),this.element.setAttributeNS(null,"ry",this.radiusY);break;case"Line":this.x!==this.oldX&&this.element.setAttributeNS(null,"x1",this.x),this.y!==this.oldY&&this.element.setAttributeNS(null,"y1",this.y),this.x===this.oldX&&this.width===this.oldWidth||this.element.setAttributeNS(null,"x2",this.x+this.width),this.y===this.oldY&&this.height===this.oldHeight||this.element.setAttributeNS(null,"y2",this.y+this.height);break;case"Polyline":var e=this.element.getAttributeNS(null,"points");if(e&&(e=e.replace(/,/g," ").split(" ").without(""),e&&e.length&&e.length>1)){for(var t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight,n="",s=0;s<e.length;s++){var o=(parseFloat(e[s])-this.oldX)*t+this.x;s++;var a=(parseFloat(e[s])-this.oldY)*i+this.y;n+=o+" "+a+" "}this.element.setAttributeNS(null,"points",n)}break;case"Path":var t=0===this.oldWidth?0:this.width/this.oldWidth,i=0===this.oldHeight?0:this.height/this.oldHeight;this.editPathHandler.init(this.x,this.y,this.oldX,this.oldY,t,i),this.editPathParser.parsePath(this.element),this.element.setAttributeNS(null,"d",this.editPathHandler.d)}this.oldX=this.x,this.oldY=this.y,this.oldWidth=this.width,this.oldHeight=this.height}delete this.visible,delete this.handler},isPointIncluded:function(e,t){if(!e||!t||!this.isVisible())return!1;switch(this.type){case"Rect":return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height;case"Circle":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.width/2,this.y+this.height/2,this.radiusX,this.radiusX);case"Ellipse":return ORYX.Core.Math.isPointInEllipse(e,t,this.x+this.radiusX,this.y+this.radiusY,this.radiusX,this.radiusY);case"Line":return ORYX.Core.Math.isPointInLine(e,t,this.x,this.y,this.x+this.width,this.y+this.height);case"Polyline":var i=this.element.getAttributeNS(null,"points");return!!i&&(i=i.replace(/,/g," ").split(" ").without(""),i=i.collect(function(e){return parseFloat(e)}),ORYX.Core.Math.isPointInPolygone(e,t,i));case"Path":if(!this.handler){var n=new PathParser;this.handler=new ORYX.Core.SVG.PointsPathHandler,n.setHandler(this.handler),n.parsePath(this.element)}return ORYX.Core.Math.isPointInPolygone(e,t,this.handler.points);default:return!1}},isVisible:function(e){if(void 0!==this.visible)return this.visible;e||(e=this.element);var t=!1;try{t=!!e.ownerSVGElement}catch(i){}if(t){if(ORYX.Editor.checkClassType(e,SVGGElement)&&e.className&&"me"==e.className.baseVal)return this.visible=!0,this.visible;var n=e.getAttributeNS(null,"fill"),s=e.getAttributeNS(null,"stroke");if(n&&"none"==n&&s&&"none"==s)this.visible=!1;else{var o=e.getAttributeNS(null,"display");o?"none"==o?this.visible=!1:this.visible=!0:this.visible=this.isVisible(e.parentNode)}}else this.visible=!0;return this.visible},toString:function(){return this.element?"SVGShape "+this.element.id:"SVGShape "+this.element}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.SVG||(ORYX.Core.SVG={}),ORYX.Core.SVG.Label=Clazz.extend({_characterSets:["%W","@","m","wDGMOQ#+=<>~^","ABCHKNRSUVXZ&","bdghnopquxETY1234567890_${}*`","aeksvyzFLP?","c-",'rtJ"/()[]:;!|\\',"fjI., ","'","il"],_characterSetValues:[15,14,13,11,10,9,8,7,6,5,4,3],construct:function(e){if(arguments.callee.$.construct.apply(this,arguments),!e.textElement)throw"Label: No parameter textElement.";if(!ORYX.Editor.checkClassType(e.textElement,SVGTextElement))throw"Label: Parameter textElement is not an SVGTextElement.";this.invisibleRenderPoint=-5e3,this.node=e.textElement,this.node.setAttributeNS(null,"stroke-width","0pt"),this.node.setAttributeNS(null,"letter-spacing","-0.01px"),this.shapeId=e.shapeId,this.id,this.fitToElemId,this.edgePosition,this.x,this.y,this.oldX,this.oldY,this.isVisible=!0,this._text,this._verticalAlign,this._horizontalAlign,this._rotate,this._rotationPoint,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this._isChanged=!0;var t=this.node.getAttributeNS(null,"id");t&&(this.id=t),this.fitToElemId=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"fittoelem"),this.fitToElemId&&(this.fitToElemId=this.shapeId+this.fitToElemId);var i=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"align");i&&(i=i.replace(/,/g," "),i=i.split(" "),i=i.without(""),i.each(function(e){switch(e){case"top":case"middle":case"bottom":this._verticalAlign||(this._originVerticalAlign=this._verticalAlign=e);break;case"left":case"center":case"right":this._horizontalAlign||(this._originHorizontalAlign=this._horizontalAlign=e)}}.bind(this))),this.edgePosition=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"edgePosition"),this.edgePosition&&(this.originEdgePosition=this.edgePosition=this.edgePosition.toLowerCase()),this.offsetTop=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetTop")||ORYX.CONFIG.OFFSET_EDGE_LABEL_TOP,this.offsetTop&&(this.offsetTop=parseInt(this.offsetTop)),this.offsetBottom=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"offsetBottom")||ORYX.CONFIG.OFFSET_EDGE_LABEL_BOTTOM,this.offsetBottom&&(this.offsetBottom=parseInt(this.offsetBottom));var n=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"rotate");if(n)try{this._rotate=parseFloat(n)}catch(s){this._rotate=0}else this._rotate=0;var o=this.node.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(o){o=o.replace("/,/g"," ");for(var a=o.split(" ").without(""),r=0;r<a.length;r++)switch(a[r].toLowerCase()){case"left":this.originAnchorLeft=this.anchorLeft=!0;break;case"right":this.originAnchorRight=this.anchorRight=!0;break;case"top":this.originAnchorTop=this.anchorTop=!0;break;case"bottom":this.originAnchorBottom=this.anchorBottom=!0}}this._verticalAlign||(this._verticalAlign="bottom"),this._horizontalAlign||(this._horizontalAlign="left");var h=this.node.getAttributeNS(null,"x");h&&(this.oldX=this.x=parseFloat(h));var c=this.node.getAttributeNS(null,"y");c&&(this.oldY=this.y=parseFloat(c)),this.text(this.node.textContent)},resetAnchorPosition:function(){this.anchorLeft=this.originAnchorLeft||!1,this.anchorRight=this.originAnchorRight||!1,this.anchorTop=this.originAnchorTop||!1,this.anchorBottom=this.originAnchorBottom||!1},isOriginAnchorLeft:function(){return this.originAnchorLeft||!1},isOriginAnchorRight:function(){return this.originAnchorRight||!1},isOriginAnchorTop:function(){return this.originAnchorTop||!1},isOriginAnchorBottom:function(){return this.originAnchorBottom||!1},isAnchorLeft:function(){return this.anchorLeft||!1},isAnchorRight:function(){return this.anchorRight||!1},isAnchorTop:function(){return this.anchorTop||!1},isAnchorBottom:function(){return this.anchorBottom||!1},getX:function(){try{var e=this.node.x.baseVal.getItem(0).value;switch(this.horizontalAlign()){case"left":return e;case"center":return e-this.getWidth()/2;case"right":return e-this.getWidth()}return this.node.getBBox().x}catch(t){return this.x}},setX:function(e){this.position?this.position.x=e:this.setOriginX(e)},getY:function(){try{return this.node.getBBox().y}catch(e){return this.y}},setY:function(e){this.position?this.position.y=e:this.setOriginY(e)},setOriginX:function(e){this.x=e},setOriginY:function(e){this.y=e},getWidth:function(){try{try{var e,t=this.node.childNodes;if(0==t.length)e=this.node.getBBox().width;else for(var i=0,n=t.length;i<n;++i){var s=t[i].getComputedTextLength();("undefined"==typeof e||e<s)&&(e=s)}return e+(e%2==0?0:1)}catch(o){return this.node.getBBox().width}}catch(a){return 0}},getOriginUpperLeft:function(){var e=this.x,t=this.y;switch(this._horizontalAlign){case"center":e-=this.getWidth()/2;break;case"right":e-=this.getWidth()}switch(this._verticalAlign){case"middle":t-=this.getHeight()/2;break;case"bottom":t-=this.getHeight()}return{x:e,y:t}},getHeight:function(){try{return this.node.getBBox().height}catch(e){return 0}},getCenter:function(){var e={x:this.getX(),y:this.getY()};return e.x+=this.getWidth()/2,e.y+=this.getHeight()/2,e},setPosition:function(e){e&&void 0!==e.x&&void 0!==e.y?this.position=e:delete this.position,this.position&&(delete this._referencePoint,delete this.edgePosition),this._isChanged=!0,this.update()},getPosition:function(){return this.position},setReferencePoint:function(e){e?this._referencePoint=e:delete this._referencePoint,this._referencePoint&&delete this.position},getReferencePoint:function(){return this._referencePoint||void 0},changed:function(){this._isChanged=!0},registerOnChange:function(e){this.changeCallbacks||(this.changeCallbacks=[]),e instanceof Function&&!this.changeCallbacks.include(e)&&this.changeCallbacks.push(e)},unregisterOnChange:function(e){this.changeCallbacks&&e instanceof Function&&this.changeCallbacks.include(e)&&(this.changeCallbacks=this.changeCallbacks.without(e))},isUpdating:function(){return!!this._isUpdating},getOriginEdgePosition:function(){return this.originEdgePosition},getEdgePosition:function(){return this.edgePosition||null},setEdgePosition:function(e){["starttop","startmiddle","startbottom","midtop","midbottom","endtop","endbottom"].include(e)?(this.edgePosition=e,delete this.position,delete this._referencePoint):delete this.edgePosition},update:function(e){var t=this.x,i=this.y;if(this.position&&(t=this.position.x,i=this.position.y),t=Math.floor(t),i=Math.floor(i),this._isChanged||t!==this.oldX||i!==this.oldY||e===!0)if(this.isVisible){this._isChanged=!1,this._isUpdating=!0,this.node.setAttributeNS(null,"x",t),this.node.setAttributeNS(null,"y",i),this.node.removeAttributeNS(null,"fill-opacity"),this.oldX=t,this.oldY=i,this.position||this.getReferencePoint()?this.node.removeAttributeNS(null,"transform"):void 0!==this._rotate&&(this._rotationPoint?this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+Math.floor(this._rotationPoint.x)+" "+Math.floor(this._rotationPoint.y)+")"):this.node.setAttributeNS(null,"transform","rotate("+this._rotate+" "+Math.floor(t)+" "+Math.floor(i)+")"));for(var n=this._text.split("\n");""==n.last();)n.pop();this.node.ownerDocument&&((this.fitToElemId||this._textHasChanged)&&(this.node.textContent="",n.each(function(e,t){var i=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");i.textContent=e.trim(),this.fitToElemId&&(i.setAttributeNS(null,"x",this.invisibleRenderPoint),i.setAttributeNS(null,"y",this.invisibleRenderPoint)),""===i.textContent&&(i.textContent=" "),this.node.appendChild(i)}.bind(this)),delete this._textHasChanged,delete this.indices),this.isVisible&&this.fitToElemId&&this.node.setAttributeNS(null,"visibility","hidden"),this.fitToElemId?window.setTimeout(this._checkFittingToReferencedElem.bind(this),0):window.setTimeout(this._positionText.bind(this),0))}else this.node.textContent=""},_checkFittingToReferencedElem:function(){try{var e=$A(this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")),t=[],i=this.node.ownerDocument.getElementById(this.fitToElemId);if(i){for(var n=i.getBBox(),s=this.getFontSize(),o=0;o<e.length;o++){var a=e[o],r=this._getRenderedTextLength(a,void 0,void 0,s),h=0!=this._rotate&&this._rotate%180!=0&&this._rotate%90==0?n.height:n.width;if(r>h){for(var c=0,d=0,l=this.getTrimmedTextLength(a.textContent),u=0;u<l;u++){var g=this._getRenderedTextLength(a,c,u-c,s);if(g>h-2){var f=this.node.ownerDocument.createElementNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan");d<=c?(d=0==u?u:u-1,f.textContent=a.textContent.slice(c,d).trim()):f.textContent=a.textContent.slice(c,++d).trim(),f.setAttributeNS(null,"x",this.invisibleRenderPoint),f.setAttributeNS(null,"y",this.invisibleRenderPoint),t.push(f),c=d}else{var p=a.textContent.charAt(u);" "!=p&&"-"!=p&&"."!=p&&","!=p&&";"!=p&&":"!=p||(d=u)}}a.textContent=a.textContent.slice(c).trim()}t.push(a)}for(;this.node.hasChildNodes();)this.node.removeChild(this.node.childNodes[0]);for(;t.length>0;)this.node.appendChild(t.shift())}}catch(O){ORYX.Log.fatal("Error "+O)}window.setTimeout(this._positionText.bind(this),0)},_positionText:function(){try{var e=this.node.childNodes,t=this.getFontSize(this.node),i=[],n=this.x,s=this.y;this.position&&(n=this.position.x,s=this.position.y),n=Math.floor(n),s=Math.floor(s);var o=0,a=[],r=this.indices||$R(0,e.length-1).toArray(),h=r.length;switch(r.each(function(r){if("undefined"!=typeof r){var c=e[o++];if(""===c.textContent.trim())i.push(c);else{var d=0;switch(this._verticalAlign){case"bottom":d=-(h-r-1)*t;break;case"middle":d=-(h/2-r-1)*t,d-=ORYX.CONFIG.LABEL_LINE_DISTANCE/2;break;case"top":d=r*t,d+=t}c.setAttributeNS(null,"dy",Math.floor(d)),c.setAttributeNS(null,"x",n),c.setAttributeNS(null,"y",s),a.push(r)}}}.bind(this)),a.length=e.length,this.indices=this.indices||a,i.each(function(e){this.node.removeChild(e)}.bind(this)),this._horizontalAlign){case"left":this.node.setAttributeNS(null,"text-anchor","start");break;case"center":this.node.setAttributeNS(null,"text-anchor","middle");break;case"right":this.node.setAttributeNS(null,"text-anchor","end")}}catch(c){this._isChanged=!0}this.isVisible&&this.node.removeAttributeNS(null,"visibility"),delete this._isUpdating,(this.changeCallbacks||[]).each(function(e){e.apply(e)})},_getRenderedTextLength:function(e,t,i,n){return void 0===t?e.getComputedTextLength():e.getSubStringLength(t,i)},_estimateTextWidth:function(e,t){for(var i=0,n=0;n<e.length;n++)i+=this._estimateCharacterWidth(e.charAt(n));return i*(t/14)},_estimateCharacterWidth:function(e){for(var t=0;t<this._characterSets.length;t++)if(this._characterSets[t].indexOf(e)>=0)return this._characterSetValues[t];return 9},getReferencedElementWidth:function(){var e=this.node.ownerDocument.getElementById(this.fitToElemId);if(e){var t=e.getBBox();if(t)return 0!=this._rotate&&this._rotate%180!=0&&this._rotate%90==0?t.height:t.width}},text:function(){switch(arguments.length){case 0:return this._text;case 1:var e=this._text;arguments[0]?(this._text=arguments[0].toString(),null!=this._text&&void 0!=this._text&&(this._text=this._text.replace(/ {2,}/g," "))):this._text="",e!==this._text&&(this._isChanged=!0,this._textHasChanged=!0)}},getOriginVerticalAlign:function(){return this._originVerticalAlign},verticalAlign:function(){switch(arguments.length){case 0:return this._verticalAlign;case 1:if(["top","middle","bottom"].member(arguments[0])){var e=this._verticalAlign;this._verticalAlign=arguments[0],this._verticalAlign!==e&&(this._isChanged=!0)}}},getOriginHorizontalAlign:function(){return this._originHorizontalAlign},horizontalAlign:function(){switch(arguments.length){case 0:return this._horizontalAlign;case 1:if(["left","center","right"].member(arguments[0])){var e=this._horizontalAlign;this._horizontalAlign=arguments[0],this._horizontalAlign!==e&&(this._isChanged=!0)}}},rotate:function(){switch(arguments.length){case 0:return this._rotate;case 1:this._rotate!=arguments[0]&&(this._rotate=arguments[0],this._rotationPoint=void 0,this._isChanged=!0);case 2:this._rotate==arguments[0]&&this._rotationPoint&&this._rotationPoint.x==arguments[1].x&&this._rotationPoint.y==arguments[1].y||(this._rotate=arguments[0],this._rotationPoint=arguments[1],this._isChanged=!0)}},hide:function(){this.isVisible&&(this.isVisible=!1,this._isChanged=!0)},show:function(){this.isVisible||(this.isVisible=!0,this._isChanged=!0,this._textHasChanged=!0)},getInheritedFontSize:function(e){if(e&&e.getAttributeNS){var t=e.getAttributeNS(null,"font-size");return t?parseFloat(t):ORYX.Editor.checkClassType(e,SVGSVGElement)?void 0:this.getInheritedFontSize(e.parentNode)}},getFontSize:function(e){var t=this.node.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan"),i=this.getInheritedFontSize(this.node);return i||(i=t[0]&&/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)>=3?t[0].getExtentOfChar(0).height:ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT,i<=0&&(i=ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT)),i&&this.node.setAttribute("oryx:fontSize",i),i},getTrimmedTextLength:function(e){e=e.strip().gsub("  "," ");var t;do t=e.length,e=e.gsub("  "," ");while(t>e.length);return e.length},getOffsetBottom:function(){return this.offsetBottom},getOffsetTop:function(){return this.offsetTop},deserialize:function(e,t){if(e&&"undefined"!=typeof e.x&&"undefined"!=typeof e.y){
if(this.setPosition({x:e.x,y:e.y}),"undefined"!=typeof e.distance){var i=t.dockers[e.from],n=t.dockers[e.to];i&&n&&this.setReferencePoint({dirty:!0,distance:e.distance,intersection:{x:e.x,y:e.y},orientation:e.orientation,segment:{from:i,fromIndex:e.from,fromPosition:i.bounds.center(),to:n,toIndex:e.to,toPosition:n.bounds.center()}})}e.left&&(this.anchorLeft=!0),e.right&&(this.anchorRight=!0),e.top&&(this.anchorTop=!0),e.bottom&&(this.anchorBottom=!0),e.valign&&this.verticalAlign(e.valign),e.align&&this.horizontalAlign(e.align)}else e&&"undefined"!=typeof e.edge&&this.setEdgePosition(e.edge)},serialize:function(){if(this.getEdgePosition())return this.getOriginEdgePosition()!==this.getEdgePosition()?{edge:this.getEdgePosition()}:null;if(this.position){var e={x:this.position.x,y:this.position.y};return this.isAnchorLeft()&&this.isAnchorLeft()!==this.isOriginAnchorLeft()&&(e.left=!0),this.isAnchorRight()&&this.isAnchorRight()!==this.isOriginAnchorRight()&&(e.right=!0),this.isAnchorTop()&&this.isAnchorTop()!==this.isOriginAnchorTop()&&(e.top=!0),this.isAnchorBottom()&&this.isAnchorBottom()!==this.isOriginAnchorBottom()&&(e.bottom=!0),this.getOriginVerticalAlign()!==this.verticalAlign()&&(e.valign=this.verticalAlign()),this.getOriginHorizontalAlign()!==this.horizontalAlign()&&(e.align=this.horizontalAlign()),e}if(this.getReferencePoint()){var t=this.getReferencePoint();return{distance:t.distance,x:t.intersection.x,y:t.intersection.y,from:t.segment.fromIndex,to:t.segment.toIndex,orientation:t.orientation,valign:this.verticalAlign(),align:this.horizontalAlign()}}return null},toString:function(){return"Label "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Math||(ORYX.Core.Math={}),ORYX.Core.Math.midPoint=function(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}},ORYX.Core.Math.isPointInLine=function(e,t,i,n,s,o,a){if(a=a?Math.abs(a):1,Math.abs(i-s)<=a&&Math.abs(e-i)<=a&&t-Math.max(n,o)<=a&&Math.min(n,o)-t<=a)return!0;if(Math.abs(n-o)<=a&&Math.abs(t-n)<=a&&e-Math.max(i,s)<=a&&Math.min(i,s)-e<=a)return!0;if(e>Math.max(i,s)||e<Math.min(i,s))return!1;if(t>Math.max(n,o)||t<Math.min(n,o))return!1;var r=(n-o)/(i-s);return Math.abs(t-(r*e+n-r*i))<a},ORYX.Core.Math.isPointInEllipse=function(e,t,i,n,s,o){if(void 0===i||void 0===n||void 0===s||void 0===o)throw"ORYX.Core.Math.isPointInEllipse needs a ellipse with these properties: x, y, radiusX, radiusY";var a=(e-i)/s,r=(t-n)/o;return a*a+r*r<1},ORYX.Core.Math.isPointInPolygone=function(e,t,i){if(arguments.length<3)throw"ORYX.Core.Math.isPointInPolygone needs two arguments";var n=i.length-1;i[0]===i[n-1]&&i[1]===i[n]||(i.push(i[0]),i.push(i[1]));for(var s,o,a,r,h,c=0,d=0;d<i.length-3;)if(s=i[d],o=i[++d],a=i[++d],r=i[d+1],h=(t-o)*(a-s)-(e-s)*(r-o),o>=t!=r>=t&&(c+=r-o>=0?h>=0:h<=0),!h&&Math.min(s,a)<=e&&e<=Math.max(s,a)&&Math.min(o,r)<=t&&t<=Math.max(o,r))return!0;return!!(c%2)},ORYX.Core.Math.distancePointLinie=function(e,t,i,n){var s=ORYX.Core.Math.getPointOfIntersectionPointLine(e,t,i,n);return s?ORYX.Core.Math.getDistancePointToPoint(i,s):null},ORYX.Core.Math.getDistancePointToPoint=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},ORYX.Core.Math.getDistanceBetweenTwoPoints=function(e,t,i){return ORYX.Core.Math.getDistancePointToPoint(i,e)/ORYX.Core.Math.getDistancePointToPoint(e,t)},ORYX.Core.Math.pointIsLeftOfLine=function(e,t,i){var n=ORYX.Core.Math.getVector(e,t),s=ORYX.Core.Math.getVector(e,i);return n.x*s.y-s.x*n.y>0},ORYX.Core.Math.getPointBetweenTwoPoints=function(e,t,i){return i=Math.max(Math.min(i||0,1),0),0===i?e:1===i?t:{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}},ORYX.Core.Math.getVector=function(e,t){return{x:t.x-e.x,y:t.y-e.y}},ORYX.Core.Math.getIdentityVector=function(e){2==arguments.length&&(e=ORYX.Core.Math.getVector(arguments[0],arguments[1]));var t=Math.sqrt(e.x*e.x+e.y*e.y);return{x:e.x/(t||1),y:e.y/(t||1)}},ORYX.Core.Math.getOrthogonalIdentityVector=function(e,t){var i=1==arguments.length?e:ORYX.Core.Math.getIdentityVector(e,t);return{x:i.y,y:-i.x}},ORYX.Core.Math.getPointOfIntersectionPointLine=function(e,t,i,n){var s=Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2);if(0!=s){var o=((i.x-e.x)*(t.x-e.x)+(i.y-e.y)*(t.y-e.y))/s;if(!n||0<=o&&o<=1)return pointOfIntersection=new Object,pointOfIntersection.x=e.x+o*(t.x-e.x),pointOfIntersection.y=e.y+o*(t.y-e.y),pointOfIntersection}},ORYX.Core.Math.getTranslatedPoint=function(e,t){var i=t.a*e.x+t.c*e.y+1*t.e,n=t.b*e.x+t.d*e.y+1*t.f;return{x:i,y:n}},ORYX.Core.Math.getInverseMatrix=function(e){var t=ORYX.Core.Math.getDeterminant(e),i=e;return{a:t*(1*i.d-0*i.f),b:t*(0*i.f-1*i.b),c:t*(0*i.e-1*i.c),d:t*(1*i.a-0*i.e),e:t*(i.c*i.f-i.e*i.d),f:t*(i.e*i.b-i.a*i.f)}},ORYX.Core.Math.getDeterminant=function(e){return e.a*e.d*1+e.c*e.f*0+e.e*e.b*0-e.e*e.d*0-e.c*e.b*1-e.a*e.f*0},ORYX.Core.Math.getTranslatedBoundingBox=function(e){var t=e.getCTM(),i=e.getBBox(),n=ORYX.Core.Math.getTranslatedPoint({x:i.x,y:i.y},t),s=ORYX.Core.Math.getTranslatedPoint({x:i.x,y:i.y+i.height},t),o=ORYX.Core.Math.getTranslatedPoint({x:i.x+i.width,y:i.y},t),a=ORYX.Core.Math.getTranslatedPoint({x:i.x+i.width,y:i.y+i.height},t),r={x:Math.min(n.x,s.x,o.x,a.x),y:Math.min(n.y,s.y,o.y,a.y)},h={x:Math.max(n.x,s.x,o.x,a.x),y:Math.max(n.y,s.y,o.y,a.y)};return{x:r.x,y:r.y,width:h.x-r.x,height:h.y-r.y}},ORYX.Core.Math.getAngle=function(e,t){if(e.x==t.x&&e.y==t.y)return 0;var i=180*Math.asin(Math.sqrt(Math.pow(e.y-t.y,2))/Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(e.y-t.y,2)))/Math.PI;return t.x>=e.x&&t.y<=e.y?i:t.x<e.x&&t.y<=e.y?180-i:t.x<e.x&&t.y>e.y?180+i:360-i},new function(){function e(e,o,a,r,h,c){var d=0;return o>c?d|=i:o<r&&(d|=n),e>h?d|=t:e<a&&(d|=s),d}var t=2,i=8,n=4,s=1;ORYX.Core.Math.isRectOverLine=function(e,t,i,n,s,o,a,r){return!!ORYX.Core.Math.clipLineOnRect.apply(ORYX.Core.Math,arguments)},ORYX.Core.Math.clipLineOnRect=function(o,a,r,h,c,d,l,u){var g,f,p,O=0,R=!1,S=!1;g=e(o,a,c,d,l,u),f=e(r,h,c,d,l,u);do{if(0==(g|f))R=!0,S=!0;else if((g&f)>0)S=!0;else{var m=0,v=0;p=0!=g?g:f,(p&i)>0?(m=o+(r-o)*(u-a)/(h-a),v=u):(p&n)>0?(m=o+(r-o)*(d-a)/(h-a),v=d):(p&t)>0?(v=a+(h-a)*(l-o)/(r-o),m=l):(p&s)>0&&(v=a+(h-a)*(c-o)/(r-o),m=c),p==g?(o=m,a=v,g=e(o,a,c,d,l,u)):(r=m,h=v,f=e(r,h,c,d,l,u))}O++}while(1!=S&&O<5e3);return R?{a:{x:o,y:a},b:{x:r,y:h}}:null}},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Stencil={construct:function(e,t,i,n,s,o){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"Stencilset seems corrupt.";if(!t)throw"Stencil does not provide namespace.";if(!i)throw"Stencil does not provide SVG source.";if(!n)throw"Fatal internal error loading stencilset.";if(this._source=i,this._jsonStencil=e,this._stencilSet=n,this._namespace=t,this._propertyPackages=s,o&&!this._jsonStencil.position&&(this._jsonStencil.position=o),this._view,this._properties=new Hash,!this._jsonStencil.type||"edge"!==this._jsonStencil.type&&"node"!==this._jsonStencil.type)throw"ORYX.Core.StencilSet.Stencil(construct): Type is not defined.";if(!this._jsonStencil.id||""===this._jsonStencil.id)throw"ORYX.Core.StencilSet.Stencil(construct): Id is not defined.";if(!this._jsonStencil.title||""===this._jsonStencil.title)throw"ORYX.Core.StencilSet.Stencil(construct): Title is not defined.";this._jsonStencil.description||(this._jsonStencil.description=""),this._jsonStencil.groups||(this._jsonStencil.groups=[]),this._jsonStencil.roles||(this._jsonStencil.roles=[]),this._jsonStencil.roles.push(this._jsonStencil.id),this._jsonStencil.roles.each(function(e,i){this._jsonStencil.roles[i]=t+e}.bind(this)),this._jsonStencil.roles=this._jsonStencil.roles.uniq(),this._jsonStencil.id=t+this._jsonStencil.id,this.postProcessProperties(),this._jsonStencil.serialize||(this._jsonStencil.serialize={}),this._jsonStencil.deserialize||(this._jsonStencil.deserialize={}),this._jsonStencil.layout||(this._jsonStencil.layout=[]);var a=i+"view/"+e.view;if(this._jsonStencil.view.trim().match(/</)){var r=new DOMParser,h=r.parseFromString(this._jsonStencil.view,"text/xml");if(!ORYX.Editor.checkClassType(h.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a valid SVG document.";this._view=h.documentElement}else new Ajax.Request(a,{asynchronous:!1,method:"get",onSuccess:this._loadSVGOnSuccess.bind(this),onFailure:this._loadSVGOnFailure.bind(this)})},postProcessProperties:function(){if(this._jsonStencil.icon=ORYX.CONFIG.SERVER_HANDLER_ROOT+"/stencilsetitem/"+this._jsonStencil.objectId+"/image",this._jsonStencil.propertyPackages&&this._jsonStencil.propertyPackages instanceof Array){var e=this._jsonStencil.hiddenPropertyPackages;this._jsonStencil.propertyPackages.each(function(t){var i=this._propertyPackages.get(t);i&&i.each(function(t){var i=new ORYX.Core.StencilSet.Property(t,this._namespace,this),n=i.prefix()+"-"+i.id();this._properties.set(n,i),e.indexOf(i.id())>-1&&i.hide()}.bind(this))}.bind(this))}this._jsonStencil.properties&&this._jsonStencil.properties instanceof Array&&this._jsonStencil.properties.each(function(e){var t=new ORYX.Core.StencilSet.Property(e,this._namespace,this),i=t.prefix()+"-"+t.id();this._properties.set(i,t)}.bind(this))},equals:function(e){return this.id()===e.id()},stencilSet:function(){return this._stencilSet},type:function(){return this._jsonStencil.type},namespace:function(){return this._namespace},id:function(){return this._jsonStencil.id},idWithoutNs:function(){return this.id().replace(this.namespace(),"")},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"description")},groups:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonStencil,"groups")},position:function(){return isNaN(this._jsonStencil.position)?0:this._jsonStencil.position},view:function(){return this._view.cloneNode(!0)||this._view},icon:function(){return this._jsonStencil.icon},fixedAspectRatio:function(){return this._jsonStencil.fixedAspectRatio===!0},hasMultipleRepositoryEntries:function(){return this.getRepositoryEntries().length>0},getRepositoryEntries:function(){return this._jsonStencil.repositoryEntries?$A(this._jsonStencil.repositoryEntries):$A([])},properties:function(){return this._properties.values()},property:function(e){return this._properties.get(e)},roles:function(){return this._jsonStencil.roles},defaultAlign:function(){return this._jsonStencil.defaultAlign?this._jsonStencil.defaultAlign:"east"},serialize:function(e,t){return this._jsonStencil.serialize},deserialize:function(e,t){return this._jsonStencil.deserialize},layout:function(e){return this._jsonStencil.layout},addProperty:function(e,t){if(e&&t){var i=new ORYX.Core.StencilSet.Property(e,t,this);this._properties[i.prefix()+"-"+i.id()]=i}},removeProperty:function(e){if(e){var t=this._properties.values().find(function(t){return e==t.id()});t&&delete this._properties[t.prefix()+"-"+t.id()]}},_loadSVGOnSuccess:function(e){var t=null;if(t=e.responseXML,!ORYX.Editor.checkClassType(t.documentElement,SVGSVGElement))throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnSuccess): The response is not a SVG document.";this._view=t.documentElement},_loadSVGOnFailure:function(e){throw"ORYX.Core.StencilSet.Stencil(_loadSVGOnFailure): Loading SVG document failed."},toString:function(){return"Stencil "+this.title()+" ("+this.id()+")"}},ORYX.Core.StencilSet.Stencil=Clazz.extend(ORYX.Core.StencilSet.Stencil),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Property=Clazz.extend({construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this._jsonProp=e||ORYX.Log.error("Parameter jsonProp is not defined."),this._namespace=t||ORYX.Log.error("Parameter namespace is not defined."),this._stencil=i||ORYX.Log.error("Parameter stencil is not defined."),this._items={},this._complexItems={},this._hidden=!1,e.id=e.id||ORYX.Log.error("ORYX.Core.StencilSet.Property(construct): Id is not defined."),e.id=e.id.toLowerCase(),e.type?e.type=e.type.toLowerCase():(ORYX.Log.info("Type is not defined for stencil '%0', id '%1'. Falling back to 'String'.",i,e.id),e.type="string"),e.prefix=e.prefix||"oryx",e.title=e.title||"",e.value=e.value||"",e.description=e.description||"",e.readonly=e.readonly||!1,e.optional=e.optional!==!1,this._jsonProp.refToView?this._jsonProp.refToView instanceof Array||(this._jsonProp.refToView=[this._jsonProp.refToView]):this._jsonProp.refToView=[];var n=this.getMinForType(e.type);void 0===e.min||null===e.min?e.min=n:e.min<n&&(e.min=n);var s=this.getMaxForType(e.type);if(void 0===e.max||null===e.max?e.max=s:e.max>s&&(e.min=s),e.fillOpacity||(e.fillOpacity=!1),"number"!=typeof e.lightness?e.lightness=1:e.lightness=Math.max(0,Math.min(1,e.lightness)),e.strokeOpacity||(e.strokeOpacity=!1),void 0!==e.length&&null!==e.length||(e.length=Number.MAX_VALUE),e.wrapLines||(e.wrapLines=!1),e.dateFormat||(e.dateFormat=ORYX.I18N.PropertyWindow.dateFormat||"m/d/y"),e.fill||(e.fill=!1),e.stroke||(e.stroke=!1),e.inverseBoolean||(e.inverseBoolean=!1),e.directlyEditable||0==e.directlyEditable||(e.directlyEditable=!0),e.visible!==!1&&(e.visible=!0),e.isList!==!0&&(e.isList=!1,e.list&&e.list instanceof Array||(e.list=[])),e.category||(e.popular?e.category="popular":e.category="others"),e.alwaysAppearInMultiselect||(e.alwaysAppearInMultiselect=!1),e.type===ORYX.CONFIG.TYPE_CHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value.toLowerCase()]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}else e.type!==ORYX.CONFIG.TYPE_COMPLEX&&e.type!=ORYX.CONFIG.TYPE_MULTIPLECOMPLEX||e.complexItems&&e.complexItems instanceof Array&&e.complexItems.each(function(e){this._complexItems[e.id.toLowerCase()]=new ORYX.Core.StencilSet.ComplexPropertyItem(e,t,this)}.bind(this))},getMinForType:function(e){return e.toLowerCase()==ORYX.CONFIG.TYPE_INTEGER?-Math.pow(2,31):-Number.MAX_VALUE+1},getMaxForType:function(e){return e.toLowerCase()==ORYX.CONFIG.TYPE_INTEGER?Math.pow(2,31)-1:Number.MAX_VALUE},equals:function(e){return this._namespace===e.namespace()&&this.id()===e.id()},namespace:function(){return this._namespace},stencil:function(){return this._stencil},id:function(){return this._jsonProp.id},prefix:function(){return this._jsonProp.prefix},type:function(){return this._jsonProp.type},inverseBoolean:function(){return this._jsonProp.inverseBoolean},category:function(){return this._jsonProp.category},setCategory:function(e){this._jsonProp.category=e},directlyEditable:function(){return this._jsonProp.directlyEditable},visible:function(){return this._jsonProp.visible},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"title")},value:function(){return this._jsonProp.value},readonly:function(){return this._jsonProp.readonly},optional:function(){return this._jsonProp.optional},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonProp,"description")},refToView:function(){return this._jsonProp.refToView},min:function(){return this._jsonProp.min},max:function(){return this._jsonProp.max},fillOpacity:function(){return this._jsonProp.fillOpacity},strokeOpacity:function(){return this._jsonProp.strokeOpacity},length:function(){return this._jsonProp.length?this._jsonProp.length:Number.MAX_VALUE},wrapLines:function(){return this._jsonProp.wrapLines},dateFormat:function(){return this._jsonProp.dateFormat},fill:function(){return this._jsonProp.fill},lightness:function(){return this._jsonProp.lightness},stroke:function(){return this._jsonProp.stroke},items:function(){return $H(this._items).values()},item:function(e){return e?this._items[e.toLowerCase()]:null},toString:function(){return"Property "+this.title()+" ("+this.id()+")"},complexItems:function(){return $H(this._complexItems).values()},complexItem:function(e){return e?this._complexItems[e.toLowerCase()]:null},complexAttributeToView:function(){return this._jsonProp.complexAttributeToView||""},isList:function(){return!!this._jsonProp.isList},getListItems:function(){return this._jsonProp.list},linkableType:function(){return this._jsonProp.linkableType||""},alwaysAppearInMultiselect:function(){return this._jsonProp.alwaysAppearInMultiselect},popular:function(){return this._jsonProp.popular||!1},setPopular:function(){this._jsonProp.popular=!0},hide:function(){this._hidden=!0},isHidden:function(){return this._hidden}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.PropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.PropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,!e.value)throw"ORYX.Core.StencilSet.PropertyItem(construct): Value is not defined.";this._jsonItem.refToView?this._jsonItem.refToView instanceof Array||(this._jsonItem.refToView=[this._jsonItem.refToView]):this._jsonItem.refToView=[]},equals:function(e){return this.property().equals(e.property())&&this.value()===e.value()},namespace:function(){return this._namespace},property:function(){return this._property},value:function(){return this._jsonItem.value},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"title")},refToView:function(){return this._jsonItem.refToView},icon:function(){return this._jsonItem.icon?this.property().stencil()._source+"icons/"+this._jsonItem.icon:""},toString:function(){return"PropertyItem "+this.property()+" ("+this.value()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.ComplexPropertyItem=Clazz.extend({construct:function(e,t,i){if(arguments.callee.$.construct.apply(this,arguments),!e)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter jsonItem is not defined.";if(!t)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter namespace is not defined.";if(!i)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Parameter property is not defined.";if(this._jsonItem=e,this._namespace=t,this._property=i,this._items=new Hash,this._complexItems=new Hash,!e.name)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Name is not defined.";if(!e.type)throw"ORYX.Core.StencilSet.ComplexPropertyItem(construct): Type is not defined.";if(e.type=e.type.toLowerCase(),e.type===ORYX.CONFIG.TYPE_CHOICE){if(!(e.items&&e.items instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.items.each(function(e){this._items[e.value]=new ORYX.Core.StencilSet.PropertyItem(e,t,this)}.bind(this))}else if(e.type===ORYX.CONFIG.TYPE_COMPLEX){if(!(e.complexItems&&e.complexItems instanceof Array))throw"ORYX.Core.StencilSet.Property(construct): No property items defined.";e.complexItems.each(function(e){this._complexItems[e.id]=new ORYX.Core.StencilSet.ComplexPropertyItem(e,t,this)}.bind(this))}},equals:function(e){return this.property().equals(e.property())&&this.name()===e.name()},namespace:function(){return this._namespace},property:function(){return this._property},name:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonItem,"name")},id:function(){return this._jsonItem.id},type:function(){return this._jsonItem.type},optional:function(){return this._jsonItem.optional},width:function(){return this._jsonItem.width},value:function(){return this._jsonItem.value},items:function(){return this._items.values()},complexItems:function(){return this._complexItems.values()},disable:function(){return this._jsonItem.disable}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.Rules={construct:function(){arguments.callee.$.construct.apply(this,arguments),this._stencilSets=[],this._stencils=[],this._containerStencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash},initializeRules:function(e){var t=this._stencilSets.find(function(t){return t.namespace()==e.namespace()});if(t){var n=this._stencilSets.clone();return n=n.without(t),n.push(e),this._stencilSets=[],this._stencils=[],this._containerStencils=[],this._cachedConnectSET=new Hash,this._cachedConnectSE=new Hash,this._cachedConnectTE=new Hash,this._cachedCardSE=new Hash,this._cachedCardTE=new Hash,this._cachedContainPC=new Hash,this._cachedMorphRS=new Hash,this._connectionRules=new Hash,this._cardinalityRules=new Hash,this._containmentRules=new Hash,this._morphingRules=new Hash,this._layoutRules=new Hash,void n.each(function(e){this.initializeRules(e)}.bind(this))}this._stencilSets.push(e);var s=new Hash(e.jsonRules()),o=e.namespace(),a=e.stencils();e.extensions().values().each(function(e){e.rules&&(e.rules.connectionRules&&(s.connectionRules=s.connectionRules.concat(e.rules.connectionRules)),e.rules.cardinalityRules&&(s.cardinalityRules=s.cardinalityRules.concat(e.rules.cardinalityRules)),e.rules.containmentRules&&(s.containmentRules=s.containmentRules.concat(e.rules.containmentRules)),e.rules.morphingRules&&(s.morphingRules=s.morphingRules.concat(e.rules.morphingRules))),e.stencils&&(a=a.concat(e.stencils))}),this._stencils=this._stencils.concat(e.stencils());var r=this._connectionRules;s.get("connectionRules")&&s.get("connectionRules").each(function(e){this._isRoleOfOtherNamespace(e.role)?r.get(e.role)||r.set(e.role,new Hash):r.get(o+e.role)||r.set(o+e.role,new Hash),e.connects.each(function(t){var i=[];t.to&&(t.to instanceof Array||(t.to=[t.to]),t.to.each(function(e){this._isRoleOfOtherNamespace(e)?i.push(e):i.push(o+e)}.bind(this)));var n,s;n=this._isRoleOfOtherNamespace(e.role)?e.role:o+e.role,s=this._isRoleOfOtherNamespace(t.from)?t.from:o+t.from,r.get(n).get(s)?r.get(n).set(s,r.get(n).get(s).concat(i)):r.get(n).set(s,i)}.bind(this))}.bind(this));var h=this._cardinalityRules;s.get("cardinalityRules")&&s.get("cardinalityRules").each(function(e){var t;if(t=this._isRoleOfOtherNamespace(e.role)?e.role:o+e.role,!h.get(t)){h.set(t,{});for(i in e)h.get(t)[i]=e[i]}var n=new Hash;e.outgoingEdges&&e.outgoingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?n.set(e.role,e):n.set(o+e.role,e)}.bind(this)),h.get(t).outgoingEdges=n;var s=new Hash;e.incomingEdges&&e.incomingEdges.each(function(e){this._isRoleOfOtherNamespace(e.role)?s.set(e.role,e):s.set(o+e.role,e)}.bind(this)),h.get(t).incomingEdges=s}.bind(this));var c=this._containmentRules;s.get("containmentRules")&&s.get("containmentRules").each(function(e){var t;this._isRoleOfOtherNamespace(e.role)?t=e.role:(this._containerStencils.push(o+e.role),t=o+e.role),c.get(t)||c.set(t,[]),(e.contains||[]).each(function(e){this._isRoleOfOtherNamespace(e)?c.get(t).push(e):c.get(t).push(o+e)}.bind(this))}.bind(this));var d=this._morphingRules;s.get("morphingRules")&&s.get("morphingRules").each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:o+e.role,d.get(t)||d.set(t,[]),e.preserveBounds||(e.preserveBounds=!1),e.baseMorphs.each(function(e){var i=this._getStencilById(o+e);i&&d.get(t).push(i)}.bind(this))}.bind(this));var l=this._layoutRules;if(s.get("layoutRules")){var u=function(e){return{edgeRole:e.edgeRole||void 0,t:e.t||1,r:e.r||1,b:e.b||1,l:e.l||1}};s.get("layoutRules").each(function(e){var t;t=this._isRoleOfOtherNamespace(e.role)?e.role:o+e.role,l.get(t)||l.set(t,{}),e["in"]&&(l.get(t)["in"]=u(e["in"])),e.ins&&(l.get(t).ins=(e.ins||[]).map(function(e){return u(e)})),e.out&&(l.get(t).out=u(e.out)),e.outs&&(l.get(t).outs=(e.outs||[]).map(function(e){return u(e)}))}.bind(this))}},_getStencilById:function(e){return this._stencils.find(function(t){return t.id()==e})},_cacheConnect:function(e){if(result=this._canConnect(e),e.sourceStencil&&e.targetStencil){var t=this._cachedConnectSET[e.sourceStencil.id()];t||(t=new Hash,this._cachedConnectSET[e.sourceStencil.id()]=t);var i=t[e.edgeStencil.id()];i||(i=new Hash,t[e.edgeStencil.id()]=i),i[e.targetStencil.id()]=result}else if(e.sourceStencil){var t=this._cachedConnectSE[e.sourceStencil.id()];t||(t=new Hash,this._cachedConnectSE[e.sourceStencil.id()]=t),t[e.edgeStencil.id()]=result}else{var n=this._cachedConnectTE[e.targetStencil.id()];n||(n=new Hash,this._cachedConnectTE[e.targetStencil.id()]=n),n[e.edgeStencil.id()]=result}return result},_cacheCard:function(e){if(e.sourceStencil){var t=this._cachedCardSE[e.sourceStencil.id()];t||(t=new Hash,this._cachedCardSE[e.sourceStencil.id()]=t);var i=this._getMaximumNumberOfOutgoingEdge(e);void 0==i&&(i=-1),t[e.edgeStencil.id()]=i}if(e.targetStencil){var n=this._cachedCardTE[e.targetStencil.id()];n||(n=new Hash,this._cachedCardTE[e.targetStencil.id()]=n);var i=this._getMaximumNumberOfIncomingEdge(e);void 0==i&&(i=-1),n[e.edgeStencil.id()]=i}},_cacheContain:function(e){var t=[this._canContain(e),this._getMaximumOccurrence(e.containingStencil,e.containedStencil)];void 0==t[1]&&(t[1]=-1);var i=this._cachedContainPC[e.containingStencil.id()];return i||(i=new Hash,this._cachedContainPC[e.containingStencil.id()]=i),i[e.containedStencil.id()]=t,t},_cacheMorph:function(e){var t=this._cachedMorphRS[e];return t||(t=[],this._morphingRules.keys().include(e)&&(t=this._stencils.select(function(t){return t.roles().include(e)})),this._cachedMorphRS[e]=t),t},outgoingEdgeStencils:function(e){if(!e.sourceShape&&!e.sourceStencil)return[];e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil());var t=[];return this._stencils.each(function(i){if("edge"===i.type()){var n=Object.clone(e);n.edgeStencil=i,this.canConnect(n)&&t.push(i)}}.bind(this)),t},incomingEdgeStencils:function(e){if(!e.targetShape&&!e.targetStencil)return[];e.targetShape&&(e.targetStencil=e.targetShape.getStencil());var t=[];return this._stencils.each(function(i){if("edge"===i.type()){var n=Object.clone(e);n.edgeStencil=i,this.canConnect(n)&&t.push(i)}}.bind(this)),t},sourceStencils:function(e){if(!e||!e.edgeShape&&!e.edgeStencil)return[];e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t=[];return this._stencils.each(function(i){var n=Object.clone(e);n.sourceStencil=i,this.canConnect(n)&&t.push(i)}.bind(this)),t},targetStencils:function(e){if(!e||!e.edgeShape&&!e.edgeStencil)return[];e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t=[];return this._stencils.each(function(i){var n=Object.clone(e);n.targetStencil=i,this.canConnect(n)&&t.push(i)}.bind(this)),t},canConnect:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil||!e.edgeShape&&!e.edgeStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t;if(e.sourceStencil&&e.targetStencil){var i=this._cachedConnectSET[e.sourceStencil.id()];if(i){var n=i[e.edgeStencil.id()];if(n){var s=n[e.targetStencil.id()];t=void 0==s?this._cacheConnect(e):s}else t=this._cacheConnect(e)}else t=this._cacheConnect(e)}else if(e.sourceStencil){var i=this._cachedConnectSE[e.sourceStencil.id()];if(i){var n=i[e.edgeStencil.id()];t=void 0==n?this._cacheConnect(e):n}else t=this._cacheConnect(e)}else{var s=this._cachedConnectTE[e.targetStencil.id()];if(s){var n=s[e.edgeStencil.id()];t=void 0==n?this._cacheConnect(e):n}else t=this._cacheConnect(e)}if(t){if(e.sourceShape){var i=this._cachedCardSE[e.sourceStencil.id()];i||(this._cacheCard(e),i=this._cachedCardSE[e.sourceStencil.id()]);var o=i[e.edgeStencil.id()];void 0==o&&this._cacheCard(e),o=i[e.edgeStencil.id()],o!=-1&&(t=e.sourceShape.getOutgoingShapes().all(function(t){return!!(t.getStencil().id()!==e.edgeStencil.id()||e.edgeShape&&t===e.edgeShape)||(o--,o>0)}))}if(e.targetShape){var s=this._cachedCardTE[e.targetStencil.id()];s||(this._cacheCard(e),s=this._cachedCardTE[e.targetStencil.id()]);var o=s[e.edgeStencil.id()];void 0==o&&this._cacheCard(e),o=s[e.edgeStencil.id()],o!=-1&&(t=e.targetShape.getIncomingShapes().all(function(t){return!!(t.getStencil().id()!==e.edgeStencil.id()||e.edgeShape&&t===e.edgeShape)||(o--,o>0)}))}}return t},_canConnect:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil||!e.edgeShape&&!e.edgeStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil()),e.edgeShape&&(e.edgeStencil=e.edgeShape.getStencil());var t,i=this._getConnectionRulesOfEdgeStencil(e.edgeStencil);return t=0!==i.keys().length&&(e.sourceStencil?e.sourceStencil.roles().any(function(t){var n=i.get(t);return!!n&&(!e.targetStencil||n.any(function(t){return e.targetStencil.roles().member(t)}))}):i.values().any(function(t){return e.targetStencil.roles().any(function(e){return t.member(e)})}))},isContainer:function(e){return this._containerStencils.member(e.getStencil().id())},canContain:function(e){if(!e||!e.containingStencil&&!e.containingShape||!e.containedStencil&&!e.containedShape)return!1;if(e.containedShape&&(e.containedStencil=e.containedShape.getStencil()),e.containingShape&&(e.containingStencil=e.containingShape.getStencil()),"edge"==e.containedStencil.type())return!1;var t,i=this._cachedContainPC[e.containingStencil.id()];if(i?(t=i[e.containedStencil.id()],t||(t=this._cacheContain(e))):t=this._cacheContain(e),t[0]){if(t[1]==-1)return!0;if(e.containingShape){var n=t[1];return e.containingShape.getChildShapes(!1).all(function(t){return t.getStencil().id()!==e.containedStencil.id()||(n--,n>0)})}return!0}return!1},_canContain:function(e){if(!e||!e.containingStencil&&!e.containingShape||!e.containedStencil&&!e.containedShape)return!1;e.containedShape&&(e.containedStencil=e.containedShape.getStencil()),e.containingShape&&(e.containingStencil=e.containingShape.getStencil());var t;return t=e.containingStencil.roles().any(function(t){var i=this._containmentRules.get(t);return!!i&&i.any(function(t){return e.containedStencil.roles().member(t)})}.bind(this))},morphStencils:function(e){if(!e.stencil&&!e.shape)return[];e.shape&&(e.stencil=e.shape.getStencil());var t=[];e.stencil.roles().each(function(e){this._cacheMorph(e).each(function(e){t.push(e)})}.bind(this));var i=this.baseMorphs();return t=t.uniq().sort(function(e,t){return i.include(e)&&!i.include(t)?-1:i.include(t)&&!i.include(e)?1:0})},baseMorphs:function(){var e=[];return this._morphingRules.each(function(t){t.value.each(function(t){e.push(t)})}),e},containsMorphingRules:function(){return this._stencilSets.any(function(e){return!!e.jsonRules().morphingRules})},connectMorph:function(e){if(!e||!e.sourceShape&&!e.sourceStencil&&!e.targetShape&&!e.targetStencil)return!1;e.sourceShape&&(e.sourceStencil=e.sourceShape.getStencil()),e.targetShape&&(e.targetStencil=e.targetShape.getStencil());var t=this.incomingEdgeStencils(e),i=this.outgoingEdgeStencils(e),n=t.select(function(e){return i.member(e)}),s=this.baseMorphs().select(function(e){return n.member(e)});return s.size()>0?s[0]:n.size()>0?n[0]:null},showInShapeMenu:function(e){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(i){return e.roles().include(t.namespace()+i.role)&&i.showInShapeMenu!==!1})})},preserveBounds:function(e){return this._stencilSets.any(function(t){return t.jsonRules().morphingRules.any(function(i){return e.roles().include(t.namespace()+i.role)&&i.preserveBounds})})},getLayoutingRules:function(e,t){if(e&&e instanceof ORYX.Core.Shape){var i={"in":{},
out:{}},n=function(e,n){e&&e[n]&&["t","r","b","l"].each(function(t){i[n][t]=Math.max(e[n][t],i[n][t]||0)}),e&&e[n+"s"]instanceof Array&&["t","r","b","l"].each(function(s){var o,a=e[n+"s"].find(function(e){return!e.edgeRole});t instanceof ORYX.Core.Edge&&(o=e[n+"s"].find(function(e){return this._hasRole(t,e.edgeRole)}.bind(this))),i[n][s]=Math.max(o?o[s]:a[s],i[n][s]||0)}.bind(this))}.bind(this);return e.getStencil().roles().each(function(e){this._layoutRules[e]&&(n(this._layoutRules[e],"in"),n(this._layoutRules[e],"out"))}.bind(this)),["in","out"].each(function(e){["t","r","b","l"].each(function(t){i[e][t]=void 0!==i[e][t]?i[e][t]:1})}),i}},_hasRole:function(e,t){if(e instanceof ORYX.Core.Shape&&t){var i=e.getStencil().roles().any(function(e){return e==t});return i||e.getStencil().id()==e.getStencil().namespace()+t}},_stencilsWithRole:function(e){return this._stencils.findAll(function(t){return!!t.roles().member(e)})},_edgesWithRole:function(e){return this._stencils.findAll(function(t){return!(!t.roles().member(e)||"edge"!==t.type())})},_nodesWithRole:function(e){return this._stencils.findAll(function(t){return!(!t.roles().member(e)||"node"!==t.type())})},_getMaximumOccurrence:function(e,t){var i;return t.roles().each(function(e){var t=this._cardinalityRules.get(e);t&&t.maximumOccurrence&&(i=i?Math.min(i,t.maximumOccurrence):t.maximumOccurrence)}.bind(this)),i},_getMaximumNumberOfOutgoingEdge:function(e){if(!e||!e.sourceStencil||!e.edgeStencil)return!1;var t;return e.sourceStencil.roles().each(function(i){var n=this._cardinalityRules.get(i);n&&n.outgoingEdges&&e.edgeStencil.roles().each(function(e){var i=n.outgoingEdges[e];i&&i.maximum&&(t=t?Math.min(t,i.maximum):i.maximum)})}.bind(this)),t},_getMaximumNumberOfIncomingEdge:function(e){if(!e||!e.targetStencil||!e.edgeStencil)return!1;var t;return e.targetStencil.roles().each(function(i){var n=this._cardinalityRules[i];n&&n.incomingEdges&&e.edgeStencil.roles().each(function(e){var i=n.incomingEdges[e];i&&i.maximum&&(t=t?Math.min(t,i.maximum):i.maximum)})}.bind(this)),t},_getConnectionRulesOfEdgeStencil:function(e){var t=new Hash;return e.roles().each(function(e){this._connectionRules.get(e)&&this._connectionRules.get(e).each(function(e){t.get(e.key)?t.set(e.key,t.get([e.key]).concat(e.value)):t.set(e.key,e.value)})}.bind(this)),t},_isRoleOfOtherNamespace:function(e){return e.indexOf("#")>0},toString:function(){return"Rules"}},ORYX.Core.StencilSet.Rules=Clazz.extend(ORYX.Core.StencilSet.Rules),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet.StencilSet=Clazz.extend({construct:function(e,t){this._extensions=new Hash,this._baseUrl=e,this._jsonObject={},this._stencils=new Hash,this._availableStencils=new Hash,this._init(t)},findRootStencilName:function(){var e=this._stencils.values().find(function(e){return e._jsonStencil.mayBeRoot});return e||(ORYX.Log.warn("Did not find any stencil that may be root. Taking a guess."),e=this._stencils.values()[0]),e.id()},equals:function(e){return this.namespace()===e.namespace()},stencils:function(e,t,i){if(e&&t){for(var n=this._availableStencils.values(),s=[e],o=[],a=[];s.size()>0;){var r=s.pop();o.push(r);for(var h=n.findAll(function(e){var i={containingStencil:r,containedStencil:e};return t.canContain(i)}),c=0;c<h.size();c++)o.member(h[c])||s.push(h[c]);a=a.concat(h).uniq()}a=a.sortBy(function(e){return n.indexOf(e)}),i&&(a=a.sortBy(function(e){return e.groups().first()}));var d=n.findAll(function(e){return"edge"==e.type()});return a=a.concat(d)}return i?this._availableStencils.values().sortBy(function(e){return e.groups().first()}):this._availableStencils.values()},nodes:function(){return this._availableStencils.values().findAll(function(e){return"node"===e.type()})},edges:function(){return this._availableStencils.values().findAll(function(e){return"edge"===e.type()})},stencil:function(e){return this._stencils.get(e)},title:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"title")},description:function(){return ORYX.Core.StencilSet.getTranslation(this._jsonObject,"description")},namespace:function(){return this._jsonObject?this._jsonObject.namespace:null},jsonRules:function(){return this._jsonObject?this._jsonObject.rules:null},source:function(){return this._source},extensions:function(){return this._extensions},addExtension:function(e){new Ajax.Request(e,{method:"GET",asynchronous:!1,onSuccess:function(e){this.addExtensionDirectly(e.responseText)}.bind(this),onFailure:function(e){ORYX.Log.debug("Loading stencil set extension file failed. The request returned an error."+e)}.bind(this),onException:function(e){ORYX.Log.debug("Loading stencil set extension file failed. The request returned an error."+e)}.bind(this)})},addExtensionDirectly:function(str){try{if(eval("var jsonExtension = "+str),jsonExtension["extends"].endsWith("#")||(jsonExtension["extends"]+="#"),jsonExtension["extends"]==this.namespace()){this._extensions.set(jsonExtension.namespace,jsonExtension);var defaultPosition=this._stencils.keys().size();if(jsonExtension.stencils&&$A(jsonExtension.stencils).each(function(e){defaultPosition++;var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,(void 0),defaultPosition);this._stencils.set(t.id(),t),this._availableStencils.set(t.id(),t)}.bind(this)),jsonExtension.properties){var stencils=this._stencils.values();stencils.each(function(e){var t=e.roles();jsonExtension.properties.each(function(i){i.roles.any(function(n){return n=jsonExtension["extends"]+n,!!t.member(n)&&(i.properties.each(function(t){e.addProperty(t,jsonExtension.namespace)}),!0)})})}.bind(this))}jsonExtension.removeproperties&&jsonExtension.removeproperties.each(function(e){var t=this.stencil(jsonExtension["extends"]+e.stencil);t&&e.properties.each(function(e){t.removeProperty(e)})}.bind(this)),jsonExtension.removestencils&&$A(jsonExtension.removestencils).each(function(e){delete this._availableStencils[jsonExtension["extends"]+e]}.bind(this))}}catch(e){ORYX.Log.debug("StencilSet.addExtension: Something went wrong when initialising the stencil set extension. "+e)}},removeExtension:function(e){var t=this._extensions[e];if(t){if(t.stencils&&$A(t.stencils).each(function(e){var t=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this);this._stencils.unset(t.id()),this._availableStencils.unset(t.id())}.bind(this)),t.properties){var i=this._stencils.values();i.each(function(e){var i=e.roles();t.properties.each(function(n){n.roles.any(function(s){return s=t["extends"]+s,!!i.member(s)&&(n.properties.each(function(t){e.removeProperty(t.id)}),!0)})})}.bind(this))}t.removeproperties&&t.removeproperties.each(function(e){var i=this.stencil(t["extends"]+e.stencil);if(i){var n=$A(this._jsonObject.stencils).find(function(e){return e.id==i.id()});e.properties.each(function(e){var t=$A(n.properties).find(function(t){return t.id==e});i.addProperty(t,this.namespace())}.bind(this))}}.bind(this)),t.removestencils&&$A(t.removestencils).each(function(e){var i=t["extends"]+e;this._availableStencils.set(i,this._stencils.get(i))}.bind(this))}delete this._extensions[e]},__handleStencilset:function(response){if(this._jsonObject=response,!this._jsonObject)throw"Error evaluating stencilset. It may be corrupt.";with(this._jsonObject){if(!namespace||""===namespace)throw"Namespace definition missing in stencilset.";if(!(stencils instanceof Array))throw"Stencilset corrupt.";namespace.endsWith("#")||(namespace+="#"),title||(title=""),description||(description="")}},_init:function(e){this.__handleStencilset(e);var t=new Hash;this._jsonObject.propertyPackages&&$A(this._jsonObject.propertyPackages).each(function(e){t.set(e.name,e.properties)}.bind(this));var i=0;$A(this._jsonObject.stencils).each(function(e){i++;var n=new ORYX.Core.StencilSet.Stencil(e,this.namespace(),this._baseUrl,this,t,i);this._stencils.set(n.id(),n),this._availableStencils.set(n.id(),n)}.bind(this))},_cancelInit:function(e){this.errornous=!0},toString:function(){return"StencilSet "+this.title()+" ("+this.namespace()+")"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.StencilSet||(ORYX.Core.StencilSet={}),ORYX.Core.StencilSet._stencilSetsByNamespace=new Hash,ORYX.Core.StencilSet._stencilSetsByUrl=new Hash,ORYX.Core.StencilSet._StencilSetNSByEditorInstance=new Hash,ORYX.Core.StencilSet._rulesByEditorInstance=new Hash,ORYX.Core.StencilSet.stencilSets=function(e){var t=ORYX.Core.StencilSet._StencilSetNSByEditorInstance.get(e),i=new Hash;return t&&t.each(function(e){var t=ORYX.Core.StencilSet.stencilSet(e);i.set(t.namespace(),t)}),i},ORYX.Core.StencilSet.stencilSet=function(e){ORYX.Log.trace("Getting stencil set %0",e);var t=e.split("#",1);return 1===t.length?(ORYX.Log.trace("Getting stencil set %0",t[0]),ORYX.Core.StencilSet._stencilSetsByNamespace.get(t[0]+"#")):void 0},ORYX.Core.StencilSet.stencil=function(e){ORYX.Log.trace("Getting stencil for %0",e);var t=ORYX.Core.StencilSet.stencilSet(e);return t?t.stencil(e):void ORYX.Log.trace("Cannot fild stencil for %0",e)},ORYX.Core.StencilSet.rules=function(e){return ORYX.Core.StencilSet._rulesByEditorInstance.get(e)||ORYX.Core.StencilSet._rulesByEditorInstance.set(e,new ORYX.Core.StencilSet.Rules),ORYX.Core.StencilSet._rulesByEditorInstance.get(e)},ORYX.Core.StencilSet.loadStencilSet=function(e,t,i){ORYX.Core.StencilSet._stencilSetsByNamespace.set(t.namespace(),t),ORYX.Core.StencilSet._stencilSetsByUrl.set(e,t);var n=t.namespace();if(ORYX.Core.StencilSet._StencilSetNSByEditorInstance.get(i)?ORYX.Core.StencilSet._StencilSetNSByEditorInstance.get(i).push(n):ORYX.Core.StencilSet._StencilSetNSByEditorInstance.set(i,[n]),ORYX.Core.StencilSet._rulesByEditorInstance.get(i))ORYX.Core.StencilSet._rulesByEditorInstance.get(i).initializeRules(t);else{var s=new ORYX.Core.StencilSet.Rules;s.initializeRules(t),ORYX.Core.StencilSet._rulesByEditorInstance.set(i,s)}},ORYX.Core.StencilSet.getTranslation=function(e,t){var i=ORYX.I18N.Language.toLowerCase(),n=e[t+"_"+i];return n?n:(n=e[t+"_"+i.substr(0,2)],n?n:e[t])},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Command=Clazz.extend({construct:function(){},execute:function(){throw"Command.execute() has to be implemented!"},rollback:function(){throw"Command.rollback() has to be implemented!"}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Bounds={construct:function(){this._changedCallbacks=[],this.a={},this.b={},this.set.apply(this,arguments),this.suspendChange=!1,this.changedWhileSuspend=!1},_changed:function(e){this.suspendChange?this.changedWhileSuspend=!0:(this._changedCallbacks.each(function(t){t(this,e)}.bind(this)),this.changedWhileSuspend=!1)},registerCallback:function(e){this._changedCallbacks.member(e)||this._changedCallbacks.push(e)},unregisterCallback:function(e){this._changedCallbacks=this._changedCallbacks.without(e)},set:function(){var e=!1;switch(arguments.length){case 1:this.a.x!==arguments[0].a.x&&(e=!0,this.a.x=arguments[0].a.x),this.a.y!==arguments[0].a.y&&(e=!0,this.a.y=arguments[0].a.y),this.b.x!==arguments[0].b.x&&(e=!0,this.b.x=arguments[0].b.x),this.b.y!==arguments[0].b.y&&(e=!0,this.b.y=arguments[0].b.y);break;case 2:var t=Math.min(arguments[0].x,arguments[1].x),i=Math.min(arguments[0].y,arguments[1].y),n=Math.max(arguments[0].x,arguments[1].x),s=Math.max(arguments[0].y,arguments[1].y);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==n&&(e=!0,this.b.x=n),this.b.y!==s&&(e=!0,this.b.y=s);break;case 4:var t=Math.min(arguments[0],arguments[2]),i=Math.min(arguments[1],arguments[3]),n=Math.max(arguments[0],arguments[2]),s=Math.max(arguments[1],arguments[3]);this.a.x!==t&&(e=!0,this.a.x=t),this.a.y!==i&&(e=!0,this.a.y=i),this.b.x!==n&&(e=!0,this.b.x=n),this.b.y!==s&&(e=!0,this.b.y=s)}e&&this._changed(!0)},moveTo:function(){var e=this.upperLeft();switch(arguments.length){case 1:this.moveBy({x:arguments[0].x-e.x,y:arguments[0].y-e.y});break;case 2:this.moveBy({x:arguments[0]-e.x,y:arguments[1]-e.y})}},moveBy:function(){var e=!1;switch(arguments.length){case 1:var t=arguments[0];0===t.x&&0===t.y||(e=!0,this.a.x+=t.x,this.b.x+=t.x,this.a.y+=t.y,this.b.y+=t.y);break;case 2:var i=arguments[0],n=arguments[1];0===i&&0===n||(e=!0,this.a.x+=i,this.b.x+=i,this.a.y+=n,this.b.y+=n)}e&&this._changed()},include:function(e){if(void 0===this.a.x&&void 0===this.a.y&&void 0===this.b.x&&void 0===this.b.y)return e;var t=Math.min(this.a.x,e.a.x),i=Math.min(this.a.y,e.a.y),n=Math.max(this.b.x,e.b.x),s=Math.max(this.b.y,e.b.y);this.set(t,i,n,s)},extend:function(e){0===e.x&&0===e.y||(this.b.x+=e.x,this.b.y+=e.y,this._changed(!0))},widen:function(e){0!==e&&(this.suspendChange=!0,this.moveBy({x:-e,y:-e}),this.extend({x:2*e,y:2*e}),this.suspendChange=!1,this.changedWhileSuspend&&this._changed(!0))},upperLeft:function(){var e={};return e.x=this.a.x,e.y=this.a.y,e},lowerRight:function(){var e={};return e.x=this.b.x,e.y=this.b.y,e},width:function(){return this.b.x-this.a.x},height:function(){return this.b.y-this.a.y},center:function(){var e={};return e.x=(this.a.x+this.b.x)/2,e.y=(this.a.y+this.b.y)/2,e},midPoint:function(){var e={};return e.x=(this.b.x-this.a.x)/2,e.y=(this.b.y-this.a.y)/2,e},centerMoveTo:function(){var e=this.center();switch(arguments.length){case 1:this.moveBy(arguments[0].x-e.x,arguments[0].y-e.y);break;case 2:this.moveBy(arguments[0]-e.x,arguments[1]-e.y)}},isIncluded:function(e,t){var i,n,t;switch(arguments.length){case 1:i=arguments[0].x,n=arguments[0].y,t=0;break;case 2:arguments[0].x&&arguments[0].y?(i=arguments[0].x,n=arguments[0].y,t=Math.abs(arguments[1])):(i=arguments[0],n=arguments[1],t=0);break;case 3:i=arguments[0],n=arguments[1],t=Math.abs(arguments[2]);break;default:throw"isIncluded needs one, two or three arguments"}var s=this.upperLeft(),o=this.lowerRight();return i>=s.x-t&&i<=o.x+t&&n>=s.y-t&&n<=o.y+t},clone:function(){return new ORYX.Core.Bounds(this)},toString:function(){return"( "+this.a.x+" | "+this.a.y+" )/( "+this.b.x+" | "+this.b.y+" )"},serializeForERDF:function(){return this.a.x+","+this.a.y+","+this.b.x+","+this.b.y}},ORYX.Core.Bounds=Clazz.extend(ORYX.Core.Bounds),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.UIObject={construct:function(e){this.isChanged=!0,this.isResized=!0,this.isVisible=!0,this.isSelectable=!1,this.isResizable=!1,this.isMovable=!1,this.id=ORYX.Editor.provideId(),this.parent=void 0,this.node=void 0,this.children=[],this.bounds=new ORYX.Core.Bounds,this._changedCallback=this._changed.bind(this),this.bounds.registerCallback(this._changedCallback),e&&e.eventHandlerCallback&&(this.eventHandlerCallback=e.eventHandlerCallback)},_changed:function(e,t){this.isChanged=!0,this.bounds==e&&(this.isResized=t||this.isResized)},update:function(){this.isChanged&&(this.refresh(),this.isChanged=!1,this.children.each(function(e){e.update()}))},refresh:function(){},getChildren:function(){return this.children.clone()},getParents:function(){for(var e=[],t=this.parent;t;)e.push(t),t=t.parent;return e},isParent:function(e){for(var t=this;t;){if(t===e)return!0;t=t.parent}return!1},getId:function(){return this.id},getChildById:function(e,t){return this.children.find(function(i){if(i.getId()===e)return i;if(t){var n=i.getChildById(e,t);if(n)return n}})},add:function(e){this.children.member(e)?ORYX.Log.info("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.remove(e),this.children.push(e),e.parent=this,e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback))},remove:function(e){this.children.member(e)?(this.children=this._uiObjects.without(e),e.parent=void 0,e.node=this.node.removeChild(e.node),e.bounds.unregisterCallback(this._changedCallback)):ORYX.Log.info("remove: ORYX.Core.UIObject is not a child of this object.")},absoluteBounds:function(){if(this.parent){var e=this.absoluteXY();return new ORYX.Core.Bounds(e.x,e.y,e.x+this.bounds.width(),e.y+this.bounds.height())}return this.bounds.clone()},absoluteXY:function(){if(this.parent){var e=this.parent.absoluteXY(),t={};return t.x=e.x+this.bounds.upperLeft().x,t.y=e.y+this.bounds.upperLeft().y,t}var t={};return t.x=this.bounds.upperLeft().x,t.y=this.bounds.upperLeft().y,t},absoluteCenterXY:function(){if(this.parent){var e=this.parent.absoluteXY(),t={};return t.x=e.x+this.bounds.center().x,t.y=e.y+this.bounds.center().y,t}var t={};return t.x=this.bounds.center().x,t.y=this.bounds.center().y,t},hide:function(){this.node.setAttributeNS(null,"display","none"),this.isVisible=!1,this.children.each(function(e){e.hide()})},show:function(){this.node.setAttributeNS(null,"display","inherit"),this.isVisible=!0,this.children.each(function(e){e.show()})},addEventHandlers:function(e){e.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,this._delegateEvent.bind(this),!1),e.addEventListener("click",this._delegateEvent.bind(this),!1),e.addEventListener(ORYX.CONFIG.EVENT_DBLCLICK,this._delegateEvent.bind(this),!1)},_delegateEvent:function(e){this.eventHandlerCallback&&this.eventHandlerCallback(e,this)},toString:function(){return"UIObject "+this.id}},ORYX.Core.UIObject=Clazz.extend(ORYX.Core.UIObject),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.AbstractShape=ORYX.Core.UIObject.extend({construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.resourceId=ORYX.Editor.provideId(),this._stencil=t,this._stencil._jsonStencil.superId&&(stencilId=this._stencil.id(),superStencilId=stencilId.substring(0,stencilId.indexOf("#")+1)+t._jsonStencil.superId,stencilSet=this._stencil.stencilSet(),this._stencil=stencilSet.stencil(superStencilId)),this.properties=new Hash,this.propertiesChanged=new Hash,this.hiddenProperties=new Hash,this._stencil.properties().each(function(e){var t=e.prefix()+"-"+e.id();this.properties.set(t,e.value()),this.propertiesChanged.set(t,!0)}.bind(this)),t._jsonStencil.superId&&t.properties().each(function(e){var t=e.prefix()+"-"+e.id(),i=e.value(),n=this.properties.get(t);this.properties.set(t,i),this.propertiesChanged.set(t,!0),this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,name:t,value:i,oldValue:n})}.bind(this))},layout:function(){},getStencil:function(){return this._stencil},getChildShapeByResourceId:function(e){return e=ERDF.__stripHashes(e),this.getChildShapes(!0).find(function(t){return t.resourceId==e})},getChildShapes:function(e,t){var i=[];return this.children.each(function(n){n instanceof ORYX.Core.Shape&&n.isVisible&&(t&&t(n),i.push(n),e&&(i=i.concat(n.getChildShapes(e,t))))}),i},hasChildShape:function(e){return this.getChildShapes().any(function(t){return t===e||t.hasChildShape(e)})},getChildNodes:function(e,t){var i=[];return this.children.each(function(n){n instanceof ORYX.Core.Node&&n.isVisible&&(t&&t(n),i.push(n)),n instanceof ORYX.Core.Shape&&e&&(i=i.concat(n.getChildNodes(e,t)))}),i},getChildEdges:function(e,t){var i=[];return this.children.each(function(n){n instanceof ORYX.Core.Edge&&n.isVisible&&(t&&t(n),i.push(n)),n instanceof ORYX.Core.Shape&&e&&(i=i.concat(n.getChildEdges(e,t)))}),i},getAbstractShapesAtPosition:function(){var e,t;switch(arguments.length){case 1:e=arguments[0].x,t=arguments[0].y;break;case 2:e=arguments[0],t=arguments[1];break;default:throw"getAbstractShapesAtPosition needs 1 or 2 arguments!"}if(this.isPointIncluded(e,t)){var i=[];i.push(this);var n=this.getChildNodes(),s=this.getChildEdges();return[n,s].each(function(n){var s=new Hash;n.each(function(i){if(i.isVisible){var n=i.getAbstractShapesAtPosition(e,t);if(n.length>0){var o=$A(i.node.parentNode.childNodes),a=o.indexOf(i.node);s.set(a,n)}}}),s.keys().sort().each(function(e){i=i.concat(s.get(e))})}),i}return[]},setProperty:function(e,t,i){var n=this.properties.get(e);n===t&&i!==!0||(this.properties.set(e,t),this.propertiesChanged.set(e,!0),this._changed(),this._isInSetProperty||(this._isInSetProperty=!0,this._delegateEvent({type:ORYX.CONFIG.EVENT_PROPERTY_CHANGED,elements:[this],name:e,value:t,oldValue:n}),delete this._isInSetProperty))},isPropertyChanged:function(){return this.propertiesChanged.any(function(e){return e.value})},setHiddenProperty:function(e,t){if(void 0===t)return void this.hiddenProperties.unset(e);var i=this.hiddenProperties.get(e);i!==t&&this.hiddenProperties.set(e,t)},isPointIncluded:function(e,t,i){var n=i?i:this.absoluteBounds();return n.isIncluded(e,t)},serialize:function(){var e=[];return e.push({name:"type",prefix:"oryx",value:this.getStencil().id(),type:"literal"}),this.hiddenProperties.each(function(t){e.push({name:t.key.replace("oryx-",""),prefix:"oryx",value:t.value,type:"literal"})}.bind(this)),this.getStencil().properties().each(function(t){var i=t.prefix(),n=t.id();e.push({name:n,prefix:i,value:this.properties.get(i+"-"+n),type:"literal"})}.bind(this)),e},deserialize:function(e){e=e.sort(function(e,t){return e=Number(this.properties.keys().member(e.prefix+"-"+e.name)),t=Number(this.properties.keys().member(t.prefix+"-"+t.name)),e>t?1:e<t?-1:0}.bind(this)),e.each(function(e){var t=e.name,i=e.prefix,n=e.value;switch("Object"===Object.prototype.toString.call(n)&&(n=JSON.stringify(n)),i+"-"+t){case"raziel-parent":if(!this.parent)break;var s=this.getCanvas().getChildShapeByResourceId(n);s&&s.add(this);break;default:var o=this.getStencil().property(i+"-"+t);o&&o.isList()&&"string"==typeof n&&(!(n||"").strip()||n.startsWith("[")||n.startsWith("]")||(n='["'+n.strip()+'"]'),n=((n||"").strip()||"[]").evalJSON()),this.properties.keys().member(i+"-"+t)?this.setProperty(i+"-"+t,n):"bounds"!==t&&"parent"!==t&&"target"!==t&&"dockers"!==t&&"docker"!==t&&"outgoing"!==t&&"incoming"!==t&&this.setHiddenProperty(i+"-"+t,n)}}.bind(this))},toString:function(){return"ORYX.Core.AbstractShape "+this.id},toJSON:function(){var e=this.properties.merge(this.hiddenProperties),t=new Hash;e.each(function(e){var i=e.key,n=e.value;if(this.getStencil().property(i)&&this.getStencil().property(i).type()===ORYX.CONFIG.TYPE_COMPLEX&&"String"===Object.prototype.toString.call(n))try{n=JSON.parse(n)}catch(s){}else if(n instanceof Date&&this.getStencil().property(i))try{n=n.format(this.getStencil().property(i).dateFormat())}catch(o){}i=i.replace(/^[\w_]+-/,""),t.set(i,n)}.bind(this));var i={resourceId:this.resourceId,properties:t.toObject(),stencil:{id:this.getStencil().idWithoutNs()},childShapes:this.getChildShapes().map(function(e){return e.toJSON()})};return this.getOutgoingShapes&&(i.outgoing=this.getOutgoingShapes().map(function(e){return{resourceId:e.resourceId}})),this.bounds&&(i.bounds={lowerRight:this.bounds.lowerRight(),upperLeft:this.bounds.upperLeft()}),this.dockers&&(i.dockers=this.dockers.map(function(e){var t=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();return t.getDocker=function(){return e},t})),jQuery.extend(i,ORYX.Core.AbstractShape.JSONHelper),i.getShape=function(){return this}.bind(this),i}}),ORYX.Core.AbstractShape.JSONHelper={eachChild:function(e,t,i){if(this.childShapes){var n=[];this.childShapes.each(function(s){s.eachChild instanceof Function||jQuery.extend(s,ORYX.Core.AbstractShape.JSONHelper);var o=e(s,this);o&&n.push(o),t&&s.eachChild(e,t,i)}.bind(this)),i&&(this.childShapes=n)}},getShape:function(){return null},getChildShapes:function(e){var t=this.childShapes;return e&&this.eachChild(function(i){i.getChildShapes instanceof Function||jQuery.extend(i,ORYX.Core.AbstractShape.JSONHelper),t=t.concat(i.getChildShapes(e))},!0),t},serialize:function(){return JSON.stringify(this)}},!ORYX)var ORYX={};ORYX.Core||(ORYX.Core={}),ORYX.Core.Canvas=ORYX.Core.AbstractShape.extend({zoomLevel:1,construct:function(e,t,i){return arguments.callee.$.construct.apply(this,arguments),e&&e.width&&e.height?(this.facade=i,this.resourceId=e.id,this.nodes=[],this.edges=[],this.colHighlightState=0,this.colHighlightEnabled=!1,this.rootNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",e.parentNode,["svg",{id:this.id,width:e.width,height:e.height},["defs",{}]]),this.rootNode.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.rootNode.setAttribute("xmlns:svg","http://www.w3.org/2000/svg"),this._htmlContainer=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",e.parentNode,["div",{id:"oryx_canvas_htmlContainer",style:"position:absolute; top:5px"}]),this.underlayNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.rootNode,["svg",{id:"underlay-container"}]),this.columnHightlight1=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.underlayNode,["rect",{x:0,width:ORYX.CONFIG.FORM_ROW_WIDTH+35,height:"100%",style:"fill: #fff6d5",visibility:"hidden"}]),this.columnHightlight2=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.underlayNode,["rect",{x:ORYX.CONFIG.FORM_ROW_WIDTH+35,width:ORYX.CONFIG.FORM_ROW_WIDTH+25,height:"100%",style:"fill: #fff6d5",visibility:"hidden"}]),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.rootNode,["g",{},["g",{"class":"stencils"},["g",{"class":"me"}],["g",{"class":"children"}],["g",{"class":"edge"}]],["g",{"class":"svgcontainer"}]]),this.node.setAttributeNS(null,"stroke","none"),this.node.setAttributeNS(null,"font-family","Verdana, sans-serif"),this.node.setAttributeNS(null,"font-size-adjust","none"),this.node.setAttributeNS(null,"font-style","normal"),this.node.setAttributeNS(null,"font-variant","normal"),this.node.setAttributeNS(null,"font-weight","normal"),this.node.setAttributeNS(null,"line-heigth","normal"),this.node.setAttributeNS(null,"font-size",ORYX.CONFIG.LABEL_DEFAULT_LINE_HEIGHT),this.bounds.set(0,0,e.width,e.height),this.addEventHandlers(this.rootNode.parentNode),void(this.rootNode.oncontextmenu=function(){return!1})):void ORYX.Log.fatal("Canvas is missing mandatory parameters options.width and options.height.")},focus:function(){},setHightlightState:function(e){this.colHighlightEnabled&&this.colHighlightState!=e&&(0==e?(this.columnHightlight1.setAttribute("visibility","hidden"),this.columnHightlight2.setAttribute("visibility","hidden")):1==e?(this.columnHightlight1.setAttribute("visibility","visible"),this.columnHightlight2.setAttribute("visibility","hidden")):2==e?(this.columnHightlight1.setAttribute("visibility","hidden"),this.columnHightlight2.setAttribute("visibility","visible")):3==e&&(this.columnHightlight1.setAttribute("visibility","visible"),this.columnHightlight2.setAttribute("visibility","visible")),this.colHighlightState=e)},setHightlightStateBasedOnX:function(e){e>ORYX.CONFIG.FORM_ROW_WIDTH+30?this.setHightlightState(2):this.setHightlightState(1)},update:function(){this.nodes.each(function(e){this._traverseForUpdate(e)}.bind(this));var e=this.getStencil().layout();e&&e.each(function(e){e.shape=this,e.forceExecution=!0,e.target=this.rootNode,this._delegateEvent(e)}.bind(this)),this.nodes.invoke("_update"),this.edges.invoke("_update",!0)},_traverseForUpdate:function(e){var t=e.isChanged;return e.getChildNodes(!1,function(e){this._traverseForUpdate(e)&&(t=!0)}.bind(this)),!!t&&(e.layout(),!0)},layout:function(){},getChildNodes:function(e,t){if(e||t){var i=[];return this.nodes.each(function(n){t&&t(n),i.push(n),e&&n instanceof ORYX.Core.Shape&&(i=i.concat(n.getChildNodes(e,t)))}),i}return this.nodes.clone()},add:function(e,t,i){e instanceof ORYX.Core.UIObject?this.children.member(e)?ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object."):(e.parent&&e.parent.remove(e,!0),void 0!=t?this.children.splice(t,0,e):this.children.push(e),e.parent=this,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.addMarkers(this.rootNode.getElementsByTagNameNS(NAMESPACE_SVG,"defs")[0]),e.node=this.node.childNodes[0].childNodes[2].appendChild(e.node),this.edges.push(e)):(e.node=this.node.childNodes[0].childNodes[1].appendChild(e.node),this.nodes.push(e)):e.node=this.node.appendChild(e.node),e.bounds.registerCallback(this._changedCallback),this.eventHandlerCallback&&i!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})):ORYX.Log.fatal("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e,t){if(this.children.member(e)){var i=e.parent;this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node),this.edges=this.edges.without(e)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e.node=this.node.removeChild(e.node),this.eventHandlerCallback&&t!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEREMOVED,shape:e,parent:i}),e.bounds.unregisterCallback(this._changedCallback)}else ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},removeAll:function(){for(var e=this.getChildShapes(),t=0;t<e.length;t++){var i=e[t];this.remove(i)}},addShapeObjects:function(e,t){if(e){this.initializingShapes=!0;var i=function(e,i){var n=ORYX.Core.StencilSet.stencil(this.getStencil().namespace()+e.stencil.id),s="node"==n.type()?ORYX.Core.Node:ORYX.Core.Edge,o=new s({eventHandlerCallback:t},n,this.facade);return o.resourceId=e.resourceId,o.node.id="svg-"+e.resourceId,e.parent="#"+(e.parent&&e.parent.resourceId||i.resourceId),this.add(o),{json:e,object:o}}.bind(this),n=function(e){var t=[];return e.childShapes&&e.childShapes.constructor==String&&(e.childShapes=JSON.parse(e.childShapes)),e.childShapes.each(function(s){t.push(i(s,e)),t=t.concat(n(s))}),t}.bind(this),s=n({childShapes:e,resourceId:this.resourceId});return s.each(function(e){var t=[];for(field in e.json.properties)t.push({prefix:"oryx",name:field,value:e.json.properties[field]});if(e.json.outgoing.each(function(e){t.push({prefix:"raziel",name:"outgoing",value:"#"+e.resourceId})}),e.object instanceof ORYX.Core.Edge){var i=e.json.target||e.json.outgoing[0];i&&t.push({prefix:"raziel",name:"target",value:"#"+i.resourceId})}e.json.bounds&&t.push({prefix:"oryx",name:"bounds",value:e.json.bounds.upperLeft.x+","+e.json.bounds.upperLeft.y+","+e.json.bounds.lowerRight.x+","+e.json.bounds.lowerRight.y}),e.json.dockers&&t.push({prefix:"oryx",name:"dockers",value:e.json.dockers.inject("",function(e,t){return e+t.x+" "+t.y+" "})+" #"}),t.push({prefix:"raziel",name:"parent",value:e.json.parent}),e.__properties=t}.bind(this)),s.each(function(e){e.object instanceof ORYX.Core.Node&&e.object.deserialize(e.__properties,e.json)}),s.each(function(e){e.object instanceof ORYX.Core.Edge&&(e.object.deserialize(e.__properties,e.json),e.object._oldBounds=e.object.bounds.clone(),e.object._update())}),delete this.initializingShapes,s.pluck("object")}},updateSize:function(){var e=0,t=0,i=100;this.getChildShapes(!0,function(n){var s=n.bounds;e=Math.max(e,s.lowerRight().x+i),t=Math.max(t,s.lowerRight().y+i)}),(this.bounds.width()<e||this.bounds.height()<t)&&this.setSize({width:Math.max(this.bounds.width(),e),height:Math.max(this.bounds.height(),t)})},getRootNode:function(){return this.rootNode},getUnderlayNode:function(){return this.underlayNode},getSvgContainer:function(){return this.node.childNodes[1]},getHTMLContainer:function(){return this._htmlContainer},getShapesWithSharedParent:function(e){return!e||e.length<1?[]:1==e.length?e:e.findAll(function(t){for(var i=t.parent;i;){if(e.member(i))return!1;i=i.parent}return!0})},setSize:function(e,t){e&&e.width&&e.height&&(this.rootNode.parentNode&&(this.rootNode.parentNode.style.width=e.width+"px",this.rootNode.parentNode.style.height=e.height+"px"),this.rootNode.setAttributeNS(null,"width",e.width),this.rootNode.setAttributeNS(null,"height",e.height),t||this.bounds.set({a:{x:0,y:0},b:{x:e.width/this.zoomLevel,y:e.height/this.zoomLevel}}))},getSVGRepresentation:function(e){var t=this.getRootNode().cloneNode(!0);this._removeInvisibleElements(t);var i,n,s,o;this.getChildShapes(!0).each(function(e){var t=e.absoluteBounds(),a=t.upperLeft(),r=t.lowerRight();void 0==i?(i=a.x,
n=a.y,s=r.x,o=r.y):(i=Math.min(i,a.x),n=Math.min(n,a.y),s=Math.max(s,r.x),o=Math.max(o,r.y))});var a,r,h,c,d=50;void 0==i?(a=0,r=0,h=0,c=0):(a=s,r=o,h=-i+d/2,c=-n+d/2),t.setAttributeNS(null,"width",a+d),t.setAttributeNS(null,"height",r+d),t.childNodes[1].removeAttributeNS(null,"transform");try{var l=t.childNodes[1].childNodes[1];l.parentNode.removeChild(l)}catch(u){}return e&&($A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"tspan")).each(function(e){e.textContent=e.textContent.escapeHTML()}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text")).each(function(e){0==e.childNodes.length&&(e.textContent=e.textContent.escapeHTML())})),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"image")).each(function(e){var t=e.getAttributeNS("http://www.w3.org/1999/xlink","href");t.match("^(http|https)://")||(t=window.location.protocol+"//"+window.location.host+t,e.setAttributeNS("http://www.w3.org/1999/xlink","href",t))}),$A(t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"a")).each(function(e){e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",(e.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").escapeHTML())}),t},_removeInvisibleElements:function(e){for(var t=0;t<e.childNodes.length;){var i=e.childNodes[t];i.getAttributeNS&&"hidden"===i.getAttributeNS(null,"visibility")?e.removeChild(i):(this._removeInvisibleElements(i),t++)}},_delegateEvent:function(e){!this.eventHandlerCallback||e.target!=this.rootNode&&e.target!=this.rootNode.parentNode||this.eventHandlerCallback(e,this)},toString:function(){return"Canvas "+this.id},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return e.stencilset={url:this.getStencil().stencilSet().source(),namespace:this.getStencil().stencilSet().namespace()},e}});var idCounter=0,ID_PREFIX="resource";if(!ORYX)var ORYX={};if(ORYX.Editor={DOMEventListeners:new Hash,selection:[],zoomLevel:1,construct:function(e){this._eventsQueue=[],this.loadedPlugins=[],this.pluginsData=[];var t=e;this.id=t.modelId,e.model&&(t=e.model),this.id||(this.id=t.id,this.id||(this.id=ORYX.Editor.provideId())),this.fullscreen=e.fullscreen!==!1,this._initEventListener(),this._createCanvas(t.stencil?t.stencil.id:null,t.properties),this._generateGUI();var i=!1,n=!1,s=function(){i&&n&&this._finishedLoading()}.bind(this);window.setTimeout(function(){this.loadPlugins(),i=!0,s()}.bind(this),100),window.setTimeout(function(){this.loadSerialized(t,!0),this.getCanvas().update(),n=!0,s(),this.handleEvents({type:ORYX.CONFIG.EVENT_EDITOR_INIT_COMPLETED})}.bind(this),200)},_finishedLoading:function(){this.handleEvents({type:ORYX.CONFIG.EVENT_LOADED})},_initEventListener:function(){document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYDOWN,this.catchKeyDownEvents.bind(this),!1),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_KEYUP,this.catchKeyUpEvents.bind(this),!1),this._keydownEnabled=!0,this._keyupEnabled=!0,this.DOMEventListeners.set(ORYX.CONFIG.EVENT_MOUSEDOWN,[]),this.DOMEventListeners.set(ORYX.CONFIG.EVENT_MOUSEUP,[]),this.DOMEventListeners.set(ORYX.CONFIG.EVENT_MOUSEOVER,[]),this.DOMEventListeners.set(ORYX.CONFIG.EVENT_MOUSEOUT,[]),this.DOMEventListeners.set(ORYX.CONFIG.EVENT_SELECTION_CHANGED,[]),this.DOMEventListeners.set(ORYX.CONFIG.EVENT_MOUSEMOVE,[])},_generateGUI:function(){var e=(ORYX.CONFIG.WINDOW_HEIGHT,this.getCanvas().rootNode.parentNode);jQuery("#canvasSection").append(e),e.parentNode&&(e.parentNode.setAttributeNS(null,"align","center"),e.setAttributeNS(null,"align","left"),this.getCanvas().setSize({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT}))},getAvailablePlugins:function(){var e=ORYX.availablePlugins.clone();return e.each(function(e){this.loadedPlugins.find(function(e){return e.type==this.name}.bind(e))?e.engaged=!0:e.engaged=!1}.bind(this)),e},loadScript:function(e,t){var i=document.createElement("script");i.type="text/javascript",i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=null,t())}:i.onload=function(){t()},i.src=e,document.getElementsByTagName("head")[0].appendChild(i)},activatePluginByName:function(name,callback,loadTry){var match=this.getAvailablePlugins().find(function(e){return e.name==name});if(!match||match.engaged&&"false"!==match.engaged)callback(!1,match?"NOTFOUND":"YETACTIVATED");else{var loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade(),newPlugin,me=this;if(ORYX.Log.debug("Initializing plugin '%0'",match.name),match.requires&&match.requires.namespaces&&!match.requires.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0}))callback(!1,"REQUIRESTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else if(match.notUsesIn&&match.notUsesIn.namespaces&&match.notUsesIn.namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0}))callback(!1,"NOTUSEINSTENCILSET"),ORYX.Log.info("Plugin need a stencilset which is not loaded'",match.name);else try{var className=eval(match.name),newPlugin=new className(facade,match);newPlugin.type=match.name,newPlugin.registryChanged&&newPlugin.registryChanged(me.pluginsData),newPlugin.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,newPlugin.onSelectionChanged.bind(newPlugin)),this.loadedPlugins.push(newPlugin),this.loadedPlugins.each(function(e){e.registryChanged&&e.registryChanged(this.pluginsData)}.bind(me)),callback(!0)}catch(e){if(ORYX.Log.warn("Plugin %0 is not available",match.name),loadTry)return void callback(!1,"INITFAILED");this.loadScript("plugins/scripts/"+match.source,this.activatePluginByName.bind(this,match.name,callback,!0))}}},loadPlugins:function(){var me=this,newPlugins=[],loadedStencilSetsNamespaces=this.getStencilSets().keys(),facade=this._getPluginFacade();ORYX.MashupAPI&&ORYX.MashupAPI.loadablePlugins&&ORYX.MashupAPI.loadablePlugins instanceof Array&&(ORYX.availablePlugins=$A(ORYX.availablePlugins).findAll(function(e){return ORYX.MashupAPI.loadablePlugins.include(e.name)}),ORYX.MashupAPI.loadablePlugins.each(function(e){ORYX.availablePlugins.find(function(t){return t.name==e})||ORYX.availablePlugins.push({name:e})})),ORYX.availablePlugins.each(function(value){if(ORYX.Log.debug("Initializing plugin '%0'",value.get("name")),value.get("requires")&&value.get("requires").namespaces&&!value.get("requires").namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0})||value.get("notUsesIn")&&value.get("notUsesIn").namespaces&&value.get("notUsesIn").namespaces.any(function(e){return loadedStencilSetsNamespaces.indexOf(e)>=0})||!value.get("engaged")&&void 0!==value.get("engaged"))ORYX.Log.info("Plugin need a stencilset which is not loaded'",value.get("name"));else try{var className=eval(value.get("name"));if(className){var plugin=new className(facade,value);plugin.type=value.get("name"),newPlugins.push(plugin),plugin.engaged=!0}}catch(e){ORYX.Log.warn("Plugin %0 is not available %1",value.get("name"),e)}}),newPlugins.each(function(e){e.registryChanged&&e.registryChanged(me.pluginsData),e.onSelectionChanged&&me.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,e.onSelectionChanged.bind(e))}),this.loadedPlugins=newPlugins,this.registerPluginsOnKeyEvents(),this.setSelection()},_createCanvas:function(e,t){e?e.search(/^http/)===-1&&(e=this.getStencilSets().values()[0].namespace()+e):e=this.getStencilSets().values()[0].findRootStencilName();var i=ORYX.Core.StencilSet.stencil(e);i||ORYX.Log.fatal("Initialisation failed, because the stencil with the type %0 is not part of one of the loaded stencil sets.",e);var n=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",null,["div"]);if(n.addClassName("ORYX_Editor"),this._canvas=new ORYX.Core.Canvas({width:ORYX.CONFIG.CANVAS_WIDTH,height:ORYX.CONFIG.CANVAS_HEIGHT,eventHandlerCallback:this.handleEvents.bind(this),id:this.id,parentNode:n},i,this._getPluginFacade()),t){var s=[];for(field in t)s.push({prefix:"oryx",name:field,value:t[field]});this._canvas.deserialize(s)}},_getPluginFacade:function(){return this._pluginFacade||(this._pluginFacade={activatePluginByName:this.activatePluginByName.bind(this),getAvailablePlugins:this.getAvailablePlugins.bind(this),offer:this.offer.bind(this),getStencilSets:this.getStencilSets.bind(this),getStencilSetExtensionDefinition:function(){return Object.clone(this.ss_extensions_def||{})}.bind(this),getRules:this.getRules.bind(this),loadStencilSet:this.loadStencilSet.bind(this),createShape:this.createShape.bind(this),deleteShape:this.deleteShape.bind(this),getSelection:this.getSelection.bind(this),setSelection:this.setSelection.bind(this),updateSelection:this.updateSelection.bind(this),getCanvas:this.getCanvas.bind(this),importJSON:this.importJSON.bind(this),getJSON:this.getJSON.bind(this),getSerializedJSON:this.getSerializedJSON.bind(this),executeCommands:this.executeCommands.bind(this),isExecutingCommands:this.isExecutingCommands.bind(this),registerOnEvent:this.registerOnEvent.bind(this),unregisterOnEvent:this.unregisterOnEvent.bind(this),raiseEvent:this.handleEvents.bind(this),enableEvent:this.enableEvent.bind(this),disableEvent:this.disableEvent.bind(this),eventCoordinates:this.eventCoordinates.bind(this),eventCoordinatesXY:this.eventCoordinatesXY.bind(this),getModelMetaData:this.getModelMetaData.bind(this)}),this._pluginFacade},isExecutingCommands:function(){return!!this.commandExecuting},executeCommands:function(e){if(this.commandStack||(this.commandStack=[]),this.commandStackExecuted||(this.commandStackExecuted=[]),this.commandStack=[].concat(this.commandStack).concat(e),!this.commandExecuting){for(this.commandExecuting=!0;this.commandStack.length>0;){var t=this.commandStack.shift();t.execute(),this.commandStackExecuted.push(t)}this.handleEvents({type:ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,commands:this.commandStackExecuted}),delete this.commandStack,delete this.commandStackExecuted,delete this.commandExecuting,this.updateSelection()}},getJSON:function(){var e=this.getCanvas().toJSON();return e.ssextensions=this.getStencilSets().values()[0].extensions().keys().findAll(function(e){return!e.endsWith("/meta#")}),e},getSerializedJSON:function(){return JSON.stringify(this.getJSON())},importJSON:function(e,t){try{e=this.renewResourceIds(e)}catch(i){throw i}if(e.stencilset.namespace&&e.stencilset.namespace!==this.getCanvas().getStencil().stencilSet().namespace())return alert(String.format(ORYX.I18N.JSONImport.wrongSS,e.stencilset.namespace,this.getCanvas().getStencil().stencilSet().namespace())),null;var n=ORYX.Core.Command.extend({construct:function(e,t,i,n){this.jsonObject=e,this.noSelection=i,this.facade=n,this.shapes,this.connections=[],this.parents=new Hash,this.selection=this.facade.getSelection(),this.loadSerialized=t},execute:function(){this.shapes?(this.shapes.each(function(e){this.parents[e.id].add(e)}.bind(this)),this.connections.each(function(e){e[0].setDockedShape(e[1]),e[0].setReferencePoint(e[2]),e[0].update()})):(this.shapes=this.loadSerialized(this.jsonObject),this.shapes.each(function(e){if(e.getDockers){var t=e.getDockers();t&&(t.length>0&&this.connections.push([t.first(),t.first().getDockedShape(),t.first().referencePoint]),t.length>1&&this.connections.push([t.last(),t.last().getDockedShape(),t.last().referencePoint]))}this.parents[e.id]=e.parent}.bind(this))),this.facade.getCanvas().update(),this.noSelection?this.facade.updateSelection():this.facade.setSelection(this.shapes),this.facade.getCanvas().updateSize()},rollback:function(){var e=this.facade.getSelection();this.shapes.each(function(t){e=e.without(t),this.facade.deleteShape(t)}.bind(this)),this.facade.getCanvas().update(),this.facade.setSelection(e)}}),s=new n(e,this.loadSerialized.bind(this),t,this._getPluginFacade());return this.executeCommands([s]),s.shapes.clone()},renewResourceIds:function(e){if("String"===Object.prototype.toString.call(e))try{var t=e;e=JSON.parse(e)}catch(i){throw new SyntaxError(i.message)}else var t=JSON.stringify(e);var n=function(e){return e?e.map(function(e){return n(e.childShapes).concat(e.resourceId)}).flatten():[]},s=n(e.childShapes);return s.each(function(e){var i=ORYX.Editor.provideId();t=t.replace(new RegExp(e,"g"),i)}),JSON.parse(t)},loadSerialized:function(e,t){this.getCanvas();if(this.loadSSExtensions(e.ssextensions),t===!0){var i=this.getExtensionForMetaData();i&&this.loadSSExtension(i)}var n=this.getCanvas().addShapeObjects(e.childShapes,this.handleEvents.bind(this));if(e.properties)for(key in e.properties){var s=e.properties[key],o=this.getCanvas().getStencil().property("oryx-"+key);"string"==typeof s||o&&o.isList()||(s=JSON.stringify(s)),this.getCanvas().setProperty("oryx-"+key,s)}return this.getCanvas().updateSize(),this.selection=[null],this.setSelection([]),n},getExtensionForMetaData:function(){if(!(this.ss_extensions_def&&this.ss_extensions_def.extensions instanceof Array))return null;var e=this.getStencilSets(),t=this.ss_extensions_def.extensions.find(function(t){return!!e[t["extends"]]&&t.namespace.endsWith("/meta#")});return t?t.namespace||null:null},loadSSExtensions:function(e){e&&e.each(function(e){this.loadSSExtension(e)}.bind(this))},loadSSExtension:function(e){if(this.ss_extensions_def){var t=this.ss_extensions_def.extensions.find(function(t){return t.namespace==e});if(!t)return;var i=this.getStencilSets()[t["extends"]];if(!i)return;(t.definition||"").startsWith("/")?i.addExtension(t.definition):i.addExtension(ORYX.CONFIG.SS_EXTENSIONS_FOLDER+t.definition),this.getRules().initializeRules(i),this._getPluginFacade().raiseEvent({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED})}},disableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!1),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!1),this.DOMEventListeners.keys().member(e)){var t=this.DOMEventListeners.unset(e);this.DOMEventListeners.set("disable_"+e,t)}},enableEvent:function(e){if(e==ORYX.CONFIG.EVENT_KEYDOWN&&(this._keydownEnabled=!0),e==ORYX.CONFIG.EVENT_KEYUP&&(this._keyupEnabled=!0),this.DOMEventListeners.keys().member("disable_"+e)){var t=this.DOMEventListeners.unset("disable_"+e);this.DOMEventListeners.set(e,t)}},registerOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)||this.DOMEventListeners.set(e,[]),this.DOMEventListeners.get(e).push(t)},unregisterOnEvent:function(e,t){this.DOMEventListeners.keys().member(e)&&this.DOMEventListeners.set(e,this.DOMEventListeners.get(e).without(t))},getSelection:function(){return this.selection||[]},getStencilSets:function(){return ORYX.Core.StencilSet.stencilSets(this.id)},getRules:function(){return ORYX.Core.StencilSet.rules(this.id)},loadStencilSet:function(e){try{ORYX.Core.StencilSet.loadStencilSet(e,this.modelMetaData,this.id),this.handleEvents({type:ORYX.CONFIG.EVENT_STENCIL_SET_LOADED})}catch(t){ORYX.Log.warn("Requesting stencil set file failed. ("+t+")")}},offer:function(e){this.pluginsData.member(e)||this.pluginsData.push(e)},registerPluginsOnKeyEvents:function(){this.pluginsData.each(function(e){e.keyCodes&&e.keyCodes.each(function(t){var i="key.event";i+="."+t.keyAction,t.metaKeys&&(t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_META_CTRL)>-1&&(i+="."+ORYX.CONFIG.META_KEY_META_CTRL),t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_ALT)>-1&&(i+="."+ORYX.CONFIG.META_KEY_ALT),t.metaKeys.indexOf(ORYX.CONFIG.META_KEY_SHIFT)>-1&&(i+="."+ORYX.CONFIG.META_KEY_SHIFT)),t.keyCode&&(i+="."+t.keyCode),ORYX.Log.debug("Register Plugin on Key Event: %0",i),e.toggle===!0&&e.buttonInstance?this.registerOnEvent(i,function(){e.buttonInstance.toggle(!e.buttonInstance.pressed),e.functionality.call(e,e.buttonInstance,e.buttonInstance.pressed)}):this.registerOnEvent(i,e.functionality)}.bind(this))}.bind(this))},isEqual:function(e,t){return e===t||e.length===t.length&&e.all(function(e){return t.include(e)})},isDirty:function(e){return e.any(function(e){return e.isPropertyChanged()})},setSelection:function(e,t,i){e||(e=[]),e instanceof Array||(e=[e]),e=e.findAll(function(e){return e&&e instanceof ORYX.Core.Shape}),e[0]instanceof ORYX.Core.Canvas&&(e=[]),(i||!this.isEqual(this.selection,e)||this.isDirty(e))&&(this.selection=e,this._subSelection=t,this.handleEvents({type:ORYX.CONFIG.EVENT_SELECTION_CHANGED,elements:e,subSelection:t,force:!!i}))},updateSelection:function(){this.setSelection(this.selection,this._subSelection,!0)},getCanvas:function(){return this._canvas},createShape:function(e){if(e&&e.serialize&&e.serialize instanceof Array){var t=e.serialize.find(function(e){return e.prefix+"-"+e.name=="oryx-type"}),i=ORYX.Core.StencilSet.stencil(t.value);if("node"==i.type())var n=new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},i,this._getPluginFacade());else var n=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},i,this._getPluginFacade());return this.getCanvas().add(n),n.deserialize(e.serialize),n}if(!e||!e.type||!e.namespace)throw"To create a new shape you have to give an argument with type and namespace";var n,s=this.getCanvas(),o=e.type,a=ORYX.Core.StencilSet.stencilSet(e.namespace);n="node"==a.stencil(o).type()?new ORYX.Core.Node({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(o),this._getPluginFacade()):new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(o),this._getPluginFacade()),e.template&&(n._jsonStencil.properties=e.template._jsonStencil.properties,n.postProcessProperties()),e.parent&&n instanceof ORYX.Core.Node?e.parent.add(n):s.add(n);var r,h=e.position?e.position:{x:100,y:200};if(e.connectingType&&e.connectedShape&&!(n instanceof ORYX.Core.Edge)){r=new ORYX.Core.Edge({eventHandlerCallback:this.handleEvents.bind(this)},a.stencil(e.connectingType)),r.dockers.first().setDockedShape(e.connectedShape);var c=e.connectedShape.getDefaultMagnet(),d=c?c.bounds.center():e.connectedShape.bounds.midPoint();r.dockers.first().setReferencePoint(d),r.dockers.last().setDockedShape(n),r.dockers.last().setReferencePoint(n.getDefaultMagnet().bounds.center()),s.add(r)}if(n instanceof ORYX.Core.Edge&&e.connectedShape){n.dockers.first().setDockedShape(e.connectedShape),e.connectedShape instanceof ORYX.Core.Node?(n.dockers.first().setReferencePoint(e.connectedShape.getDefaultMagnet().bounds.center()),n.dockers.last().bounds.centerMoveTo(h)):n.dockers.first().setReferencePoint(e.connectedShape.bounds.midPoint());var l=n.dockers.first(),u=n.dockers.last();if(l.getDockedShape()&&u.getDockedShape()){var g=l.getAbsoluteReferencePoint(),f=(u.getAbsoluteReferencePoint(),n.createDocker());f.bounds.centerMoveTo({x:g.x+(endPont.x-g.x)/2,y:g.y+(endPont.y-g.y)/2})}}else{var p=n.bounds;n instanceof ORYX.Core.Node&&1==n.dockers.length&&(p=n.dockers.first().bounds),p.centerMoveTo(h);var O=p.upperLeft();p.moveBy(-Math.min(O.x,0),-Math.min(O.y,0));var R=p.lowerRight();p.moveBy(-Math.max(R.x-s.bounds.width(),0),-Math.max(R.y-s.bounds.height(),0))}return n instanceof ORYX.Core.Edge&&n._update(!1),n instanceof ORYX.Core.Edge||e.dontUpdateSelection||this.setSelection([n]),r&&r.alignDockers,n.alignDockers&&n.alignDockers(),n},deleteShape:function(e){e&&e.parent&&(e.parent.remove(e),e.getOutgoingShapes().each(function(t){var i=t.getDockers().first();i&&i.getDockedShape()==e&&i.setDockedShape(void 0)}),e.getIncomingShapes().each(function(t){var i=t.getDockers().last();i&&i.getDockedShape()==e&&i.setDockedShape(void 0)}),e.getDockers().each(function(e){e.setDockedShape(void 0)}))},getModelMetaData:function(){return this.modelMetaData},_executeEventImmediately:function(e){this.DOMEventListeners.keys().member(e.event.type)&&this.DOMEventListeners.get(e.event.type).each(function(t){t(e.event,e.arg)}.bind(this))},_executeEvents:function(){for(this._queueRunning=!0;this._eventsQueue.length>0;){var e=this._eventsQueue.shift();this._executeEventImmediately(e)}this._queueRunning=!1},handleEvents:function(e,t){switch(ORYX.Log.trace("Dispatching event type %0 on %1",e.type,t),e.type){case ORYX.CONFIG.EVENT_MOUSEDOWN:this._handleMouseDown(e,t);break;case ORYX.CONFIG.EVENT_MOUSEMOVE:this._handleMouseMove(e,t);break;case ORYX.CONFIG.EVENT_MOUSEUP:this._handleMouseUp(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOVER:this._handleMouseHover(e,t);break;case ORYX.CONFIG.EVENT_MOUSEOUT:this._handleMouseOut(e,t)}return e.forceExecution?this._executeEventImmediately({event:e,arg:t}):this._eventsQueue.push({event:e,arg:t}),this._queueRunning||this._executeEvents(),!1},isValidEvent:function(e){try{var t=["INPUT","TEXTAREA"].include(e.target.tagName.toUpperCase()),i=e.target.className.include("x-grid3-focus")&&!e.target.className.include("x-grid3-focus-canvas");return!t&&!i}catch(e){return!1}},catchKeyUpEvents:function(e){if(this._keyupEnabled&&(e||(e=window.event),this.isValidEvent(e))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_UP);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},catchKeyDownEvents:function(e){if(this._keydownEnabled&&(e||(e=window.event),this.isValidEvent(e))){var t=this.createKeyCombEvent(e,ORYX.CONFIG.KEY_ACTION_DOWN);ORYX.Log.debug("Key Event to handle: %0",t),this.handleEvents({type:t,event:e})}},createKeyCombEvent:function(e,t){var i=e.which||e.keyCode,n="key.event";return t&&(n+="."+t),(e.ctrlKey||e.metaKey)&&(n+="."+ORYX.CONFIG.META_KEY_META_CTRL),e.altKey&&(n+="."+ORYX.CONFIG.META_KEY_ALT),e.shiftKey&&(n+="."+ORYX.CONFIG.META_KEY_SHIFT),n+"."+i},_handleMouseDown:function(e,t){var i=this.getCanvas();i.focus();var n=e.currentTarget,s=t,o=null!==s&&void 0!==s&&s.isSelectable,a=null!==s&&void 0!==s&&s.isMovable,r=e.shiftKey||e.ctrlKey,h=0===this.selection.length,c=this.selection.member(s);if(o&&h)this.setSelection([s]),ORYX.Log.trace("Rule #1 applied for mouse down on %0",n.id);else if(!o||h||r||c)if(o&&r&&!c){var d=this.selection.clone();d.push(s),this.setSelection(d),ORYX.Log.trace("Rule #4 applied for mouse down on %0",n.id)}else if(o&&c&&r){var d=this.selection.clone();this.setSelection(d.without(s)),ORYX.Log.trace("Rule #6 applied for mouse down on %0",s.id)}else{if(!o&&!a)return this.setSelection([]),void ORYX.Log.trace("Rule #2 applied for mouse down on %0",n.id);o||!a||s instanceof ORYX.Core.Controls.Docker?o&&c&&!r&&(this._subSelection=this._subSelection!=s?s:void 0,this.setSelection(this.selection,this._subSelection),ORYX.Log.trace("Rule #8 applied for mouse down on %0",n.id)):ORYX.Log.trace("Rule #7 applied for mouse down on %0",n.id)}else this.setSelection([s]),ORYX.Log.trace("Rule #3 applied for mouse down on %0",n.id)},_handleMouseMove:function(e,t){},_handleMouseUp:function(e,t){this.getCanvas(),this.eventCoordinates(e)},_handleMouseHover:function(e,t){},_handleMouseOut:function(e,t){},eventCoordinates:function(e){var t=this.getCanvas(),i=t.node.ownerSVGElement.createSVGPoint();i.x=e.clientX,i.y=e.clientY;var n=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var s=navigator.userAgent;if(s.indexOf("MSIE")>=0){var o=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==o&&(n=o/100)}}1!==n&&(i.x=i.x*n,i.y=i.y*n);var a=t.node.getScreenCTM();return i.matrixTransform(a.inverse())},eventCoordinatesXY:function(e,t){var i=this.getCanvas(),n=i.node.ownerSVGElement.createSVGPoint();n.x=e,n.y=t;var s=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var o=navigator.userAgent;if(o.indexOf("MSIE")>=0){var a=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==a&&(s=a/100)}}1!==s&&(n.x=n.x*s,n.y=n.y*s);var r=i.node.getScreenCTM();return n.matrixTransform(r.inverse())}},ORYX.Editor=Clazz.extend(ORYX.Editor),ORYX.Editor.createByUrl=function(e){new Ajax.Request(e,{method:"GET",onSuccess:function(e){var t=JSON.parse(e.responseText);new ORYX.Editor(t)}.bind(this)})},ORYX.Editor.graft=function(e,t,i,n){n=n||t&&t.ownerDocument||document;var s;if(void 0===i)throw"Can't graft an undefined value";if(i.constructor==String)s=n.createTextNode(i);else for(var o=0;o<i.length;o++){if(0===o&&i[o].constructor==String){var a;if(a=i[o].match(/^([a-z][a-z0-9]*)\.([^\s\.]+)$/i)){s=n.createElementNS(e,a[1]),s.setAttributeNS(null,"class",a[2]);continue}if(a=i[o].match(/^([a-z][a-z0-9]*)$/i)){s=n.createElementNS(e,a[1]);continue}s=n.createElementNS(e,"span"),s.setAttribute(null,"class","namelessFromLOL")}if(void 0===i[o])throw"Can't graft an undefined value in a list!";if(i[o].constructor==String||i[o].constructor==Array)this.graft(e,s,i[o],n);else if(i[o].constructor==Number)this.graft(e,s,i[o].toString(),n);else if(i[o].constructor==Object)for(var r in i[o])s.setAttributeNS(null,r,i[o][r])}return t&&t.appendChild&&t.appendChild(s),s},ORYX.Editor.provideId=function(){for(var e=[],t="0123456789ABCDEF",i=0;i<36;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=3&e[19]|8;for(var i=0;i<36;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-","oryx_"+e.join("")},ORYX.Editor.resizeFix=function(){ORYX.Editor._resizeFixTimeout||(ORYX.Editor._resizeFixTimeout=window.setTimeout(function(){window.resizeBy(1,1),window.resizeBy(-1,-1),ORYX.Editor._resizefixTimeout=null},100))},ORYX.Editor.Cookie={callbacks:[],onChange:function(e,t){this.callbacks.push(e),this.start(t)},start:function(e){if(!this.pe){var t=document.cookie;this.pe=new PeriodicalExecuter(function(){t!=document.cookie&&(t=document.cookie,this.callbacks.each(function(e){e(this.getParams())}.bind(this)))}.bind(this),(e||1e4)/1e3)}},stop:function(){this.pe&&(this.pe.stop(),this.pe=null)},getParams:function(){var e={},t=document.cookie;return t.split("; ").each(function(t){e[t.split("=")[0]]=t.split("=")[1]}),e},toString:function(){return document.cookie}},ORYX.Editor.SVGClassElementsAreAvailable=!0,ORYX.Editor.setMissingClasses=function(){try{SVGElement}catch(e){ORYX.Editor.SVGClassElementsAreAvailable=!1,SVGSVGElement=document.createElementNS("http://www.w3.org/2000/svg","svg").toString(),SVGGElement=document.createElementNS("http://www.w3.org/2000/svg","g").toString(),SVGPathElement=document.createElementNS("http://www.w3.org/2000/svg","path").toString(),SVGTextElement=document.createElementNS("http://www.w3.org/2000/svg","text").toString(),SVGRectElement=document.createElementNS("http://www.w3.org/2000/svg","rect").toString(),SVGImageElement=document.createElementNS("http://www.w3.org/2000/svg","image").toString(),SVGCircleElement=document.createElementNS("http://www.w3.org/2000/svg","circle").toString(),SVGEllipseElement=document.createElementNS("http://www.w3.org/2000/svg","ellipse").toString(),SVGLineElement=document.createElementNS("http://www.w3.org/2000/svg","line").toString(),SVGPolylineElement=document.createElementNS("http://www.w3.org/2000/svg","polyline").toString(),SVGPolygonElement=document.createElementNS("http://www.w3.org/2000/svg","polygon").toString()}},ORYX.Editor.checkClassType=function(e,t){return ORYX.Editor.SVGClassElementsAreAvailable?e instanceof t:e==t},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),new function(){ORYX.Core.UIEnableDrag=function(e,t,i){this.uiObj=t;var n=t.bounds.upperLeft(),s=t.node.getScreenCTM();this.faktorXY={x:s.a,y:s.d},this.scrollNode=t.node.ownerSVGElement.parentNode.parentNode,this.offSetPosition={x:Event.pointerX(e)-n.x*this.faktorXY.x,y:Event.pointerY(e)-n.y*this.faktorXY.y},this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},this.dragCallback=ORYX.Core.UIDragCallback.bind(this),this.disableCallback=ORYX.Core.UIDisableDrag.bind(this),this.movedCallback=i?i.movedCallback:void 0,this.upCallback=i?i.upCallback:void 0,document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1)},ORYX.Core.UIDragCallback=function(e){var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop,t.x/=this.faktorXY.x,t.y/=this.faktorXY.y,this.uiObj.bounds.moveTo(t),this.movedCallback&&this.movedCallback(e)},ORYX.Core.UIDisableDrag=function(e){document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.dragCallback,!1),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.disableCallback,!0),this.upCallback&&this.upCallback(e),this.upCallback=void 0,this.movedCallback=void 0,Event.stop(e)},ORYX.Core.MoveDockersCommand=ORYX.Core.Command.extend({construct:function(e){this.dockers=new Hash(e),this.edges=new Hash},execute:function(){return this.changes?void this.executeAgain():(this.changes=new Hash,this.dockers.values().each(function(e){var t=e.docker.parent;t&&(this.changes.get(t.getId())||this.changes.set(t.getId(),{edge:t,oldDockerPositions:t.dockers.map(function(e){return e.bounds.center()})}),e.docker.bounds.moveBy(e.offset),this.edges.set(t.getId(),t),e.docker.update())}.bind(this)),void this.edges.each(function(e){this.updateEdge(e.value),this.changes[e.value.getId()]&&(this.changes[e.value.getId()].dockerPositions=e.value.dockers.map(function(e){return e.bounds.center()}))}.bind(this)))},updateEdge:function(e){e._update(!0),[e.getOutgoingShapes(),e.getIncomingShapes()].flatten().invoke("_update",[!0])},executeAgain:function(){this.changes.values().each(function(e){this.removeAllDocker(e.edge),e.dockerPositions.each(function(t,i){if(0!=i&&i!=e.dockerPositions.length-1){var n=e.edge.createDocker(void 0,t);n.bounds.centerMoveTo(t),n.update()}}.bind(this)),this.updateEdge(e.edge)}.bind(this))},rollback:function(){this.changes.values().each(function(e){this.removeAllDocker(e.edge),e.oldDockerPositions.each(function(t,i){if(0!=i&&i!=e.oldDockerPositions.length-1){var n=e.edge.createDocker(void 0,t);n.bounds.centerMoveTo(t),n.update()}}.bind(this)),this.updateEdge(e.edge)}.bind(this))},removeAllDocker:function(e){e.dockers.slice(1,e.dockers.length-1).each(function(t){e.removeDocker(t)})}})},!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Shape={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.facade=i,this.dockers=[],this.magnets=[],this._defaultMagnet,this.incoming=[],this.outgoing=[],this.nodes=[],this._dockerChangedCallback=this._dockerChanged.bind(this),this._labels=new Hash,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{id:"svg-"+this.resourceId},["g",{"class":"stencils"},["g",{"class":"me"}],["g",{"class":"children",style:"overflow:hidden"}],["g",{"class":"edge"}]],["g",{"class":"controls"},["g",{"class":"dockers"}],["g",{"class":"magnets"}]]])},update:function(){},_update:function(){},refresh:function(){if(arguments.callee.$.refresh.apply(this,arguments),this.node.ownerDocument){this.propertiesChanged.each(function(e){if(e.value){var t=this.properties.get(e.key),i=this.getStencil().property(e.key);if(void 0!=i)if(this.propertiesChanged.set(e.key,!1),i.type()==ORYX.CONFIG.TYPE_CHOICE){i.refToView().each(function(e){if(""!==e){var n=this._labels.get(this.id+e);n&&i.item(t)&&n.text(i.item(t).title())}}.bind(this));var n=new Hash;i.items().each(function(e){e.refToView().each(function(i){if(""!=i){var s=this.node.ownerDocument.getElementById(this.id+i);s&&(n.get(s.id)&&t!=e.value()||(s.setAttributeNS(null,"display",t==e.value()?"inherit":"none"),n.set(s.id,s)),ORYX.Editor.checkClassType(s,SVGImageElement)&&s.setAttributeNS("http://www.w3.org/1999/xlink","href",s.getAttributeNS("http://www.w3.org/1999/xlink","href")))}}.bind(this))}.bind(this))}else i.refToView().each(function(e){if(""!==e){var n=this.id+e;if(i.type()!==ORYX.CONFIG.TYPE_FLOWABLE_MULTIINSTANCE){if("cancelactivity"===i.type()){var s=this.node.ownerDocument.getElementById(this.id+"frame"),o=this.node.ownerDocument.getElementById(this.id+"frame2");"true"===t?(s.setAttributeNS(null,"display","inherit"),o.setAttributeNS(null,"display","inherit")):(s.setAttributeNS(null,"display","none"),o.setAttributeNS(null,"display","none"))}var a=this.node.ownerDocument.getElementById(n);if(!a||!a.ownerSVGElement){if(i.type()!==ORYX.CONFIG.TYPE_URL&&i.type()!==ORYX.CONFIG.TYPE_DIAGRAM_LINK)return;var r=this.node.ownerDocument.getElementsByTagNameNS("http://www.w3.org/2000/svg","a");if(a=$A(r).find(function(e){return e.getAttributeNS(null,"id")===n;
}),!a)return}if(i.complexAttributeToView()){var h=this._labels.get(n);if(h)try{propJson=t.evalJSON();var c=propJson[i.complexAttributeToView()];h.text(c?c:t)}catch(d){h.text(t)}}else switch(i.type()){case ORYX.CONFIG.TYPE_BOOLEAN:"string"==typeof t&&(t="true"===t),a.setAttributeNS(null,"display",t!==i.inverseBoolean()?"inherit":"none");break;case ORYX.CONFIG.TYPE_COLOR:i.fill()&&("stop"===a.tagName.toLowerCase()?(t&&(i.lightness()&&1!==i.lightness()&&(t=ORYX.Utils.adjustLightness(t,i.lightness())),a.setAttributeNS(null,"stop-color",t),"radialgradient"===a.parentNode.tagName.toLowerCase()&&ORYX.Utils.adjustGradient(a.parentNode,a)),"radialgradient"===a.parentNode.tagName.toLowerCase()&&$A(a.parentNode.getElementsByTagName("stop")).each(function(e){e.setAttributeNS(null,"stop-opacity",t?e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"default-stop-opacity")||1:0)}.bind(this))):a.setAttributeNS(null,"fill",t)),i.stroke()&&a.setAttributeNS(null,"stroke",t);break;case ORYX.CONFIG.TYPE_STRING:var h=this._labels.get(n);h&&h.text(t);break;case ORYX.CONFIG.TYPE_EXPRESSION:var h=this._labels.get(n);h&&h.text(t);break;case ORYX.CONFIG.TYPE_DATASOURCE:var h=this._labels.get(n);h&&h.text(t);break;case ORYX.CONFIG.TYPE_INTEGER:var h=this._labels.get(n);h&&h.text(t);break;case ORYX.CONFIG.TYPE_FLOAT:if(i.fillOpacity()&&a.setAttributeNS(null,"fill-opacity",t),i.strokeOpacity()&&a.setAttributeNS(null,"stroke-opacity",t),!i.fillOpacity()&&!i.strokeOpacity()){var h=this._labels.get(n);h&&h.text(t)}break;case ORYX.CONFIG.TYPE_SUB_PROCESS_LINK:if("subprocesslink"==e){var l=a.getAttributeNodeNS("","onclick"),u=a.getAttributeNodeNS("","style");l&&(t&&t.id?(u&&(u.textContent="cursor:pointer;"),l.textContent="FLOWABLE.TOOLBAR.ACTIONS.navigateToProcess("+t.id+");return false;"):(u&&(u.textContent="cursor:default;"),l.textContent="return false;"))}break;case ORYX.CONFIG.TYPE_URL:}}else if("multiinstance"===e){var g=this.node.ownerDocument.getElementById(this.id+"parallel");g&&("Parallel"===t?g.setAttributeNS(null,"display","inherit"):g.setAttributeNS(null,"display","none"));var f=this.node.ownerDocument.getElementById(this.id+"sequential");f&&("Sequential"===t?f.setAttributeNS(null,"display","inherit"):f.setAttributeNS(null,"display","none"))}}}.bind(this))}}.bind(this)),this._labels.values().each(function(e){e.update()})}},layout:function(){var e=this.getStencil().layout();e&&e.each(function(e){e.shape=this,e.forceExecution=!0,this._delegateEvent(e)}.bind(this))},getLabels:function(){return this._labels.values()},getLabel:function(e){return e?(this._labels.find(function(t){return t.key.endsWith(e)})||{}).value||null:null},hideLabels:function(){this.getLabels().invoke("hide")},showLabels:function(){var e=this.getLabels();e.invoke("show"),e.each(function(e){e.update()})},setOpacity:function(e,t){e=Math.max(Math.min("number"==typeof e?e:1,1),0),1!==e?(e=String(e),this.node.setAttributeNS(null,"fill-opacity",e),this.node.setAttributeNS(null,"stroke-opacity",e)):(this.node.removeAttributeNS(null,"fill-opacity"),this.node.removeAttributeNS(null,"stroke-opacity"))},getDockers:function(){return this.dockers},getMagnets:function(){return this.magnets},getDefaultMagnet:function(){return this._defaultMagnet?this._defaultMagnet:this.magnets.length>0?this.magnets[0]:void 0},getParentShape:function(){return this.parent},getIncomingShapes:function(e){return e&&this.incoming.each(e),this.incoming},getIncomingNodes:function(e){return this.incoming.select(function(t){var i=t instanceof ORYX.Core.Node;return i&&e&&e(t),i})},getOutgoingShapes:function(e){return e&&this.outgoing.each(e),this.outgoing},getOutgoingNodes:function(e){return this.outgoing.select(function(t){var i=t instanceof ORYX.Core.Node;return i&&e&&e(t),i})},getAllDockedShapes:function(e){var t=this.incoming.concat(this.outgoing);return e&&t.each(e),t},getCanvas:function(){return this.parent instanceof ORYX.Core.Canvas?this.parent:this.parent instanceof ORYX.Core.Shape?this.parent.getCanvas():void 0},getChildNodes:function(e,t){if(e||t){var i=[];return this.nodes.each(function(n){n.isVisible&&(t&&t(n),i.push(n),e&&n instanceof ORYX.Core.Shape&&(i=i.concat(n.getChildNodes(e,t))))}),i}return this.nodes.clone()},add:function(e,t,i){if(e instanceof ORYX.Core.UIObject&&!(e instanceof ORYX.Core.Edge))if(this.children.member(e))ORYX.Log.warn("add: ORYX.Core.UIObject is already a child of this object.");else{e.parent&&e.parent.remove(e,!0),void 0!=t?this.children.splice(t,0,e):this.children.push(e),e.parent=this;var n;if(e instanceof ORYX.Core.Node)n=this.node.childNodes[0].childNodes[1],this.nodes.push(e);else if(e instanceof ORYX.Core.Controls.Control){var s=this.node.childNodes[1];e instanceof ORYX.Core.Controls.Docker?(n=s.childNodes[0],this.dockers.length>=2?this.dockers.splice(void 0!==t?Math.min(t,this.dockers.length-1):this.dockers.length-1,0,e):this.dockers.push(e)):e instanceof ORYX.Core.Controls.Magnet?(n=s.childNodes[1],this.magnets.push(e)):n=s}else n=this.node;void 0!=t&&t<n.childNodes.length?e.node=n.insertBefore(e.node,n.childNodes[t]):e.node=n.appendChild(e.node),this._changed(),this.eventHandlerCallback&&i!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEADDED,shape:e})}else ORYX.Log.warn("add: Parameter is not of type ORYX.Core.UIObject.")},remove:function(e,t){if(this.children.member(e)){var i=e.parent;this.children=this.children.without(e),e.parent=void 0,e instanceof ORYX.Core.Shape?e instanceof ORYX.Core.Edge?(e.removeMarkers(),e.node=this.node.childNodes[0].childNodes[2].removeChild(e.node)):(e.node=this.node.childNodes[0].childNodes[1].removeChild(e.node),this.nodes=this.nodes.without(e)):e instanceof ORYX.Core.Controls.Control&&(e instanceof ORYX.Core.Controls.Docker?(e.node=this.node.childNodes[1].childNodes[0].removeChild(e.node),this.dockers=this.dockers.without(e)):e instanceof ORYX.Core.Controls.Magnet?(e.node=this.node.childNodes[1].childNodes[1].removeChild(e.node),this.magnets=this.magnets.without(e)):e.node=this.node.childNodes[1].removeChild(e.node)),this.eventHandlerCallback&&t!==!0&&this.eventHandlerCallback({type:ORYX.CONFIG.EVENT_SHAPEREMOVED,shape:e,parent:i}),this._changed()}else ORYX.Log.warn("remove: ORYX.Core.UIObject is not a child of this object.")},getIntersectionPoint:function(){var e,t,i,n;switch(arguments.length){case 2:e=arguments[0].x,t=arguments[0].y,i=arguments[1].x,n=arguments[1].y;break;case 4:e=arguments[0],t=arguments[1],i=arguments[2],n=arguments[3];break;default:throw"getIntersectionPoints needs two or four arguments"}var s,o,a,r,h=this.absoluteBounds();if(this.isPointIncluded(e,t,h)?(s=e,o=t):(a=e,r=t),this.isPointIncluded(i,n,h)?(s=i,o=n):(a=i,r=n),s&&o&&a&&r){for(var c,d,l=0,u=0;;){var l=Math.min(s,a)+(Math.max(s,a)-Math.min(s,a))/2,u=Math.min(o,r)+(Math.max(o,r)-Math.min(o,r))/2;this.isPointIncluded(l,u,h)?(s=l,o=u):(a=l,r=u);var g=Math.sqrt(Math.pow(s-a,2)+Math.pow(o-r,2));if(c=s+(a-s)/g,d=o+(r-o)/g,!this.isPointIncluded(c,d,h))break}return{x:c,y:d}}},isPointIncluded:function(){return!1},containsNode:function(e){for(var t=this.node.firstChild.firstChild;e;){if(e==t)return!0;e=e.parentNode}return!1},isPointOverOffset:function(){return this.isPointIncluded.apply(this,arguments)},_dockerChanged:function(){},createDocker:function(e,t){var i=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return i.bounds.registerCallback(this._dockerChangedCallback),t&&i.bounds.centerMoveTo(t),this.add(i,e),i},serialize:function(){var e=arguments.callee.$.serialize.apply(this);return e.push({name:"bounds",prefix:"oryx",value:this.bounds.serializeForERDF(),type:"literal"}),this.getOutgoingShapes().each(function(t){e.push({name:"outgoing",prefix:"raziel",value:"#"+ERDF.__stripHashes(t.resourceId),type:"resource"})}.bind(this)),e.push({name:"parent",prefix:"raziel",value:"#"+ERDF.__stripHashes(this.parent.resourceId),type:"resource"}),e},deserialize:function(e,t){arguments.callee.$.deserialize.apply(this,arguments);var i=e.find(function(e){return"oryx-bounds"==e.prefix+"-"+e.name});if(i){var n=i.value.replace(/,/g," ").split(" ").without("");this instanceof ORYX.Core.Edge?(this.dockers.first().isChanged||this.dockers.first().bounds.centerMoveTo(parseFloat(n[0]),parseFloat(n[1])),this.dockers.last().isChanged||this.dockers.last().bounds.centerMoveTo(parseFloat(n[2]),parseFloat(n[3]))):this.bounds.set(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))}t&&t.labels instanceof Array&&t.labels.each(function(e){var t=this.getLabel(e.ref);t&&t.deserialize(e,this)}.bind(this))},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments),t=[],i=this.id;return this._labels.each(function(e){var n=e.value.serialize();n&&(n.ref=e.key.replace(i,""),t.push(n))}),t.length>0&&(e.labels=t),e},_init:function(e){this._adjustIds(e,0)},_adjustIds:function(e,t){if(e instanceof Element){var i=e.getAttributeNS(null,"id");i&&""!==i?e.setAttributeNS(null,"id",this.id+i):(e.setAttributeNS(null,"id",this.id+"_"+this.id+"_"+t),t++);var n=e.getAttributeNS(null,"fill");if(n&&n.include("url(#")&&(n=n.replace(/url\(#/g,"url(#"+this.id),e.setAttributeNS(null,"fill",n)),e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++)t=this._adjustIds(e.childNodes[s],t)}return t},toString:function(){return"ORYX.Core.Shape "+this.getId()}},ORYX.Core.Shape=ORYX.Core.AbstractShape.extend(ORYX.Core.Shape),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Control=ORYX.Core.UIObject.extend({toString:function(){return"Control "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Docker=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.bounds.set(0,0,16,16),this.referencePoint=void 0,this._dockedShapeBounds=void 0,this._dockedShape=void 0,this._oldRefPoint1=void 0,this._oldRefPoint2=void 0,this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g"]),this._dockerNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"8",stroke:"none",fill:"none"}],["circle",{cx:"8",cy:"8",r:"3",stroke:"black",fill:"red","stroke-width":"1"}]]),this._referencePointNode=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["g",{"pointer-events":"none"},["circle",{cx:this.bounds.upperLeft().x,cy:this.bounds.upperLeft().y,r:3,fill:"red","fill-opacity":.4}]]),this.hide(),this.addEventHandlers(this._dockerNode),this._updateCallback=this._changed.bind(this)},update:function(){if(this._dockedShape){if(this._dockedShapeBounds&&this._dockedShape instanceof ORYX.Core.Node){var e=this._dockedShapeBounds.width(),t=this._dockedShapeBounds.height();e||(e=1),t||(t=1);var i=this._dockedShape.bounds.width()/e,n=this._dockedShape.bounds.height()/t;1===i&&1===n||(this.referencePoint.x*=i,this.referencePoint.y*=n),this._dockedShapeBounds=this._dockedShape.bounds.clone()}var s=this.parent.dockers.indexOf(this),o=this,a=this.parent.dockers.length>1?0===s?this.parent.dockers[s+1]:this.parent.dockers[s-1]:void 0,r=o.getDockedShape()?o.getAbsoluteReferencePoint():o.bounds.center(),h=a&&a.getDockedShape()?a.getAbsoluteReferencePoint():a?a.bounds.center():void 0;if(!h){var c=this._dockedShape.absoluteCenterXY(),d=this._dockedShape.bounds.width()*this._dockedShape.bounds.height();h={x:r.x+(c.x-r.x)*-d,y:r.y+(c.y-r.y)*-d}}var l=void 0;if(l=this._dockedShape.getIntersectionPoint(r,h),l||(l=this.getAbsoluteReferencePoint()),this.parent&&this.parent.parent){var u=this.parent.parent.absoluteXY();l.x-=u.x,l.y-=u.y}this.bounds.centerMoveTo(l),this._oldRefPoint1=r,this._oldRefPoint2=h}arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft();if(this._dockerNode.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")"),e=Object.clone(this.referencePoint),e&&this._dockedShape){var t;t=this.parent instanceof ORYX.Core.Edge?this._dockedShape.absoluteXY():this._dockedShape.bounds.upperLeft(),e.x+=t.x,e.y+=t.y}else e=this.bounds.center();this._referencePointNode.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")")},setReferencePoint:function(e){this.referencePoint===e||this.referencePoint&&e&&this.referencePoint.x===e.x&&this.referencePoint.y===e.y||(this.referencePoint=e,this._changed())},getAbsoluteReferencePoint:function(){if(this.referencePoint&&this._dockedShape){var e=this._dockedShape.absoluteXY();return{x:this.referencePoint.x+e.x,y:this.referencePoint.y+e.y}}},setDockedShape:function(e){this._dockedShape&&(this._dockedShape.bounds.unregisterCallback(this._updateCallback),this===this.parent.dockers.first()?(this.parent.incoming=this.parent.incoming.without(this._dockedShape),this._dockedShape.outgoing=this._dockedShape.outgoing.without(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing=this.parent.outgoing.without(this._dockedShape),this._dockedShape.incoming=this._dockedShape.incoming.without(this.parent))),this._dockedShape=e,this._dockedShapeBounds=void 0;var t=void 0;if(this._dockedShape){this===this.parent.dockers.first()?(this.parent.incoming.push(e),e.outgoing.push(this.parent)):this===this.parent.dockers.last()&&(this.parent.outgoing.push(e),e.incoming.push(this.parent));var i=this.bounds,n=e.absoluteXY();t={x:i.center().x-n.x,y:i.center().y-n.y},this._dockedShapeBounds=this._dockedShape.bounds.clone(),this._dockedShape.bounds.registerCallback(this._updateCallback),this.setDockerColor(ORYX.CONFIG.DOCKER_DOCKED_COLOR)}else this.setDockerColor(ORYX.CONFIG.DOCKER_UNDOCKED_COLOR);this.setReferencePoint(t),this._changed()},getDockedShape:function(){return this._dockedShape},isDocked:function(){return!!this._dockedShape},setDockerColor:function(e){this._dockerNode.lastChild.setAttributeNS(null,"fill",e)},preventHiding:function(e){this._preventHiding=Math.max(0,(this._preventHiding||0)+(e?1:-1))},hide:function(){return!this._preventHiding&&(this.node.setAttributeNS(null,"visibility","hidden"),this._referencePointNode.setAttributeNS(null,"visibility","hidden"),void this.children.each(function(e){e.hide()}))},show:function(){this.node.setAttributeNS(null,"visibility","visible"),this.getDockedShape()instanceof ORYX.Core.Edge?this._referencePointNode.setAttributeNS(null,"visibility","hidden"):this._referencePointNode.setAttributeNS(null,"visibility","visible"),this.children.each(function(e){e.show()})},toString:function(){return"Docker "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Controls||(ORYX.Core.Controls={}),ORYX.Core.Controls.Magnet=ORYX.Core.Controls.Control.extend({construct:function(){arguments.callee.$.construct.apply(this,arguments),this.anchorLeft,this.anchorRight,this.anchorTop,this.anchorBottom,this.bounds.set(0,0,16,16),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["g",{"pointer-events":"all"},["circle",{cx:"8",cy:"8",r:"4",stroke:"none",fill:"red","fill-opacity":"0.3"}]]),this.hide()},update:function(){arguments.callee.$.update.apply(this,arguments)},_update:function(){arguments.callee.$.update.apply(this,arguments)},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft();this.node.setAttributeNS(null,"transform","translate("+e.x+", "+e.y+")")},show:function(){arguments.callee.$.show.apply(this,arguments)},toString:function(){return"Magnet "+this.id}}),!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Node={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.isSelectable=!0,this.isMovable=!0,this._dockerUpdated=!1,this.facade=i,this._oldBounds=new ORYX.Core.Bounds,this._svgShapes=[],this.minimumSize=void 0,this.maximumSize=void 0,this.isHorizontallyResizable=!1,this.isVerticallyResizable=!1,this.dataId=void 0,this._init(this._stencil.view()),this.forcedHeight=-1},_update:function(){if(this.dockers.invoke("update"),this.isChanged){var e=this.bounds,t=this._oldBounds;if(this.isResized){var i=e.width()/t.width(),n=e.height()/t.height();this._svgShapes.each(function(s){s.isHorizontallyResizable&&(s.width=s.oldWidth*i),s.isVerticallyResizable&&(s.height=s.oldHeight*n);var o,a=s.anchorLeft,r=s.anchorRight;r?(o=t.width()-(s.oldX+s.oldWidth),a?s.width=e.width()-s.x-o:s.x=e.width()-(o+s.width)):a||(s.x=i*s.oldX,s.isHorizontallyResizable||(s.x=s.x+s.width*i/2-s.width/2));var h=s.anchorTop,c=s.anchorBottom;c?(o=t.height()-(s.oldY+s.oldHeight),h?s.height=e.height()-s.y-o:s._isYLocked||(s.y=e.height()-(o+s.height))):h||(s.y=n*s.oldY,s.isVerticallyResizable||(s.y=s.y+s.height*n/2-s.height/2))});var s={x:0,y:0};this.isHorizontallyResizable||e.width()===t.width()||(s.x=t.width()-e.width()),this.isVerticallyResizable||e.height()===t.height()||(s.y=t.height()-e.height()),0===s.x&&0===s.y||e.extend(s),s={x:0,y:0};var o,a;this.minimumSize&&(ORYX.Log.debug("Shape (%0)'s min size: (%1x%2)",this,this.minimumSize.width,this.minimumSize.height),o=this.minimumSize.width-e.width(),o>0&&(s.x+=o),a=this.minimumSize.height-e.height(),a>0&&(s.y+=a)),this.maximumSize&&(ORYX.Log.debug("Shape (%0)'s max size: (%1x%2)",this,this.maximumSize.width,this.maximumSize.height),o=e.width()-this.maximumSize.width,o>0&&(s.x-=o),a=e.height()-this.maximumSize.height,a>0&&(s.y-=a)),0===s.x&&0===s.y||e.extend(s);var r,h,c,d,l,u,g,i=e.width()/t.width(),n=e.height()/t.height();this.magnets.each(function(s){r=s.anchorLeft,h=s.anchorRight,c=s.anchorTop,d=s.anchorBottom,l=s.bounds.center(),u=r?l.x:h?e.width()-(t.width()-l.x):l.x*i,g=c?l.y:d?e.height()-(t.height()-l.y):l.y*n,l.x===u&&l.y===g||s.bounds.centerMoveTo(u,g)}),this.getLabels().each(function(s){s.isAnchorLeft()||(s.isAnchorRight()?s.setX(e.width()-(t.width()-s.oldX)):s.setX((s.position?s.position.x:s.x)*i)),s.isAnchorTop()||(s.isAnchorBottom()?s.setY(e.height()-(t.height()-s.oldY)):s.setY((s.position?s.position.y:s.y)*n)),s.position&&(s.isOriginAnchorLeft()||(s.isOriginAnchorRight()?s.setOriginX(e.width()-(t.width()-s.oldX)):s.setOriginX(s.x*i)),s.isOriginAnchorTop()||(s.isOriginAnchorBottom()?s.setOriginY(e.height()-(t.height()-s.oldY)):s.setOriginY(s.y*n)))});var f=this.dockers[0];f&&(f.bounds.unregisterCallback(this._dockerChangedCallback),this._dockerUpdated||(f.bounds.centerMoveTo(this.bounds.center()),this._dockerUpdated=!1),f.update(),f.bounds.registerCallback(this._dockerChangedCallback)),this.isResized=!1}this.refresh(),this.isChanged=!1,this._oldBounds=this.bounds.clone()}this.children.each(function(e){e instanceof ORYX.Core.Controls.Docker||e._update()}),this.dockers.length>0&&!this.dockers.first().getDockedShape()&&this.dockers.each(function(e){e.bounds.centerMoveTo(this.bounds.center())}.bind(this))},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e=this.bounds.upperLeft().x,t=this.bounds.upperLeft().y;this.node.firstChild.setAttributeNS(null,"transform","translate("+e+", "+t+")"),this.node.childNodes[1].childNodes[1].setAttributeNS(null,"transform","translate("+e+", "+t+")"),this._svgShapes.each(function(e){e.update()})},_dockerChanged:function(){var e=this.dockers[0];this.bounds.centerMoveTo(e.bounds.center()),this._dockerUpdated=!0},_initSVGShapes:function(e){var t=[];try{var i=new ORYX.Core.SVG.SVGShape(e);t.push(i)}catch(n){}if(e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++)t=t.concat(this._initSVGShapes(e.childNodes[s]));return t},isPointIncluded:function(e,t,i){var n=i&&i instanceof ORYX.Core.Bounds?i:this.absoluteBounds();if(!n.isIncluded(e,t))return!1;var s=n.upperLeft(),o=e-s.x,a=t-s.y,r=0;do var h=this._svgShapes[r++].isPointIncluded(o,a);while(!h&&r<this._svgShapes.length);return h},isPointOverOffset:function(e,t){var i=arguments.callee.$.isPointOverOffset.apply(this,arguments);if(i){var n=this.absoluteBounds();if(n.widen(-ORYX.CONFIG.BORDER_OFFSET),!n.isIncluded(e,t))return!0}return!1},serialize:function(){var e=arguments.callee.$.serialize.apply(this);this.dockers.each(function(t){if(t.getDockedShape()){var i=t.referencePoint;i=i?i:t.bounds.center(),e.push({name:"docker",prefix:"oryx",value:$H(i).values().join(","),type:"literal"})}}.bind(this));try{var t=this.getStencil().serialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}return e},deserialize:function(e){arguments.callee.$.deserialize.apply(this,arguments);try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}var n=e.findAll(function(e){return e.prefix+"-"+e.name=="raziel-outgoing"});if(n.each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t instanceof ORYX.Core.Edge?(t.dockers.first().setDockedShape(this),t.dockers.first().setReferencePoint(t.dockers.first().bounds.center())):t.dockers.length>0&&t.dockers.first().setDockedShape(this))}}.bind(this)),1===this.dockers.length){var s;if(s=e.find(function(e){return e.prefix+"-"+e.name=="oryx-dockers"})){var o=s.value.replace(/,/g," ").split(" ").without("").without("#");2===o.length&&this.dockers[0].getDockedShape()?this.dockers[0].setReferencePoint({x:parseFloat(o[0]),y:parseFloat(o[1])}):this.dockers[0].bounds.centerMoveTo(parseFloat(o[0]),parseFloat(o[1]))}}},_init:function(e){arguments.callee.$._init.apply(this,arguments);var t=e.getElementsByTagName("g")[0],i=e.ownerDocument.createAttribute("title");i.nodeValue=this.getStencil().title(),t.setAttributeNode(i);var n=e.ownerDocument.createAttribute("id");n.nodeValue=this.id,t.setAttributeNode(n);var s=this.node.childNodes[0].childNodes[0];t=s.appendChild(t),this.addEventHandlers(t.parentNode);var o=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"minimumSize");if(o){o=o.replace("/,/g"," ");var a=o.split(" ");a=a.without(""),a.length>1?this.minimumSize={width:parseFloat(a[0]),height:parseFloat(a[1])}:this.minimumSize={width:1,height:1}}var r=t.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"maximumSize");if(r){r=r.replace("/,/g"," ");var h=r.split(" ");h=h.without(""),h.length>1&&(this.maximumSize={width:parseFloat(h[0]),height:parseFloat(h[1])})}if(this.minimumSize&&this.maximumSize&&(this.minimumSize.width>this.maximumSize.width||this.minimumSize.height>this.maximumSize.height))throw this+": Minimum Size must be greater than maxiumSize.";this._svgShapes=this._initSVGShapes(t);var c={x:void 0,y:void 0},d={x:void 0,y:void 0},l=this;this._svgShapes.each(function(e){c.x=void 0!==c.x?Math.min(c.x,e.x):e.x,c.y=void 0!==c.y?Math.min(c.y,e.y):e.y,d.x=void 0!==d.x?Math.max(d.x,e.x+e.width):e.x+e.width,d.y=void 0!==d.y?Math.max(d.y,e.y+e.height):e.y+e.height,e.isHorizontallyResizable&&(l.isHorizontallyResizable=!0,l.isResizable=!0),e.isVerticallyResizable&&(l.isVerticallyResizable=!0,l.isResizable=!0),e.anchorTop&&e.anchorBottom&&(l.isVerticallyResizable=!0,l.isResizable=!0),e.anchorLeft&&e.anchorRight&&(l.isHorizontallyResizable=!0,l.isResizable=!0)}),this._svgShapes.each(function(e){e.x-=c.x,e.y-=c.y,e.update()});var u=c.x,g=c.y;d.x-=u,d.y-=g,c.x=0,c.y=0,0===d.x&&(d.x=1),0===d.y&&(d.y=1),this._oldBounds.set(c,d),this.bounds.set(c,d);var f=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnets");if(f&&f.length>0){f=$A(f[0].getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"magnet"));var l=this;f.each(function(e){var t=new ORYX.Core.Controls.Magnet({eventHandlerCallback:l.eventHandlerCallback}),i=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),n=parseFloat(e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));t.bounds.centerMoveTo({x:i-u,y:n-g});var s=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(s){s=s.replace("/,/g"," "),s=s.split(" ").without("");for(var o=0;o<s.length;o++)switch(s[o].toLowerCase()){case"left":t.anchorLeft=!0;break;case"right":t.anchorRight=!0;break;case"top":t.anchorTop=!0;break;case"bottom":t.anchorBottom=!0}}if(l.add(t),!this._defaultMagnet){var a=e.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"default");a&&"yes"===a.toLowerCase()&&(l._defaultMagnet=t)}})}else{var p=new ORYX.Core.Controls.Magnet;p.bounds.centerMoveTo(this.bounds.width()/2,this.bounds.height()/2),this.add(p)}var O=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_ORYX,"docker");if(O&&O.length>0){O=O[0];var R=this.createDocker(),S=parseFloat(O.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cx")),m=parseFloat(O.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"cy"));R.bounds.centerMoveTo({x:S-u,y:m-g});var v=O.getAttributeNS(ORYX.CONFIG.NAMESPACE_ORYX,"anchors");if(v){v=v.replace("/,/g"," "),v=v.split(" ").without("");for(var E=0;E<v.length;E++)switch(v[E].toLowerCase()){case"left":R.anchorLeft=!0;break;case"right":R.anchorRight=!0;break;case"top":R.anchorTop=!0;break;case"bottom":R.anchorBottom=!0}}}var N=t.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(N).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});t.x-=u,t.y-=g,this._labels.set(t.id,t),t.registerOnChange(this.layout.bind(this)),0==this._stencil.id().indexOf(ORYX.CONFIG.FORM_ELEMENT_ID_PREFIX)&&t.registerOnChange(this.fitToLabels.bind(this))}.bind(this))},fitToLabels:function(){var e=0;this.getLabels().each(function(t){var i=t.getY()+t.getHeight();i>e&&(e=i)});var t=this.bounds,i=!1;if(this.minimumSize){var n=this.minimumSize.height;e<n&&t.height()>n&&n>this.forcedHeight?(t.set(t.upperLeft().x,t.upperLeft().y,t.lowerRight().x,t.upperLeft().y+n),i=!0):e>n&&t.height()!=e&&e>this.forcedHeight?(t.set(t.upperLeft().x,t.upperLeft().y,t.lowerRight().x,t.upperLeft().y+e),i=!0):t.height()>this.forcedHeight&&this.forcedHeight>0&&(t.set(t.upperLeft().x,t.upperLeft().y,t.lowerRight().x,t.upperLeft().y+this.forcedHeight),i=!0)}if(i&&(null!=this.facade.getCanvas()&&this.facade.getCanvas().update(),this.facade.getSelection().member(this))){var s=this.facade.getSelection();this.facade.setSelection([]),this.facade.setSelection(s)}},createDocker:function(){var e=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});return e.bounds.registerCallback(this._dockerChangedCallback),this.dockers.push(e),e.parent=this,e.bounds.registerCallback(this._changedCallback),e},toString:function(){return this._stencil.title()+" "+this.id}},ORYX.Core.Node=ORYX.Core.Shape.extend(ORYX.Core.Node),NAMESPACE_SVG="http://www.w3.org/2000/svg",NAMESPACE_ORYX="http://www.b3mn.org/oryx",!ORYX)var ORYX={};if(ORYX.Core||(ORYX.Core={}),ORYX.Core.Edge={construct:function(e,t,i){arguments.callee.$.construct.apply(this,arguments),this.isMovable=!0,this.isSelectable=!0,this._dockerUpdated=!1,this._markers=new Hash,this._paths=[],this._interactionPaths=[],this._dockersByPath=new Hash,this._markersByPath=new Hash,this.attachedNodePositionData=new Hash;var n=this.node.childNodes[0].childNodes[0];n=ORYX.Editor.graft("http://www.w3.org/2000/svg",n,["g",{"pointer-events":"painted"}]),this.addEventHandlers(n.parentNode),this._oldBounds=this.bounds.clone(),this._init(this._stencil.view()),t instanceof Array&&this.deserialize(t)},_update:function(e){if(this._dockerUpdated||this.isChanged||e){this.dockers.invoke("update");var t=this.bounds.upperLeft(),i=this._oldBounds.upperLeft(),n=0===this._oldBounds.width()?this.bounds.width():this._oldBounds.width(),s=0===this._oldBounds.height()?this.bounds.height():this._oldBounds.height(),o=t.x-i.x,a=t.y-i.y,r=this.bounds.width()/n||1,h=this.bounds.height()/s||1;if(this.dockers.each(function(e){if(e.bounds.unregisterCallback(this._dockerChangedCallback),!this._dockerUpdated&&(e.bounds.moveBy(o,a),1!==r||1!==h)){var i=e.bounds.upperLeft().x-t.x,n=e.bounds.upperLeft().y-t.y;e.bounds.moveTo(t.x+i*r,t.y+n*h)}e.update(),e.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerUpdated){var c=this.dockers.first().bounds.center(),d=this.dockers.first().bounds.center();this.dockers.each(function(e){var t=e.bounds.center();c.x=Math.min(c.x,t.x),c.y=Math.min(c.y,t.y),d.x=Math.max(d.x,t.x),d.y=Math.max(d.y,t.y)}.bind(this)),this.bounds.set(Object.clone(c),Object.clone(d))}t=this.bounds.upperLeft(),i=this._oldBounds.upperLeft(),r=this.bounds.width()/(n||this.bounds.width()),h=this.bounds.height()/(s||this.bounds.height()),o=t.x-i.x,a=t.y-i.y,this.getLabels().each(function(e){if(e.getReferencePoint()){var t=e.getReferencePoint(),i=t.segment.from,n=t.segment.to;if(!(i&&i.parent&&n&&n.parent))return;var s=i.bounds.center(),c=n.bounds.center();if(s.x===t.segment.fromPosition.x&&s.y===t.segment.fromPosition.y&&c.x===t.segment.toPosition.x&&c.y===t.segment.toPosition.y&&!t.dirty)return;if(this.parent.initializingShapes){var d=ORYX.Core.Math.getOrthogonalIdentityVector(s,c);d.x*=t.distance,d.y*=t.distance,d.x+=t.intersection.x,d.y+=t.intersection.y,e.setX(d.x),e.setY(d.y),t.segment.fromPosition=s,t.segment.toPosition=c}else{var l=ORYX.Core.Math.getDistanceBetweenTwoPoints(t.segment.fromPosition,t.segment.toPosition,t.intersection),u=ORYX.Core.Math.getPointBetweenTwoPoints(s,c,isNaN(l)?.5:l),d=ORYX.Core.Math.getOrthogonalIdentityVector(s,c),g=1===Math.abs(d.y),f=1===Math.abs(d.x);d.x*=t.distance,d.y*=t.distance,d.x+=u.x,d.y+=u.y;var p=g&&t.orientation&&(t.iorientation||t.orientation).endsWith("r")?-e.getWidth():0,O=f&&t.orientation&&(t.iorientation||t.orientation).startsWith("l")?-e.getHeight()+2:0;e.setX(d.x+p),e.setY(d.y+O),this.updateReferencePointOfLabel(e,u,i,n)}}else{if(e.position&&!this.parent.initializingShapes){var R=e.position.x+o*(r||1);R>this.bounds.lowerRight().x&&(R+=this.bounds.width()-this.bounds.width()/(r||1));var S=e.position.y+a*(h||1);return S>this.bounds.lowerRight().y&&(S+=this.bounds.height()-this.bounds.height()/(h||1)),e.setX(R),void e.setY(S)}switch(e.getEdgePosition()){case"starttop":var m=this._getAngle(this.dockers[0],this.dockers[1]),v=this.dockers.first().bounds.center();m<=90||m>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=v.x+e.getOffsetTop(),e.y=v.y-e.getOffsetTop(),e.rotate(360-m,v)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=v.x-e.getOffsetTop(),e.y=v.y-e.getOffsetTop(),e.rotate(180-m,v));break;case"startmiddle":var m=this._getAngle(this.dockers[0],this.dockers[1]),v=this.dockers.first().bounds.center();m<=90||m>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=v.x+2,e.y=v.y+4,e.rotate(360-m,v)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=v.x+1,e.y=v.y+4,e.rotate(180-m,v));break;case"startbottom":var m=this._getAngle(this.dockers[0],this.dockers[1]),v=this.dockers.first().bounds.center();m<=90||m>270?(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=v.x+e.getOffsetBottom(),e.y=v.y+e.getOffsetBottom(),e.rotate(360-m,v)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=v.x-e.getOffsetBottom(),e.y=v.y+e.getOffsetBottom(),e.rotate(180-m,v));break;case"midtop":var E=this.dockers.length;if(E%2==0){var m=this._getAngle(this.dockers[E/2-1],this.dockers[E/2]),N=this.dockers[E/2-1].bounds.center(),C=this.dockers[E/2].bounds.center(),v={x:(N.x+C.x)/2,y:(N.y+C.y)/2};e.horizontalAlign("center"),e.verticalAlign("bottom"),e.x=v.x,e.y=v.y-e.getOffsetTop(),m<=90||m>270?e.rotate(360-m,v):e.rotate(180-m,v)}else{var b=parseInt(E/2),m=this._getAngle(this.dockers[b],this.dockers[b+1]),v=this.dockers[b].bounds.center();m<=90||m>270?(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=v.x+e.getOffsetTop(),e.y=v.y-e.getOffsetTop(),e.rotate(360-m,v)):(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=v.x-e.getOffsetTop(),e.y=v.y-e.getOffsetTop(),e.rotate(180-m,v))}break;case"midbottom":var E=this.dockers.length;if(E%2==0){var m=this._getAngle(this.dockers[E/2-1],this.dockers[E/2]),N=this.dockers[E/2-1].bounds.center(),C=this.dockers[E/2].bounds.center(),v={x:(N.x+C.x)/2,y:(N.y+C.y)/2};e.horizontalAlign("center"),e.verticalAlign("top"),e.x=v.x,e.y=v.y+e.getOffsetTop(),m<=90||m>270?e.rotate(360-m,v):e.rotate(180-m,v)}else{var b=parseInt(E/2),m=this._getAngle(this.dockers[b],this.dockers[b+1]),v=this.dockers[b].bounds.center();m<=90||m>270?(e.horizontalAlign("left"),
e.verticalAlign("top"),e.x=v.x+e.getOffsetBottom(),e.y=v.y+e.getOffsetBottom(),e.rotate(360-m,v)):(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=v.x-e.getOffsetBottom(),e.y=v.y+e.getOffsetBottom(),e.rotate(180-m,v))}break;case"endtop":var _=this.dockers.length,m=this._getAngle(this.dockers[_-2],this.dockers[_-1]),v=this.dockers.last().bounds.center();m<=90||m>270?(e.horizontalAlign("right"),e.verticalAlign("bottom"),e.x=v.x-e.getOffsetTop(),e.y=v.y-e.getOffsetTop(),e.rotate(360-m,v)):(e.horizontalAlign("left"),e.verticalAlign("bottom"),e.x=v.x+e.getOffsetTop(),e.y=v.y-e.getOffsetTop(),e.rotate(180-m,v));break;case"endbottom":var _=this.dockers.length,m=this._getAngle(this.dockers[_-2],this.dockers[_-1]),v=this.dockers.last().bounds.center();m<=90||m>270?(e.horizontalAlign("right"),e.verticalAlign("top"),e.x=v.x-e.getOffsetBottom(),e.y=v.y+e.getOffsetBottom(),e.rotate(360-m,v)):(e.horizontalAlign("left"),e.verticalAlign("top"),e.x=v.x+e.getOffsetBottom(),e.y=v.y+e.getOffsetBottom(),e.rotate(180-m,v))}}}.bind(this)),this.children.each(function(e){e instanceof ORYX.Core.Node&&this.calculatePositionOfAttachedChildNode.call(this,e)}.bind(this)),this.refreshAttachedNodes(),this.refresh(),this.isChanged=!1,this._dockerUpdated=!1,this._oldBounds=this.bounds.clone()}var l=navigator.userAgent;(navigator.appVersion.indexOf("MSIE 10")!==-1||l.indexOf("Trident")!==-1&&l.indexOf("rv:11")!==-1)&&this.node.parentNode.insertBefore(this.node,this.node)},movePointToUpperLeftOfNode:function(e,t){e.x-=t.width()/2,e.y-=t.height()/2},refreshAttachedNodes:function(){this.attachedNodePositionData.values().each(function(e){var t=e.segment.docker1.bounds.center(),i=e.segment.docker2.bounds.center();this.relativizePoint(t),this.relativizePoint(i);var n=new Object;n.x=t.x+e.relativDistanceFromDocker1*(i.x-t.x),n.y=t.y+e.relativDistanceFromDocker1*(i.y-t.y),this.movePointToUpperLeftOfNode(n,e.node.bounds),e.node.bounds.moveTo(n),e.node._update()}.bind(this))},calculatePositionOfAttachedChildNode:function(e){var t=new Object;t.x=0,t.y=0,this.attachedNodePositionData.get(e.getId())?e.isChanged&&this.findEdgeSegmentForNode(e):(this.attachedNodePositionData.set(e.getId(),new Object),this.attachedNodePositionData.get(e.getId()).relativDistanceFromDocker1=0,this.attachedNodePositionData.get(e.getId()).node=e,this.attachedNodePositionData.get(e.getId()).segment=new Object,this.findEdgeSegmentForNode(e))},findEdgeSegmentForNode:function(e){var t=this.dockers.length,n=void 0;for(i=1;i<t;i++){var s=this.dockers[i-1].bounds.center(),o=this.dockers[i].bounds.center();this.relativizePoint(s),this.relativizePoint(o);var a=e.bounds.center(),r=ORYX.Core.Math.distancePointLinie(s,o,a,!0);if((r||0==r)&&(!n&&0!=n||r<n)&&(n=r,this.attachedNodePositionData.get(e.getId()).segment.docker1=this.dockers[i-1],this.attachedNodePositionData.get(e.getId()).segment.docker2=this.dockers[i]),!r&&!n&&0!=n){var h=ORYX.Core.Math.getDistancePointToPoint(a,s),c=ORYX.Core.Math.getDistancePointToPoint(a,o);h<c?this.attachedNodePositionData.get(e.getId()).relativDistanceFromDocker1=0:this.attachedNodePositionData.get(e.getId()).relativDistanceFromDocker1=1,this.attachedNodePositionData.get(e.getId()).segment.docker1=this.dockers[i-1],this.attachedNodePositionData.get(e.getId()).segment.docker2=this.dockers[i]}}(n||0==n)&&(this.attachedNodePositionData.get(e.getId()).relativDistanceFromDocker1=this.getLineParameterForPosition(this.attachedNodePositionData.get(e.getId()).segment.docker1,this.attachedNodePositionData.get(e.getId()).segment.docker2,e))},findSegment:function(e){var t,n=this.dockers.length,s=e instanceof ORYX.Core.UIObject?e.bounds.center():e;for(i=1;i<n;i++){var o=this.dockers[i-1].bounds.center(),a=this.dockers[i].bounds.center(),r=ORYX.Core.Math.distancePointLinie(o,a,s,!0);"number"==typeof r&&(void 0===t||r<t.distance)&&(t={distance:r,fromDocker:this.dockers[i-1],toDocker:this.dockers[i]})}return t},getLineParameterForPosition:function(e,t,i){var n=e.bounds.center(),s=t.bounds.center();this.relativizePoint(n),this.relativizePoint(s);var o=ORYX.Core.Math.getPointOfIntersectionPointLine(n,s,i.bounds.center(),!0);if(!o)return 0;var a=ORYX.Core.Math.getDistancePointToPoint(o,n)/ORYX.Core.Math.getDistancePointToPoint(n,s);return a},relativizePoint:function(e){e.x-=this.bounds.upperLeft().x,e.y-=this.bounds.upperLeft().y},optimizedUpdate:function(){var e=function(e){if(e._dockedShape&&e._dockedShapeBounds){var t={x:e._dockedShape.bounds.a.x-e._dockedShapeBounds.a.x,y:e._dockedShape.bounds.a.y-e._dockedShapeBounds.a.y};e.bounds.moveBy(t),e._dockedShapeBounds.moveBy(t)}};e(this.dockers.first()),e(this.dockers.last()),this.refresh()},refresh:function(){arguments.callee.$.refresh.apply(this,arguments);var e;if(this._paths.each(function(t,i){var n=this._dockersByPath.get(t.id),s=void 0,o=void 0;e?o="M"+e.x+" "+e.y:(s=n[0].bounds.center(),e=s,o="M"+s.x+" "+s.y);for(var a=1;a<n.length;a++)s=n[a].bounds.center(),o=o+"L"+s.x+" "+s.y+" ",e=s;t.setAttributeNS(null,"d",o),this._interactionPaths[i].setAttributeNS(null,"d",o)}.bind(this)),this.getChildNodes().length>0){var t=this.bounds.upperLeft().x,i=this.bounds.upperLeft().y;this.node.firstChild.childNodes[1].setAttributeNS(null,"transform","translate("+t+", "+i+")")}},getIntersectionPoint:function(){var e=Math.floor(this.dockers.length/2);return ORYX.Core.Math.midPoint(this.dockers[e-1].bounds.center(),this.dockers[e].bounds.center())},isBoundsIncluded:function(e){var t=this.dockers,i=t.length;return t.any(function(n,s){if(s==i-1)return!1;var o=n.bounds.center(),a=t[s+1].bounds.center();return ORYX.Core.Math.isRectOverLine(o.x,o.y,a.x,a.y,e.a.x,e.a.y,e.b.x,e.b.y)})},isPointIncluded:function(e,t){var i=this.absoluteBounds().isIncluded(e,t,ORYX.CONFIG.OFFSET_EDGE_BOUNDS),n=void 0;if(i&&this.dockers.length>0){var s,o,a=0;do s=this.dockers[a].bounds.center(),o=this.dockers[++a].bounds.center(),n=ORYX.Core.Math.isPointInLine(e,t,s.x,s.y,o.x,o.y,ORYX.CONFIG.OFFSET_EDGE_BOUNDS);while(!n&&a<this.dockers.length-1)}return n},isPointOverOffset:function(){return!1},containsNode:function(e){return!(!this._paths.include(e)&&!this._interactionPaths.include(e))},_getAngle:function(e,t){var i=e instanceof ORYX.Core.Controls.Docker?e.absoluteCenterXY():e,n=t instanceof ORYX.Core.Controls.Docker?t.absoluteCenterXY():t;return ORYX.Core.Math.getAngle(i,n)},alignDockers:function(){this._update(!0);var e=this.dockers.first().bounds.center(),t=this.dockers.last().bounds.center(),i=t.x-e.x,n=t.y-e.y,s=this.dockers.length-1;this.dockers.each(function(t,o){var a=o/s;t.bounds.unregisterCallback(this._dockerChangedCallback),t.bounds.moveTo(e.x+a*i,e.y+a*n),t.bounds.registerCallback(this._dockerChangedCallback)}.bind(this)),this._dockerChanged()},add:function(e){if(arguments.callee.$.add.apply(this,arguments),e instanceof ORYX.Core.Controls.Docker&&this.dockers.include(e)){var t=this._dockersByPath.values()[0];t&&t.splice(this.dockers.indexOf(e),0,e),this.handleChildShapesAfterAddDocker(e)}},handleChildShapesAfterAddDocker:function(e){if(!(!e instanceof ORYX.Core.Controls.Docker)){var t=this.dockers.indexOf(e);if(0<t&&t<this.dockers.length-1){var i=this.dockers[t-1],n=this.dockers[t+1],s=this.getAttachedNodePositionDataForSegment(i,n),o=ORYX.Core.Math.getDistancePointToPoint(i.bounds.center(),e.bounds.center()),a=ORYX.Core.Math.getDistancePointToPoint(n.bounds.center(),e.bounds.center());if(o+a){var r=o/(o+a);s.each(function(t){if(t.value.relativDistanceFromDocker1<r)t.value.segment.docker2=e,t.value.relativDistanceFromDocker1=t.value.relativDistanceFromDocker1/r;else{t.value.segment.docker1=e;var i=1-r,n=t.value.relativDistanceFromDocker1-r;t.value.relativDistanceFromDocker1=n/i}}),this.getLabels().each(function(t){var i=t.getReferencePoint();if(i){var n=this.dockers.indexOf(e);if(n>=i.segment.fromIndex&&n<=i.segment.toIndex){var s=this.findSegment(i.intersection);s||(s.fromDocker=i.segment.fromIndex>=this.dockers.length/2?this.dockers[0]:this.dockers[this.dockers.length-2],s.toDocker=this.dockers[this.dockers.indexOf(from)+1]);var o=s.fromDocker.bounds.center(),a=s.toDocker.bounds.center(),r=ORYX.Core.Math.getPointOfIntersectionPointLine(o,a,i.intersection,!0);this.updateReferencePointOfLabel(t,r,s.fromDocker,s.toDocker,!0)}}}.bind(this)),this.refreshAttachedNodes()}}}},getAttachedNodePositionDataForSegment:function(e,t){if(!(e instanceof ORYX.Core.Controls.Docker&&t instanceof ORYX.Core.Controls.Docker))return[];var i=this.attachedNodePositionData.findAll(function(i){return i.value.segment.docker1===e&&i.value.segment.docker2===t});return i?i:[]},remove:function(e){arguments.callee.$.remove.apply(this,arguments),this.attachedNodePositionData.get(e.getId())&&this.attachedNodePositionData.unset[e.getId()],e instanceof ORYX.Core.Controls.Docker&&this.handleChildShapesAfterRemoveDocker(e)},updateReferencePointOfLabel:function(e,t,i,n,s){if(e.getReferencePoint()&&e.isVisible){var o=e.getReferencePoint();if(o.orientation&&"ce"!==o.orientation){var a=this._getAngle(i,n);o.distance>=0?0==a?(e.horizontalAlign("left"),e.verticalAlign("bottom")):a>0&&a<90?(e.horizontalAlign("right"),e.verticalAlign("bottom")):90==a?(e.horizontalAlign("right"),e.verticalAlign("top")):a>90&&a<180?(e.horizontalAlign("right"),e.verticalAlign("top")):180==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>180&&a<270?(e.horizontalAlign("left"),e.verticalAlign("top")):270==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>270&&a<=360&&(e.horizontalAlign("left"),e.verticalAlign("bottom")):0==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>0&&a<90?(e.horizontalAlign("left"),e.verticalAlign("top")):90==a?(e.horizontalAlign("left"),e.verticalAlign("top")):a>90&&a<180?(e.horizontalAlign("left"),e.verticalAlign("bottom")):180==a?(e.horizontalAlign("left"),e.verticalAlign("bottom")):a>180&&a<270?(e.horizontalAlign("right"),e.verticalAlign("bottom")):270==a?(e.horizontalAlign("right"),e.verticalAlign("top")):a>270&&a<=360&&(e.horizontalAlign("right"),e.verticalAlign("top")),o.iorientation=o.iorientation||o.orientation,o.orientation=("top"==e.verticalAlign()?"u":"l")+("left"==e.horizontalAlign()?"l":"r")}e.setReferencePoint(jQuery.extend({},{intersection:t,segment:{from:i,fromIndex:this.dockers.indexOf(i),fromPosition:i.bounds.center(),to:n,toIndex:this.dockers.indexOf(n),toPosition:n.bounds.center()},dirty:s||!1},o))}},handleChildShapesAfterRemoveDocker:function(e){e instanceof ORYX.Core.Controls.Docker&&(this.attachedNodePositionData.each(function(t){if(t.value.segment.docker1===e){var i=this.dockers.indexOf(t.value.segment.docker2);if(i==-1)return;t.value.segment.docker1=this.dockers[i-1]}else if(t.value.segment.docker2===e){var i=this.dockers.indexOf(t.value.segment.docker1);if(i==-1)return;t.value.segment.docker2=this.dockers[i+1]}}.bind(this)),this.getLabels().each(function(t){var i=t.getReferencePoint();if(i){var n=i.segment.from,s=i.segment.to;if(n===e||s===e){var o=this.findSegment(i.intersection);o?(n=n===e?this.dockers[this.dockers.indexOf(s)-1]:n,s=this.dockers[this.dockers.indexOf(n)+1]):(n=o.fromDocker,s=o.toDocker);var a=ORYX.Core.Math.getPointOfIntersectionPointLine(n.bounds.center(),s.bounds.center(),i.intersection,!0);this.updateReferencePointOfLabel(t,a,n,s,!0)}}}.bind(this)),this.refreshAttachedNodes())},addDocker:function(e,t){var i,n;return this._dockersByPath.any(function(s){return s.value.any(function(o,a){if(i){var r=i.bounds.center(),h=o.bounds.center(),c=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var d=navigator.userAgent;if(d.indexOf("MSIE")>=0){var l=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==l&&(c=l/100)}}if(1!==c&&(e.x=e.x/c,e.y=e.y/c),ORYX.Core.Math.isPointInLine(e.x,e.y,r.x,r.y,h.x,h.y,10)){var u=this._paths.find(function(e){return e.id===s.key});if(u){var g=u.getAttributeNS(NAMESPACE_ORYX,"allowDockers");if(g&&"no"===g.toLowerCase())return!0}var f=t?t:this.createDocker(this.dockers.indexOf(i)+1,e);return f.bounds.centerMoveTo(e),t&&this.add(f,this.dockers.indexOf(i)+1),n=f,!0}return i=o,!1}return i=o,!1}.bind(this))}.bind(this)),n},removeDocker:function(e){this.dockers.length>2&&this.dockers.first()!==e&&this._dockersByPath.any(function(t){return!!t.value.member(e)&&(e===t.value.last()||(this.remove(e),this._dockersByPath.set(t.key,t.value.without(e)),this.isChanged=!0,this._dockerChanged(),!0))}.bind(this))},removeUnusedDockers:function(){var e=new Hash;return this.dockers.each(function(t,i){if(0!=i&&i!=this.dockers.length-1){var n=this.dockers[i-1];e.values().indexOf(n)!=-1&&this.dockers[i-2]&&(n=this.dockers[i-2]);var s=this.dockers[i+1],o=n.getDockedShape()&&n.referencePoint?n.getAbsoluteReferencePoint():n.bounds.center(),a=s.getDockedShape()&&s.referencePoint?s.getAbsoluteReferencePoint():s.bounds.center(),r=t.bounds.center();ORYX.Core.Math.isPointInLine(r.x,r.y,o.x,o.y,a.x,a.y,1)&&e.set(i,t)}}.bind(this)),e.each(function(e){this.removeDocker(e.value)}.bind(this)),e.values().length>0&&this._update(!0),e},_init:function(e){arguments.callee.$._init.apply(this,arguments);var t,i,n,s,o=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");if(o.length>0){o=o[0];var a,r=$A(o.getElementsByTagNameNS(NAMESPACE_SVG,"marker")),h=this;r.each(function(e){try{a=new ORYX.Core.SVG.SVGMarker(e.cloneNode(!0)),h._markers.set(a.id,a);var t,i=$A(a.element.getElementsByTagNameNS(NAMESPACE_SVG,"text"));i.each(function(e){t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id}),h._labels.set(t.id,t)})}catch(n){}})}var c=e.getElementsByTagNameNS(NAMESPACE_SVG,"g");if(c.length<=0)throw"Edge: No g element found.";var d=c[0];d.setAttributeNS(null,"id",null);var l=!0;$A(d.childNodes).each(function(e,o){if(ORYX.Editor.checkClassType(e,SVGPathElement)){e=e.cloneNode(!1);var a=this.id+"_"+o;e.setAttributeNS(null,"id",a),this._paths.push(e);var r=[],h=e.getAttributeNS(null,"marker-start");if(h&&""!==h){h=h.strip(),h=h.replace(/^url\(#/,"");var c=this.getValidMarkerId(h);e.setAttributeNS(null,"marker-start","url(#"+c+")"),r.push(this._markers.get(c))}if(h=e.getAttributeNS(null,"marker-mid"),h&&""!==h){h=h.strip(),h=h.replace(/^url\(#/,"");var d=this.getValidMarkerId(h);e.setAttributeNS(null,"marker-mid","url(#"+d+")"),r.push(this._markers.get(d))}if(h=e.getAttributeNS(null,"marker-end"),h&&""!==h){h=h.strip();var u=this.getValidMarkerId(h);e.setAttributeNS(null,"marker-end","url(#"+u+")"),r.push(this._markers.get(u))}this._markersByPath[a]=r;var g=new PathParser,f=new ORYX.Core.SVG.PointsPathHandler;if(g.setHandler(f),g.parsePath(e),f.points.length<4)throw"Edge: Path has to have two or more points specified.";this._dockersByPath.set(a,[]);for(var p=0;p<f.points.length;p+=2){var O=f.points[p],R=f.points[p+1];if(l||p>0){var S=new ORYX.Core.Controls.Docker({eventHandlerCallback:this.eventHandlerCallback});S.bounds.centerMoveTo(O,R),S.bounds.registerCallback(this._dockerChangedCallback),this.add(S,this.dockers.length),t?(t=Math.min(O,t),i=Math.min(R,i)):(t=O,i=R),n?(n=Math.max(O,n),s=Math.max(R,s)):(n=O,s=R)}}l=!1}}.bind(this)),this.bounds.set(t,i,n,s);this._oldBounds=this.bounds.clone(),this._paths.reverse();var u=[];this._paths.each(function(e){u.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(e))}.bind(this)),this._paths=u,this._paths.each(function(e){var t=e.cloneNode(!1);t.setAttributeNS(null,"id",void 0),t.setAttributeNS(null,"stroke-width",10),t.setAttributeNS(null,"visibility","hidden"),t.setAttributeNS(null,"stroke-dasharray",null),t.setAttributeNS(null,"stroke","black"),t.setAttributeNS(null,"fill","none"),t.setAttributeNS(null,"title",this.getStencil().title()),this._interactionPaths.push(this.node.childNodes[0].childNodes[0].childNodes[0].appendChild(t))}.bind(this)),this._paths.reverse(),this._interactionPaths.reverse();var g=e.getElementsByTagNameNS(ORYX.CONFIG.NAMESPACE_SVG,"text");$A(g).each(function(e){var t=new ORYX.Core.SVG.Label({textElement:e,shapeId:this.id});this.node.childNodes[0].childNodes[0].appendChild(t.node),this._labels.set(t.id,t),t.registerOnChange(this.layout.bind(this))}.bind(this)),this.propertiesChanged.each(function(e){e.value=!0})},getValidMarkerId:function(e){if(e.indexOf('url("#')>=0){var t=e.replace(/^url\(\"#/,"").replace(/\"\)$/,"");return this.id+t}return e=e.replace(/^url\(#/,""),this.id.concat(e.replace(/\)$/,""))},addMarkers:function(e){this._markers.each(function(t){e.ownerDocument.getElementById(t.value.id)||(t.value.element=e.appendChild(t.value.element))})},removeMarkers:function(){var e=this.node.ownerSVGElement;if(e){var t=e.getElementsByTagNameNS(NAMESPACE_SVG,"defs");t.length>0&&(t=t[0],this._markers.each(function(e){var i=t.ownerDocument.getElementById(e.value.id);i&&(e.value.element=t.removeChild(e.value.element))}))}},_dockerChanged:function(){this._dockerUpdated=!0},serialize:function(){var e=arguments.callee.$.serialize.apply(this),t="";this._dockersByPath.each(function(e){e.value.each(function(e){var i=e.getDockedShape()&&e.referencePoint?e.referencePoint:e.bounds.center();t=t.concat(i.x+" "+i.y+" ")}),t+=" # "}.bind(this)),e.push({name:"dockers",prefix:"oryx",value:t,type:"literal"});var i=this.dockers.last(),n=i.getDockedShape();n&&e.push({name:"target",prefix:"raziel",value:"#"+ERDF.__stripHashes(n.resourceId),type:"resource"});try{var s=this.getStencil().serialize();s.type&&(s.shape=this,s.data=e,s.result=void 0,s.forceExecution=!0,this._delegateEvent(s),s.result&&(e=s.result))}catch(o){}return e},deserialize:function(e){try{var t=this.getStencil().deserialize();t.type&&(t.shape=this,t.data=e,t.result=void 0,t.forceExecution=!0,this._delegateEvent(t),t.result&&(e=t.result))}catch(i){}var n,s=e.find(function(e){return e.prefix+"-"+e.name=="raziel-target"});s&&(n=this.getCanvas().getChildShapeByResourceId(s.value));var o=e.findAll(function(e){return e.prefix+"-"+e.name=="raziel-outgoing"});o.each(function(e){if(this.parent){var t=this.getCanvas().getChildShapeByResourceId(e.value);t&&(t==n?(this.dockers.last().setDockedShape(t),this.dockers.last().setReferencePoint({x:t.bounds.width()/2,y:t.bounds.height()/2})):t instanceof ORYX.Core.Edge&&t.dockers.first().setDockedShape(this))}}.bind(this));var a=e.find(function(e){return"oryx"===e.prefix&&"dockers"===e.name});if(a){var r=a.value.split("#").without("").without(" ");r.each(function(e,t){var i=e.replace(/,/g," ").split(" ").without("");if(i.length%2===0){var n=this._paths[t];if(n){if(0===t)for(;this._dockersByPath.get(n.id).length>2;)this.removeDocker(this._dockersByPath.get(n.id)[1]);else for(;this._dockersByPath.get(n.id).length>1;)this.removeDocker(this._dockersByPath.get(n.id)[0]);var s=this._dockersByPath.get(n.id);if(0===t){var o=parseFloat(i.shift()),a=parseFloat(i.shift());s.first().getDockedShape()?s.first().setReferencePoint({x:o,y:a}):s.first().bounds.centerMoveTo(o,a)}a=parseFloat(i.pop()),o=parseFloat(i.pop()),s.last().getDockedShape()?s.last().setReferencePoint({x:o,y:a}):s.last().bounds.centerMoveTo(o,a);for(var r=0;r<i.length;r++){o=parseFloat(i[r]),a=parseFloat(i[++r]);var h=this.createDocker();h.bounds.centerMoveTo(o,a)}}}}.bind(this))}else this.alignDockers();arguments.callee.$.deserialize.apply(this,arguments),this._changed()},toString:function(){return this.getStencil().title()+" "+this.id},getTarget:function(){return this.dockers.last()?this.dockers.last().getDockedShape():null},getSource:function(){return this.dockers.first()?this.dockers.first().getDockedShape():null},isDocked:function(){var e=!1;return this.dockers.each(function(t){if(t.isDocked())throw e=!0,$break}),e},toJSON:function(){var e=arguments.callee.$.toJSON.apply(this,arguments);return this.getTarget()&&(e.target={resourceId:this.getTarget().resourceId}),e}},ORYX.Core.Edge=ORYX.Core.Shape.extend(ORYX.Core.Edge),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractPlugin=Clazz.extend({facade:null,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.onLoaded.bind(this))},onLoaded:function(){},onSelectionChanged:function(){},showOverlay:function(e,t,i,n){e instanceof Array||(e=[e]),e=e.map(function(e){var t=e;return"string"==typeof e&&(t=this.facade.getCanvas().getChildShapeByResourceId(e),t=t||this.facade.getCanvas().getChildById(e,!0)),t}.bind(this)).compact(),this.overlayID||(this.overlayID=this.type+ORYX.Editor.provideId()),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:this.overlayID,shapes:e,attributes:t,node:i,nodePosition:n||"NW"})},hideOverlay:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:this.overlayID})},doTransform:function(e,t){if(!t||!e)return"";var i=new DOMParser,n=i.parseFromString(e,"text/xml");source=t,new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(e){xsl=e.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var s=new XSLTProcessor,o=new DOMParser,a=o.parseFromString(xsl,"text/xml");s.importStylesheet(a);try{var r=s.transformToFragment(n,document),h=(new XMLSerializer).serializeToString(r);return h=h.startsWith("<?xml")?h:'<?xml version="1.0" encoding="UTF-8"?>'+h}catch(c){return-1}},openXMLWindow:function(e){window.open("data:application/xml,"+encodeURIComponent(e),"_blank","resizable=yes,width=600,height=600,toolbar=0,scrollbars=yes")},openDownloadWindow:function(e,t){var i=window.open("");if(null!=i){i.document.open(),i.document.write("<html><body>");var n=i.document.createElement("form");i.document.body.appendChild(n);var s=function(e,t){var i=document.createElement("input");return i.name=e,i.type="hidden",i.value=t,i};n.appendChild(s("download",t)),n.appendChild(s("file",e)),n.method="POST",i.document.write("</body></html>"),i.document.close(),n.action=ORYX.PATH+"/download",n.submit()}},getSerializedDOM:function(){var e=DataManager.serializeDOM(this.facade);return e='<?xml version="1.0" encoding="utf-8"?><html xmlns="http://www.w3.org/1999/xhtml" xmlns:b3mn="http://b3mn.org/2007/b3mn" xmlns:ext="http://b3mn.org/2007/ext" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:atom="http://b3mn.org/2007/atom+xhtml"><head profile="http://purl.org/NET/erdf/profile"><link rel="schema.dc" href="http://purl.org/dc/elements/1.1/" /><link rel="schema.dcTerms" href="http://purl.org/dc/terms/ " /><link rel="schema.b3mn" href="http://b3mn.org" /><link rel="schema.oryx" href="http://oryx-editor.org/" /><link rel="schema.raziel" href="http://raziel.org/" /><base href="'+location.href.split("?")[0]+'" /></head><body>'+e+"</body></html>"},enableReadOnlyMode:function(){this.facade.disableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange=function(){this.facade.getSelection().length>0&&this.facade.setSelection([])},this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this))},disableReadOnlyMode:function(){this.facade.enableEvent(ORYX.CONFIG.EVENT_MOUSEDOWN),this._stopSelectionChange&&(this.facade.unregisterOnEvent(ORYX.CONFIG.EVENT_SELECTION_CHANGED,this._stopSelectionChange.bind(this)),this._stopSelectionChange=void 0)},getRDFFromDOM:function(){try{var e="";source=ORYX.PATH+"lib/extract-rdf.xsl",new Ajax.Request(source,{asynchronous:!1,method:"get",onSuccess:function(t){e=t.responseText}.bind(this),onFailure:function(e){ORYX.Log.error("XSL load failed"+e)}.bind(this)});var t=new DOMParser,i=t.parseFromString(this.getSerializedDOM(),"text/xml"),n=t.parseFromString(e,"text/xml"),s=new XSLTProcessor;s.importStylesheet(n);var o=s.transformToFragment(i,document),a=new XMLSerializer;return a.serializeToString(o)}catch(r){return console.log("error serializing "+r),""}},isStencilSetExtensionLoaded:function(e){return this.facade.getStencilSets().values().any(function(t){return t.extensions().keys().any(function(t){return t==e}.bind(this))}.bind(this))},doLayout:function(e){this.facade.raiseEvent?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LAYOUT,shapes:e}):this.facade.handleEvents({type:ORYX.CONFIG.EVENT_LAYOUT,shapes:e})},layoutEdges:function(e,t,i){if(this.facade.isExecutingCommands()){var n=ORYX.Core.Command.extend({construct:function(e,t,i,n){this.edges=e,this.node=t,this.plugin=n,this.offset=i;var s=t.absoluteXY();this.ulo={x:s.x-i.x,y:s.y-i.y}},execute:function(){return this.changes?void this.executeAgain():(this.changes=[],this.edges.each(function(e){this.changes.push({edge:e,oldDockerPositions:e.dockers.map(function(e){return e.bounds.center()})})}.bind(this)),this.edges.findAll(function(e){return e.dockers.length>2}.bind(this)).each(function(e){if(e.dockers.first().getDockedShape()===this.node){var t=e.dockers[1];this.align(t.bounds,e.dockers.first())&&t.update()}else if(e.dockers.last().getDockedShape()===this.node){var i=e.dockers[e.dockers.length-2];this.align(i.bounds,e.dockers.last())&&i.update()}if(e._update(!0),e.removeUnusedDockers(),this.isBendPointIncluded(e))return void this.plugin.doLayout(e)}.bind(this)),this.edges.each(function(e){if(2==e.dockers.length){var t=e.dockers.first().getAbsoluteReferencePoint()||e.dockers.first().bounds.center(),i=e.dockers.last().getAbsoluteReferencePoint()||e.dockers.first().bounds.center();(Math.abs(-Math.abs(t.x-i.x)+Math.abs(this.offset.x))<2||Math.abs(-Math.abs(t.y-i.y)+Math.abs(this.offset.y))<2)&&this.plugin.doLayout(e)}}.bind(this)),void this.edges.each(function(e,t){this.changes[t].dockerPositions=e.dockers.map(function(e){return e.bounds.center()})}.bind(this)))},align:function(e,t){var i=t.getAbsoluteReferencePoint()||t.bounds.center(),n=e.center().x-i.x,s=e.center().y-i.y;if(Math.abs(-Math.abs(n)+Math.abs(this.offset.x))<3&&void 0===this.offset.xs&&e.moveBy({x:-n,y:0}),Math.abs(-Math.abs(s)+Math.abs(this.offset.y))<3&&void 0===this.offset.ys&&e.moveBy({y:-s,x:0}),void 0!==this.offset.xs||void 0!==this.offset.ys){var o=t.getDockedShape().absoluteXY();n=e.center().x-(o.x+(i.x-o.x)/this.offset.xs),s=e.center().y-(o.y+(i.y-o.y)/this.offset.ys),Math.abs(-Math.abs(n)+Math.abs(this.offset.x))<3&&e.moveBy({x:-(e.center().x-i.x),y:0}),Math.abs(-Math.abs(s)+Math.abs(this.offset.y))<3&&e.moveBy({y:-(e.center().y-i.y),x:0})}},isBendPointIncluded:function(e){var t=e.dockers.first().getDockedShape(),i=e.dockers.last().getDockedShape();return t&&(t=t.absoluteBounds(),t.widen(5)),i&&(i=i.absoluteBounds(),i.widen(20)),e.dockers.any(function(n,s){var o=n.bounds.center();return 0!=s&&s!=e.dockers.length-1&&(t&&t.isIncluded(o)||i&&i.isIncluded(o))})},removeAllDocker:function(e){e.dockers.slice(1,e.dockers.length-1).each(function(t){e.removeDocker(t)})},executeAgain:function(){this.changes.each(function(e){this.removeAllDocker(e.edge),e.dockerPositions.each(function(t,i){if(0!=i&&i!=e.dockerPositions.length-1){var n=e.edge.createDocker(void 0,t);n.bounds.centerMoveTo(t),n.update()}}.bind(this)),e.edge._update(!0)}.bind(this))},rollback:function(){this.changes.each(function(e){this.removeAllDocker(e.edge),e.oldDockerPositions.each(function(t,i){if(0!=i&&i!=e.oldDockerPositions.length-1){var n=e.edge.createDocker(void 0,t);n.bounds.centerMoveTo(t),n.update()}}.bind(this)),e.edge._update(!0)}.bind(this))}});this.facade.executeCommands([new n(t,e,i,this)])}}}),!ORYX)var ORYX={};if(ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.AbstractLayouter=ORYX.Plugins.AbstractPlugin.extend({layouted:[],construct:function(e){arguments.callee.$.construct.apply(this,arguments),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LAYOUT,this._initLayout.bind(this))},isIncludedInLayout:function(e){return this.layouted instanceof Array||(this.layouted=[this.layouted].compact()),this.layouted.length<=0||this.layouted.any(function(t){return"string"==typeof t?e.getStencil().id().include(t):e instanceof t})},_initLayout:function(e){var t=[e.shapes].flatten().compact(),i=t.findAll(function(e){return this.isIncludedInLayout(e)}.bind(this));i.length>0&&this.layout(i)},layout:function(e){throw new Error("Layouter has to implement the layout function.")}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Edit=Clazz.extend({construct:function(e){this.facade=e,this.clipboard=new ORYX.Plugins.Edit.ClipBoard,this.facade.offer({name:ORYX.I18N.Edit.cut,description:ORYX.I18N.Edit.cutDesc,icon:ORYX.PATH+"images/cut.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:88,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCut),group:ORYX.I18N.Edit.group,index:1,minShape:1}),this.facade.offer({name:ORYX.I18N.Edit.copy,description:ORYX.I18N.Edit.copyDesc,icon:ORYX.PATH+"images/page_copy.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:67,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editCopy,[!0,!1]),group:ORYX.I18N.Edit.group,index:2,minShape:1}),this.facade.offer({name:ORYX.I18N.Edit.paste,description:ORYX.I18N.Edit.pasteDesc,icon:ORYX.PATH+"images/page_paste.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:86,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editPaste),isEnabled:this.clipboard.isOccupied.bind(this.clipboard),group:ORYX.I18N.Edit.group,index:3,minShape:0,maxShape:0}),this.facade.offer({name:ORYX.I18N.Edit.del,description:ORYX.I18N.Edit.delDesc,icon:ORYX.PATH+"images/cross.png",keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:8,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN},{keyCode:46,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.callEdit.bind(this,this.editDelete),group:ORYX.I18N.Edit.group,index:4,minShape:1})},callEdit:function(e,t){window.setTimeout(function(){e.apply(this,t instanceof Array?t:[])}.bind(this),1)},handleMouseDown:function(e){this._controlPressed&&(this._controlPressed=!1,this.editCopy(),this.editPaste(),e.forceExecution=!0,this.facade.raiseEvent(e,this.clipboard.shapesAsJson))},getAllShapesToConsider:function(e){var t=[],i=[];e.each(function(n){if(isChildShapeOfAnother=e.any(function(e){return e.hasChildShape(n)}),!isChildShapeOfAnother){if(t.push(n),n instanceof ORYX.Core.Node){var s=n.getOutgoingNodes();s=s.findAll(function(t){return!e.include(t)}),t=t.concat(s)}i=i.concat(n.getChildShapes(!0))}}.bind(this));var n=this.facade.getCanvas().getChildEdges().select(function(e){return!t.include(e)&&(0!==e.getAllDockedShapes().size()&&e.getAllDockedShapes().all(function(e){return e instanceof ORYX.Core.Edge||i.include(e)}))});return t=t.concat(n)},editCut:function(){return this.editCopy(!1,!0),this.editDelete(!0),!1},editCopy:function(e,t){var i=this.facade.getSelection();0!=i.length&&(this.clipboard.refresh(i,this.getAllShapesToConsider(i),this.facade.getCanvas().getStencil().stencilSet().namespace(),t),e&&this.facade.updateSelection())},editPaste:function(){var e={childShapes:this.clipboard.shapesAsJson,stencilset:{namespace:this.clipboard.SSnamespace}};jQuery.extend(e,ORYX.Core.AbstractShape.JSONHelper);var t=e.getChildShapes(!0).pluck("resourceId"),i={};e.eachChild(function(e,n){return e.outgoing=e.outgoing.select(function(e){return t.include(e.resourceId)}),e.outgoing.each(function(t){i[t.resourceId]||(i[t.resourceId]=[]),i[t.resourceId].push(e)}),e}.bind(this),!0,!0),e.eachChild(function(e,n){return e.target&&!t.include(e.target.resourceId)&&(e.target=void 0,e.targetRemoved=!0),e.dockers&&e.dockers.length>=1&&e.dockers[0].getDocker&&(e.dockers[0].getDocker().getDockedShape()&&!t.include(e.dockers[0].getDocker().getDockedShape().resourceId)||!e.getShape().dockers[0].getDockedShape()&&!i[e.resourceId])&&(e.sourceRemoved=!0),e}.bind(this),!0,!0),e.eachChild(function(e,t){return this.clipboard.useOffset&&(e.bounds={lowerRight:{x:e.bounds.lowerRight.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:e.bounds.lowerRight.y+ORYX.CONFIG.COPY_MOVE_OFFSET},upperLeft:{x:e.bounds.upperLeft.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:e.bounds.upperLeft.y+ORYX.CONFIG.COPY_MOVE_OFFSET}}),e.dockers?e.dockers=e.dockers.map(function(t,n){return(e.targetRemoved===!0&&n==e.dockers.length-1&&t.getDocker||e.sourceRemoved===!0&&0==n&&t.getDocker)&&(t=t.getDocker().bounds.center()),0==n&&t.getDocker instanceof Function&&e.sourceRemoved!==!0&&(t.getDocker().getDockedShape()||(i[e.resourceId]||[]).length>0&&(!(e.getShape()instanceof ORYX.Core.Node)||i[e.resourceId][0].getShape()instanceof ORYX.Core.Node))||n==e.dockers.length-1&&t.getDocker instanceof Function&&e.targetRemoved!==!0&&(t.getDocker().getDockedShape()||e.target)?{
x:t.x,y:t.y,getDocker:t.getDocker}:this.clipboard.useOffset?{x:t.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:t.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:t.getDocker}:{x:t.x,y:t.y,getDocker:t.getDocker}}.bind(this)):e.getShape()instanceof ORYX.Core.Node&&e.dockers&&e.dockers.length>0&&(!e.dockers.first().getDocker||e.sourceRemoved===!0||!e.dockers.first().getDocker().getDockedShape()&&!i[e.resourceId])&&(e.dockers=e.dockers.map(function(t,i){return e.sourceRemoved===!0&&0==i&&t.getDocker&&(t=t.getDocker().bounds.center()),this.clipboard.useOffset?{x:t.x+ORYX.CONFIG.COPY_MOVE_OFFSET,y:t.y+ORYX.CONFIG.COPY_MOVE_OFFSET,getDocker:t.getDocker}:{x:t.x,y:t.y,getDocker:t.getDocker}}.bind(this))),e}.bind(this),!1,!0),this.clipboard.useOffset=!0,this.facade.importJSON(e)},editDelete:function(){var e=this.facade.getSelection();if(e.length>0){var t=new ORYX.Plugins.Edit.ClipBoard;t.refresh(e,this.getAllShapesToConsider(e));var i=new ORYX.Plugins.Edit.DeleteCommand(t,this.facade);this.facade.executeCommands([i])}}}),ORYX.Plugins.Edit.ClipBoard=Clazz.extend({construct:function(){this.shapesAsJson=[],this.selection=[],this.SSnamespace="",this.useOffset=!0},isOccupied:function(){return this.shapesAsJson.length>0},refresh:function(e,t,i,n){this.selection=e,this.SSnamespace=i,this.outgoings={},this.parents={},this.targets={},this.useOffset=n!==!0,this.shapesAsJson=t.map(function(e){var t=e.toJSON();return t.parent={resourceId:e.getParentShape().resourceId},t.parentIndex=e.getParentShape().getChildShapes().indexOf(e),t})}}),ORYX.Plugins.Edit.DeleteCommand=ORYX.Core.Command.extend({construct:function(e,t){this.clipboard=e,this.shapesAsJson=e.shapesAsJson,this.facade=t,this.dockers=this.shapesAsJson.map(function(e){var t=e.getShape(),i=t.getIncomingShapes().map(function(e){return e.getDockers().last()}),n=t.getOutgoingShapes().map(function(e){return e.getDockers().first()}),s=t.getDockers().concat(i,n).compact().map(function(e){return{object:e,referencePoint:e.referencePoint,dockedShape:e.getDockedShape()}});return s}).flatten()},execute:function(){this.shapesAsJson.each(function(e){this.facade.deleteShape(e.getShape())}.bind(this)),this.facade.setSelection([]),this.facade.getCanvas().update(),this.facade.updateSelection(),this.facade.handleEvents({type:ORYX.CONFIG.ACTION_DELETE_COMPLETED})},rollback:function(){this.shapesAsJson.each(function(e){var t=e.getShape(),i=this.facade.getCanvas().getChildShapeByResourceId(e.parent.resourceId)||this.facade.getCanvas();i.add(t,t.parentIndex)}.bind(this)),this.dockers.each(function(e){e.object.setDockedShape(e.dockedShape),e.object.setReferencePoint(e.referencePoint)}.bind(this)),this.facade.setSelection(this.selectedShapes),this.facade.getCanvas().update(),this.facade.updateSelection()}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.View={facade:void 0,construct:function(e,t){this.facade=e,this.zoomLevel=1,this.maxFitToScreenLevel=1.5,this.minZoomLevel=.1,this.maxZoomLevel=2.5,this.diff=5,void 0!==t&&null!==t&&t.get("properties").each(function(e){e.zoomLevel&&(this.zoomLevel=Number(1)),e.maxFitToScreenLevel&&(this.maxFitToScreenLevel=Number(e.maxFitToScreenLevel)),e.minZoomLevel&&(this.minZoomLevel=Number(e.minZoomLevel)),e.maxZoomLevel&&(this.maxZoomLevel=Number(e.maxZoomLevel))}.bind(this)),this.facade.offer({name:ORYX.I18N.View.zoomIn,functionality:this.zoom.bind(this,[1+ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_in.png",description:ORYX.I18N.View.zoomInDesc,index:1,minShape:0,maxShape:0,isEnabled:function(){return this.zoomLevel<this.maxZoomLevel}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomOut,functionality:this.zoom.bind(this,[1-ORYX.CONFIG.ZOOM_OFFSET]),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/magnifier_zoom_out.png",description:ORYX.I18N.View.zoomOutDesc,index:2,minShape:0,maxShape:0,isEnabled:function(){return this._checkSize()}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomStandard,functionality:this.setAFixZoomLevel.bind(this,1),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/zoom_standard.png",cls:"icon-large",description:ORYX.I18N.View.zoomStandardDesc,index:3,minShape:0,maxShape:0,isEnabled:function(){return 1!=this.zoomLevel}.bind(this)}),this.facade.offer({name:ORYX.I18N.View.zoomFitToModel,functionality:this.zoomFitToModel.bind(this),group:ORYX.I18N.View.group,icon:ORYX.PATH+"images/image.png",description:ORYX.I18N.View.zoomFitToModelDesc,index:4,minShape:0,maxShape:0})},setAFixZoomLevel:function(e){this.zoomLevel=e,this._checkZoomLevelRange(),this.zoom(1)},zoom:function(e){this.zoomLevel*=e;var t=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,i=this.facade.getCanvas(),n=i.bounds.width()*this.zoomLevel,s=i.bounds.height()*this.zoomLevel,o=(i.node.parentNode.parentNode.parentNode.offsetHeight-s)/2;o=o>20?o-20:0,i.node.parentNode.parentNode.style.marginTop=o+"px",o+=5,i.getHTMLContainer().style.top=o+"px";var a=t.scrollTop-Math.round((i.getHTMLContainer().parentNode.getHeight()-s)/2)+this.diff,r=t.scrollLeft-Math.round((i.getHTMLContainer().parentNode.getWidth()-n)/2)+this.diff;i.setSize({width:n,height:s},!0),i.node.setAttributeNS(null,"transform","scale("+this.zoomLevel+")"),this.facade.updateSelection(),t.scrollTop=a,t.scrollLeft=r,i.zoomLevel=this.zoomLevel},zoomFitToModel:function(){var e=this.facade.getCanvas().getHTMLContainer().parentNode.parentNode,t=e.getHeight()-30,i=e.getWidth()-30,n=this.facade.getCanvas().getChildShapes();if(!n||n.length<1)return!1;var s=n[0].absoluteBounds().clone();n.each(function(e){s.include(e.absoluteBounds().clone())});var o=i/s.width(),a=t/s.height(),r=a<o?a:o;r>this.maxFitToScreenLevel&&(r=this.maxFitToScreenLevel),this.setAFixZoomLevel(r),e.scrollTop=Math.round(s.upperLeft().y*this.zoomLevel)-5,e.scrollLeft=Math.round(s.upperLeft().x*this.zoomLevel)-5},_checkSize:function(){var e=this.facade.getCanvas().getHTMLContainer().parentNode,t=Math.min(e.parentNode.getWidth()/e.getWidth(),e.parentNode.getHeight()/e.getHeight());return 1.05>t},_checkZoomLevelRange:function(){this.zoomLevel<this.minZoomLevel&&(this.zoomLevel=this.minZoomLevel),this.zoomLevel>this.maxZoomLevel&&(this.zoomLevel=this.maxZoomLevel)}},ORYX.Plugins.View=Clazz.extend(ORYX.Plugins.View),!Signavio)var Signavio={};if(Signavio.Core||(Signavio.Core={}),Signavio.Core.Version="1.0",!Signavio)var Signavio=new Object;Signavio.Plugins||(Signavio.Plugins=new Object),Signavio.Plugins.Utils||(Signavio.Plugins.Utils=new Object),Signavio.Helper||(Signavio.Helper=new Object),new function(){ORYX.Editor.provideId=function(){for(var e=[],t="0123456789ABCDEF",i=0;i<36;i++)e[i]=Math.floor(16*Math.random());e[14]=4,e[19]=3&e[19]|8;for(var i=0;i<36;i++)e[i]=t[e[i]];return e[8]=e[13]=e[18]=e[23]="-","sid-"+e.join("")}},ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Loading={construct:function(e){this.facade=e,this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",this.facade.getCanvas().getHTMLContainer().parentNode,["div",{"class":"LoadingIndicator"},""]),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_ENABLE,this.enableLoading.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_DISABLE,this.disableLoading.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADING_STATUS,this.showStatus.bind(this)),this.disableLoading()},enableLoading:function(e){e.text?this.node.innerHTML=e.text+"...":this.node.innerHTML=ORYX.I18N.Loading.waiting,this.node.removeClassName("StatusIndicator"),this.node.addClassName("LoadingIndicator"),this.node.style.display="block";var t=this.facade.getCanvas().rootNode.parentNode.parentNode.parentNode.parentNode;this.node.style.top=t.offsetTop+"px",this.node.style.left=t.offsetLeft+"px"},disableLoading:function(){this.node.style.display="none"},showStatus:function(e){if(e.text){this.node.innerHTML=e.text,this.node.addClassName("StatusIndicator"),this.node.removeClassName("LoadingIndicator"),this.node.style.display="block";var t=this.facade.getCanvas().rootNode.parentNode.parentNode.parentNode.parentNode;this.node.style.top=t.offsetTop+"px",this.node.style.left=t.offsetLeft+"px";var i=e.timeout?e.timeout:2e3;window.setTimeout(function(){this.disableLoading()}.bind(this),i)}}},ORYX.Plugins.Loading=Clazz.extend(ORYX.Plugins.Loading),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.CanvasResize=Clazz.extend({construct:function(e){this.facade=e,new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"N",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"W",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"E",this.resize.bind(this)),new ORYX.Plugins.CanvasResizeButton(this.facade.getCanvas(),"S",this.resize.bind(this)),window.setTimeout(function(){jQuery(window).trigger("resize")})},resize:function(e,t){resizeCanvas=function(e,t,i){var n=i.getCanvas(),s=n.bounds,o=i.getCanvas().getHTMLContainer().parentNode.parentNode;if("E"==e||"W"==e?n.setSize({width:(s.width()+t)*n.zoomLevel,height:s.height()*n.zoomLevel}):"S"!=e&&"N"!=e||n.setSize({width:s.width()*n.zoomLevel,height:(s.height()+t)*n.zoomLevel}),"N"==e||"W"==e){var a="N"==e?{x:0,y:t}:{x:t,y:0};n.getChildNodes(!1,function(e){e.bounds.moveBy(a)});var r=n.getChildEdges().findAll(function(e){return e.getAllDockedShapes().length>0}),h=r.collect(function(e){return e.dockers.findAll(function(e){return!e.getDockedShape()})}).flatten();h.each(function(e){e.bounds.moveBy(a)})}else"S"==e?o.scrollTop+=t:"E"==e&&(o.scrollLeft+=t);jQuery(window).trigger("resize"),n.update(),i.updateSelection()};var i=ORYX.Core.Command.extend({construct:function(e,t,i){this.position=e,this.extentionSize=t,this.facade=i},execute:function(){resizeCanvas(this.position,this.extentionSize,this.facade)},rollback:function(){resizeCanvas(this.position,-this.extentionSize,this.facade)},update:function(){}}),n=ORYX.CONFIG.CANVAS_RESIZE_INTERVAL;t&&(n=-n);var s=new i(e,n,this.facade);this.facade.executeCommands([s])}}),ORYX.Plugins.CanvasResizeButton=Clazz.extend({construct:function(e,t,i){this.canvas=e;var n=e.getHTMLContainer().parentNode;window.myParent=n;var s=jQuery("#canvasSection")[0],o=s,a=$$("#canvasSection .ORYX_Editor")[0],r=a.children[0],h="glyphicon glyphicon-chevron-",c="glyphicon glyphicon-chevron-";"N"==t?(h+="up",c+="down"):"S"==t?(h+="down",c+="up"):"E"==t?(h+="right",c+="left"):"W"==t&&(h+="left",c+="right");var d="canvas-shrink-"+t,l="canvas-grow-"+t,u=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",n,["div",{"class":"canvas_resize_indicator canvas_resize_indicator_grow "+t,id:d,title:ORYX.I18N.RESIZE.tipGrow+ORYX.I18N.RESIZE[t]},["i",{"class":h}]]),g=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",n,["div",{"class":"canvas_resize_indicator canvas_resize_indicator_shrink "+t,id:l,title:ORYX.I18N.RESIZE.tipGrow+ORYX.I18N.RESIZE[t]},["i",{"class":c}]]),f=60,p=function(e){var i=e.target.id.indexOf("canvas-shrink")!=-1||e.target.id.indexOf("canvas-grow")!=-1||e.target.parentNode.id.indexOf("canvas-shrink")!=-1||e.target.parentNode.id.indexOf("canvas-grow")!=-1;if(i)return e.target.id==d||e.target.id==l||e.target.parentNode.id==d||e.target.parentNode.id==l;if(e.target!=n&&e.target!=o&&e.target!=o.firstChild&&e.target!=r&&e.target!=o)return!1;var h=void 0!==e.offsetX?e.offsetX:e.layerX,c=void 0!==e.offsetY?e.offsetY:e.layerY,u=0;if(a.clientWidth<s.clientWidth){var g=s.clientWidth-a.clientWidth;u=g/2}return c-=s.scrollTop,h-=s.scrollLeft,"N"==t?c<f:"W"==t?h<f+u:"E"==t?s.clientWidth-h<f+u:"S"==t&&s.clientHeight-c<f},O=function(){u.show();var i=e.bounds.width(),n=e.bounds.height();"N"==t&&n-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_HEIGHT?g.show():"E"==t&&i-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_WIDTH?g.show():"S"==t&&n-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_HEIGHT?g.show():"W"==t&&i-ORYX.CONFIG.CANVAS_RESIZE_INTERVAL>ORYX.CONFIG.CANVAS_MIN_WIDTH?g.show():g.hide()}.bind(this),R=function(){u.hide(),g.hide()};n.parentNode.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,function(e){p(e)?O():R()},!1),u.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,function(e){O()},!0),g.addEventListener(ORYX.CONFIG.EVENT_MOUSEOVER,function(e){O()},!0),n.parentNode.addEventListener(ORYX.CONFIG.EVENT_MOUSEOUT,function(e){R()},!0),R(),u.addEventListener("click",function(){i(t),O()},!0),g.addEventListener("click",function(){i(t,!0),O()},!0)}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.RenameShapes=Clazz.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_CANVAS_SCROLL,this.hideField.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DBLCLICK,this.actOnDBLClick.bind(this)),this.facade.offer({keyCodes:[{keyCode:113,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.renamePerF2.bind(this)}),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.hide.bind(this),!0)},renamePerF2:function(){var e=this.facade.getSelection();this.actOnDBLClick(void 0,e.first())},actOnDBLClick:function(e,t){if(t instanceof ORYX.Core.Shape){this.destroy();var i=t.getStencil().properties().findAll(function(e){return e.refToView()&&e.refToView().length>0&&e.directlyEditable()});i=i.findAll(function(e){return!e.readonly()&&(e.type()==ORYX.CONFIG.TYPE_STRING||e.type()==ORYX.CONFIG.TYPE_EXPRESSION||e.type()==ORYX.CONFIG.TYPE_DATASOURCE)});var n=i.collect(function(e){return e.refToView()}).flatten().compact(),s=t.getLabels().findAll(function(e){return n.any(function(t){return e.id.endsWith(t)})});if(0!=s.length){var o=s.length<=1?s[0]:null;if(!o&&(o=s.find(function(t){return t.node==e.target||t.node==e.target.parentNode}),!o)){var a=this.facade.eventCoordinates(e),r=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var h=navigator.userAgent;if(h.indexOf("MSIE")>=0){var c=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==c&&(r=c/100)}}1!==r&&(a.x=a.x/r,a.y=a.y/r),a.y+=$("editor-header").clientHeight-$("canvasSection").scrollTop-5,0==FLOWABLE.HEADER_CONFIG.showAppTitle&&(a.y+=61),a.x-=$("canvasSection").scrollLeft;var d=this.facade.getCanvas().rootNode.lastChild.getScreenCTM();a.x*=d.a,a.y*=d.d;var l=s.collect(function(e){var t=this.getCenterPosition(e.node),i=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2));return{diff:i,label:e}}.bind(this));l.sort(function(e,t){return e.diff>t.diff}),o=l[0].label}var u=i.find(function(e){return e.refToView().any(function(e){return o.id==t.id+e})}),g=Math.min(Math.max(100,t.bounds.width()),200),f=this.getCenterPosition(o.node,t);f.x-=g/2;var p=u.prefix()+"-"+u.id(),O=document.createElement("textarea");O.id="shapeTextInput",O.style.position="absolute",O.style.width=g+"px",O.style.left=f.x<10?10:f.x+"px",O.style.top=f.y-15+"px",O.className="x-form-textarea x-form-field x_form_text_set_absolute",O.value=t.properties.get(p),this.oldValueText=t.properties.get(p),document.getElementById("canvasSection").appendChild(O),this.shownTextField=O,this.updateValueFunction=function(e,i){var n=t,s=this.facade;if(i!=e){var o=ORYX.Core.Command.extend({construct:function(){this.el=n,this.propId=p,this.oldValue=i,this.newValue=e,this.facade=s},execute:function(){this.el.setProperty(this.propId,this.newValue),this.facade.setSelection([this.el]),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.el.setProperty(this.propId,this.oldValue),this.facade.setSelection([this.el]),this.facade.getCanvas().update(),this.facade.updateSelection()}}),a=new o;this.facade.executeCommands([a])}}.bind(this),jQuery("#shapeTextInput").focus(),jQuery("#shapeTextInput").autogrow(),this.facade.disableEvent(ORYX.CONFIG.EVENT_KEYDOWN)}}},getCenterPosition:function(e,t){if(!e)return{x:0,y:0};for(var i=this.facade.getCanvas().node.getScreenCTM(),n=t.bounds.upperLeft(),s=!0,o=t;s;)if("BPMNDiagram"===o.getParentShape().getStencil().idWithoutNs())s=!1;else{var a=o.getParentShape().bounds.upperLeft();n.x+=a.x,n.y+=a.y,o=o.getParentShape()}var r=t.bounds.midPoint();r.x+=n.x+i.e,r.y+=n.y+i.f,r.x*=i.a,r.y*=i.d;var h=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var c=navigator.userAgent;if(c.indexOf("MSIE")>=0){var d=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==d&&(h=d/100)}}if(1===h)r.y=r.y-jQuery("#canvasSection").offset().top+5,r.x-=jQuery("#canvasSection").offset().left;else{var l=jQuery("#canvasSection").offset().left,u=jQuery("#canvasSection").scrollLeft(),g=jQuery("#canvasSection").scrollTop(),f=i.e-l*h,p=0;f>10&&(p=f/h-f),r.y=r.y-jQuery("#canvasSection").offset().top*h+5+(g*h-g),r.x=r.x-l*h+p+(u*h-u)}return r},hide:function(e){if(this.shownTextField&&(!e||e.target!==this.shownTextField)){var t=this.shownTextField.value;t!==this.oldValueText&&this.updateValueFunction(t,this.oldValueText),this.destroy()}},hideField:function(e){this.shownTextField&&this.destroy()},destroy:function(e){var t=jQuery("#shapeTextInput");t&&(t.remove(),delete this.shownTextField,this.facade.enableEvent(ORYX.CONFIG.EVENT_KEYDOWN))}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.ProcessLink=Clazz.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_PROPERTY_CHANGED,this.propertyChanged.bind(this))},propertyChanged:function(e,t){"oryx-refuri"!==e.name||!t instanceof ORYX.Core.Node||(e.value&&e.value.length>0&&"undefined"!=e.value?this.show(t,e.value):this.hide(t))},show:function(e,t){var i=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["a",{target:"_blank"},["path",{"stroke-width":1,stroke:"#00DD00",fill:"#00AA00",d:"M3,3 l0,-2.5 l7.5,0 l0,-2.5 l7.5,4.5 l-7.5,3.5 l0,-2.5 l-8,0","line-captions":"round"}]]),i=ORYX.Editor.graft("http://www.w3.org/2000/svg",null,["a",{target:"_blank"},["path",{style:"fill:#92BFFC;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72",d:"M0 1.44 L0 15.05 L11.91 15.05 L11.91 5.98 L7.37 1.44 L0 1.44 Z"}],["path",{style:"stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72;fill:none;",transform:"translate(7.5, -8.5)",d:"M0 10.51 L0 15.05 L4.54 15.05"}],["path",{style:"fill:#f28226;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-width:0.72",transform:"translate(-3, -1)",d:"M0 8.81 L0 13.06 L5.95 13.06 L5.95 15.05 A50.2313 50.2313 -175.57 0 0 10.77 11.08 A49.9128 49.9128 -1.28 0 0 5.95 6.54 L5.95 8.81 L0 8.81 Z"}]]);i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_SHOW,id:"arissupport.urlref_"+e.id,shapes:[e],node:i,nodePosition:"SE"})},hide:function(e){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_OVERLAY_HIDE,id:"arissupport.urlref_"+e.id})}}),Array.prototype.insertFrom=function(e,t){t=Math.max(0,t),e=Math.min(Math.max(0,e),this.length-1);var i=this[e],n=this.without(i),s=n.slice(0,t);return s.push(i),n.length>t&&(s=s.concat(n.slice(t))),s},ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Arrangement=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(e){this.facade=e,this.facade.offer({name:ORYX.I18N.Arrangement.am,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_MIDDLE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_middle.png",description:ORYX.I18N.Arrangement.amDesc,index:1,minShape:2}),this.facade.offer({name:ORYX.I18N.Arrangement.ac,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_CENTER]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_center.png",description:ORYX.I18N.Arrangement.acDesc,index:2,minShape:2}),this.facade.offer({name:ORYX.I18N.Arrangement.as,functionality:this.alignShapes.bind(this,[ORYX.CONFIG.EDITOR_ALIGN_SIZE]),group:ORYX.I18N.Arrangement.groupA,icon:ORYX.PATH+"images/shape_align_size.png",description:ORYX.I18N.Arrangement.asDesc,index:3,minShape:2}),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,this.setZLevel.bind(this,this.setToTop)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACK,this.setZLevel.bind(this,this.setToBack)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_FORWARD,this.setZLevel.bind(this,this.setForward)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_ARRANGEMENT_BACKWARD,this.setZLevel.bind(this,this.setBackward))},onSelectionChanged:function(e){var t=this.facade.getSelection();1===t.length&&t[0]instanceof ORYX.Core.Edge&&this.setToTop(t)},setZLevel:function(e,t){var i=ORYX.Core.Command.extend({construct:function(e,t,i){this.callback=e,this.elements=t,this.elAndIndex=t.map(function(e){return{el:e,previous:e.parent.children[e.parent.children.indexOf(e)-1]}}),this.facade=i},execute:function(){this.callback(this.elements),this.facade.setSelection(this.elements)},rollback:function(){for(var e=this.elAndIndex.sortBy(function(e){var t=e.el,i=$A(t.node.parentNode.childNodes);return i.indexOf(t.node)}),t=0;t<e.length;t++){var i=e[t].el,n=i.parent,s=n.children.indexOf(i),o=n.children.indexOf(e[t].previous);o=o||0,n.children=n.children.insertFrom(s,o),i.node.parentNode.insertBefore(i.node,i.node.parentNode.childNodes[o+1])}this.facade.setSelection(this.elements)}}),n=new i(e,this.facade.getSelection(),this.facade);t.excludeCommand?n.execute():this.facade.executeCommands([n])},setToTop:function(e){var t=e.sortBy(function(e,t){var i=$A(e.node.parentNode.childNodes);return i.indexOf(e.node)});t.each(function(e){var t=e.parent;t.children.last()!==e&&(t.children=t.children.without(e),t.children.push(e),e.node.parentNode.appendChild(e.node))})},setToBack:function(e){var t=e.sortBy(function(e,t){var i=$A(e.node.parentNode.childNodes);return i.indexOf(e.node)});t=t.reverse(),t.each(function(e){var t=e.parent;t.children=t.children.without(e),t.children.unshift(e),e.node.parentNode.insertBefore(e.node,e.node.parentNode.firstChild)})},setBackward:function(e){var t=e.sortBy(function(e,t){var i=$A(e.node.parentNode.childNodes);return i.indexOf(e.node)});t=t.reverse();var i=t.findAll(function(e){return!t.some(function(t){return t.node==e.node.previousSibling})});i.each(function(e){if(null!==e.node.previousSibling){var t=e.parent,i=t.children.indexOf(e);t.children=t.children.insertFrom(i,i-1),e.node.parentNode.insertBefore(e.node,e.node.previousSibling)}})},setForward:function(e){var t=e.sortBy(function(e,t){var i=$A(e.node.parentNode.childNodes);return i.indexOf(e.node)}),i=t.findAll(function(e){return!t.some(function(t){return t.node==e.node.nextSibling})});i.each(function(e){var t=e.node.nextSibling;if(null!==t){var i=e.parent.children.indexOf(e),n=e.parent;n.children=n.children.insertFrom(i,i+1),e.node.parentNode.insertBefore(t,e.node)}})},alignShapes:function(e){var t=this.facade.getSelection();if(t=this.facade.getCanvas().getShapesWithSharedParent(t),t=t.findAll(function(e){return e instanceof ORYX.Core.Node}),t=t.findAll(function(e){var i=e.getIncomingShapes();return 0==i.length||!t.include(i[0])}),!(t.length<2)){var i=t[0].absoluteBounds().clone();t.each(function(e){i.include(e.absoluteBounds().clone())});var n=0,s=0;t.each(function(e){n=Math.max(e.bounds.width(),n),s=Math.max(e.bounds.height(),s)});var o=ORYX.Core.Command.extend({construct:function(e,t,i,n,s,o){this.elements=e,this.bounds=t,this.maxHeight=i,this.maxWidth=n,this.way=s,this.facade=o.facade,this.plugin=o,this.orgPos=[]},setBounds:function(e,t){if(t||(t={width:ORYX.CONFIG.MAXIMUM_SIZE,height:ORYX.CONFIG.MAXIMUM_SIZE}),!e.bounds)throw"Bounds not definined.";var i={a:{x:e.bounds.upperLeft().x-(this.maxWidth-e.bounds.width())/2,y:e.bounds.upperLeft().y-(this.maxHeight-e.bounds.height())/2},b:{x:e.bounds.lowerRight().x+(this.maxWidth-e.bounds.width())/2,y:e.bounds.lowerRight().y+(this.maxHeight-e.bounds.height())/2}};this.maxWidth>t.width&&(i.a.x=e.bounds.upperLeft().x-(t.width-e.bounds.width())/2,i.b.x=e.bounds.lowerRight().x+(t.width-e.bounds.width())/2),this.maxHeight>t.height&&(i.a.y=e.bounds.upperLeft().y-(t.height-e.bounds.height())/2,i.b.y=e.bounds.lowerRight().y+(t.height-e.bounds.height())/2),e.bounds.set(i)},execute:function(){this.elements.each(function(e,t){this.orgPos[t]=e.bounds.upperLeft();var i,n=this.bounds.clone();if(e.parent&&!(e.parent instanceof ORYX.Core.Canvas)){var s=e.parent.absoluteBounds().upperLeft();n.moveBy(-s.x,-s.y)}switch(this.way){case ORYX.CONFIG.EDITOR_ALIGN_BOTTOM:i={x:e.bounds.upperLeft().x,y:n.b.y-e.bounds.height()};break;case ORYX.CONFIG.EDITOR_ALIGN_MIDDLE:i={x:e.bounds.upperLeft().x,y:(n.a.y+n.b.y-e.bounds.height())/2};break;case ORYX.CONFIG.EDITOR_ALIGN_TOP:i={x:e.bounds.upperLeft().x,y:n.a.y};break;case ORYX.CONFIG.EDITOR_ALIGN_LEFT:i={x:n.a.x,y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_CENTER:i={x:(n.a.x+n.b.x-e.bounds.width())/2,y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_RIGHT:i={x:n.b.x-e.bounds.width(),y:e.bounds.upperLeft().y};break;case ORYX.CONFIG.EDITOR_ALIGN_SIZE:e.isResizable&&(this.orgPos[t]={a:e.bounds.upperLeft(),b:e.bounds.lowerRight()},this.setBounds(e,e.maximumSize))}if(i){var o={x:e.bounds.upperLeft().x-i.x,y:e.bounds.upperLeft().y-i.y};e.bounds.moveTo(i),this.plugin.layoutEdges(e,e.getAllDockedShapes(),o)}}.bind(this))},rollback:function(){this.elements.each(function(e,t){this.way==ORYX.CONFIG.EDITOR_ALIGN_SIZE?e.isResizable&&e.bounds.set(this.orgPos[t]):e.bounds.moveTo(this.orgPos[t])}.bind(this))}}),a=new o(t,i,s,n,parseInt(e),this);this.facade.executeCommands([a])}}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Save=Clazz.extend({facade:void 0,processURI:void 0,changeSymbol:"*",construct:function(e){this.facade=e,document.addEventListener("keydown",function(e){e.ctrlKey&&83===e.keyCode&&Event.stop(e)},!1),window.onbeforeunload=this.onUnLoad.bind(this),this.changeDifference=0,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_EXECUTE,function(){this.changeDifference++,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_EXECUTE_COMMANDS,function(){this.changeDifference++,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SAVED,function(){this.changeDifference=0,this.updateTitle()}.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_UNDO_ROLLBACK,function(){this.changeDifference--,this.updateTitle()}.bind(this)),this.hasChanges=this._hasChanges.bind(this)},updateTitle:function(){var e=window.document.title||document.getElementsByTagName("title")[0].childNodes[0].nodeValue;0===this.changeDifference&&e.startsWith(this.changeSymbol)?window.document.title=e.slice(1):0===this.changeDifference||e.startsWith(this.changeSymbol)||(window.document.title=this.changeSymbol+""+e)},_hasChanges:function(){return 0!==this.changeDifference||this.facade.getModelMetaData()["new"]&&this.facade.getCanvas().getChildShapes().size()>0},onUnLoad:function(){if(this._hasChanges())return ORYX.I18N.Save.unsavedData}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.DragDropResize=ORYX.Plugins.AbstractPlugin.extend({construct:function(e){this.facade=e,this.currentShapes=[],this.toMoveShapes=[],this.distPoints=[],this.isResizing=!1,this.dragEnable=!1,this.dragIntialized=!1,this.edgesMovable=!0,this.offSetPosition={x:0,y:0},this.faktorXY={x:1,y:1},this.containmentParentNode,this.isAddingAllowed=!1,this.isAttachingAllowed=!1,this.callbackMouseMove=this.handleMouseMove.bind(this),this.callbackMouseUp=this.handleMouseUp.bind(this);var t=this.facade.getCanvas().getSvgContainer();this.selectedRect=new ORYX.Plugins.SelectedRect(t),ORYX.CONFIG.SHOW_GRIDLINE&&(this.vLine=new ORYX.Plugins.GridLine(t,ORYX.Plugins.GridLine.DIR_VERTICAL),this.hLine=new ORYX.Plugins.GridLine(t,ORYX.Plugins.GridLine.DIR_HORIZONTAL)),t=this.facade.getCanvas().getHTMLContainer(),this.scrollNode=this.facade.getCanvas().rootNode.parentNode.parentNode,this.resizerSE=new ORYX.Plugins.Resizer(t,"southeast",this.facade),this.resizerSE.registerOnResize(this.onResize.bind(this)),this.resizerSE.registerOnResizeEnd(this.onResizeEnd.bind(this)),this.resizerSE.registerOnResizeStart(this.onResizeStart.bind(this)),this.resizerNW=new ORYX.Plugins.Resizer(t,"northwest",this.facade),this.resizerNW.registerOnResize(this.onResize.bind(this)),this.resizerNW.registerOnResizeEnd(this.onResizeEnd.bind(this)),this.resizerNW.registerOnResizeStart(this.onResizeStart.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this))},handleMouseDown:function(e,t){if(this.dragBounds&&this.currentShapes.member(t)&&this.toMoveShapes.length){this.dragEnable=!0,this.dragIntialized=!0,this.edgesMovable=!0;var i=this.facade.getCanvas().node.getScreenCTM();this.faktorXY.x=i.a,this.faktorXY.y=i.d;var n=Event.pointerX(e),s=Event.pointerY(e),o=this.dragBounds.upperLeft();this.offSetPosition={x:n-o.x*this.faktorXY.x,y:s-o.y*this.faktorXY.y},this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.callbackMouseUp,!0)}},handleMouseUp:function(e){if(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.contain"}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"}),this.dragEnable){if(!this.dragIntialized){if(this.afterDrag(),this.isAttachingAllowed&&1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&this.toMoveShapes[0].dockers.length>0){var t=this.facade.eventCoordinates(e),i=this.toMoveShapes[0].dockers[0],n=ORYX.Core.Command.extend({construct:function(e,t,i,n){this.docker=e,this.newPosition=t,this.newDockedShape=i,this.newParent=i.parent||n.getCanvas(),this.oldPosition=e.parent.bounds.center(),this.oldDockedShape=e.getDockedShape(),this.oldParent=e.parent.parent||n.getCanvas(),this.facade=n,this.oldDockedShape&&(this.oldPosition=e.parent.absoluteBounds().center())},execute:function(){this.dock(this.newDockedShape,this.newParent,this.newPosition),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_ARRANGEMENT_TOP,excludeCommand:!0})},rollback:function(){this.dock(this.oldDockedShape,this.oldParent,this.oldPosition)},dock:function(e,t,i){t.add(this.docker.parent),this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(i),this.docker.setDockedShape(e),this.facade.setSelection([this.docker.parent]),this.facade.getCanvas().update(),this.facade.updateSelection()}}),s=[new n(i,t,this.containmentParentNode,this.facade)];this.facade.executeCommands(s)}else this.isAddingAllowed&&this.refreshSelectedShapes();this.facade.updateSelection(),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_END})}this.vLine&&this.vLine.hide(),this.hLine&&this.hLine.hide()}this.dragEnable=!1,document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.callbackMouseUp,!0),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.callbackMouseMove,!1)},handleMouseMove:function(e){if(this.dragEnable){this.dragIntialized&&(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDROP_START}),this.dragIntialized=!1,this.resizerSE.hide(),this.resizerNW.hide(),this._onlyEdges=this.currentShapes.all(function(e){return e instanceof ORYX.Core.Edge}),this.beforeDrag(),this._currentUnderlyingNodes=[]);var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop;var i=e.shiftKey||e.ctrlKey;ORYX.CONFIG.GRID_ENABLED&&!i?t=this.snapToGrid(t):(this.vLine&&this.vLine.hide(),this.hLine&&this.hLine.hide()),t.x/=this.faktorXY.x,t.y/=this.faktorXY.y,t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);var n=this.facade.getCanvas();t.x=Math.min(n.bounds.width()-this.dragBounds.width(),t.x),t.y=Math.min(n.bounds.height()-this.dragBounds.height(),t.y),this.dragBounds.moveTo(t),this.resizeRectangle(this.dragBounds),this.isAttachingAllowed=!1;var s=this.facade.eventCoordinates(e),o=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var a=navigator.userAgent;if(a.indexOf("MSIE")>=0){var r=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==r&&(o=r/100);
}}1!==o&&(s.x=s.x/o,s.y=s.y/o);var h=$A(this.facade.getCanvas().getAbstractShapesAtPosition(s)),c=1==this.toMoveShapes.length&&this.toMoveShapes[0]instanceof ORYX.Core.Node&&this.toMoveShapes[0].dockers.length>0;if(c=c&&1!=h.length,c||h.length!==this._currentUnderlyingNodes.length||!h.all(function(e,t){return this._currentUnderlyingNodes[t]===e}.bind(this))){if(this._onlyEdges)this.isAddingAllowed=!0,this.containmentParentNode=this.facade.getCanvas();else{var d={event:e,underlyingNodes:h,checkIfAttachable:c};this.checkRules(d)}this._currentUnderlyingNodes=h.reverse(),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.attached",elements:[this.containmentParentNode],style:ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE,color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.attached"}),this.isAttachingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"dragdropresize.contain"}):this.isAddingAllowed?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_VALID_COLOR}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"dragdropresize.contain",elements:[this.containmentParentNode],color:ORYX.CONFIG.SELECTION_INVALID_COLOR})}}},checkRules:function(e){var t=e.event,i=e.underlyingNodes,n=e.checkIfAttachable,s=e.noEdges;if(this.containmentParentNode=i.reverse().find(function(e){return e instanceof ORYX.Core.Canvas||(e instanceof ORYX.Core.Node||e instanceof ORYX.Core.Edge&&!s)&&!(this.currentShapes.member(e)||this.currentShapes.any(function(t){return t.children.length>0&&t.getChildNodes(!0).member(e)}))}.bind(this)),n&&(this.isAttachingAllowed=this.facade.getRules().canConnect({sourceShape:this.containmentParentNode,edgeShape:this.toMoveShapes[0],targetShape:this.toMoveShapes[0]}),this.isAttachingAllowed)){var o=this.facade.eventCoordinates(t);this.isAttachingAllowed=this.containmentParentNode.isPointOverOffset(o.x,o.y)}this.isAttachingAllowed||(this.isAddingAllowed=this.toMoveShapes.all(function(e){return e instanceof ORYX.Core.Edge||e instanceof ORYX.Core.Controls.Docker||this.containmentParentNode===e.parent||!(this.containmentParentNode===e||this.containmentParentNode instanceof ORYX.Core.Edge&&s||!this.facade.getRules().canContain({containingShape:this.containmentParentNode,containedShape:e}))}.bind(this))),!this.isAttachingAllowed&&!this.isAddingAllowed&&this.containmentParentNode instanceof ORYX.Core.Edge&&(e.noEdges=!0,e.underlyingNodes.reverse(),this.checkRules(e))},refreshSelectedShapes:function(){if(this.dragBounds){var e=this.dragBounds.upperLeft(),t=this.oldDragBounds.upperLeft(),i={x:e.x-t.x,y:e.y-t.y},n=[new ORYX.Core.Command.Move(this.toMoveShapes,i,this.containmentParentNode,this.currentShapes,this)];this._undockedEdgesCommand instanceof ORYX.Core.Command&&n.unshift(this._undockedEdgesCommand),this.facade.executeCommands(n),this.dragBounds&&(this.oldDragBounds=this.dragBounds.clone())}},onResize:function(e){this.dragBounds&&(this.dragBounds=e,this.isResizing=!0,this.resizeRectangle(this.dragBounds))},onResizeStart:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_START})},onResizeEnd:function(){if(this.currentShapes instanceof Array&&!(this.currentShapes.length<=0)&&this.isResizing){var e=ORYX.Core.Command.extend({construct:function(e,t,i){this.shape=e,this.oldBounds=e.bounds.clone(),this.newBounds=t,this.plugin=i},execute:function(){this.shape.bounds.set(this.newBounds.a,this.newBounds.b),this.update(this.getOffset(this.oldBounds,this.newBounds))},rollback:function(){this.shape.bounds.set(this.oldBounds.a,this.oldBounds.b),this.update(this.getOffset(this.newBounds,this.oldBounds))},getOffset:function(e,t){return{x:t.a.x-e.a.x,y:t.a.y-e.a.y,xs:t.width()/e.width(),ys:t.height()/e.height()}},update:function(e){this.shape.getLabels().each(function(e){e.changed()});var t=[].concat(this.shape.getIncomingShapes()).concat(this.shape.getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge}.bind(this));this.plugin.layoutEdges(this.shape,t,e),this.plugin.facade.setSelection([this.shape]),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()}}),t=this.dragBounds.clone(),i=this.currentShapes[0];if(i.parent){var n=i.parent.absoluteXY();t.moveBy(-n.x,-n.y)}var s=new e(i,t,this);this.facade.executeCommands([s]),this.isResizing=!1,this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_RESIZE_END})}},beforeDrag:function(){var e=ORYX.Core.Command.extend({construct:function(e){this.dockers=e.collect(function(e){return e instanceof ORYX.Core.Controls.Docker?{docker:e,dockedShape:e.getDockedShape(),refPoint:e.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(e){e.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(e){e.docker.setDockedShape(e.dockedShape),e.docker.setReferencePoint(e.refPoint)})}});this._undockedEdgesCommand=new e(this.toMoveShapes),this._undockedEdgesCommand.execute()},hideAllLabels:function(e){e.getLabels().each(function(e){e.hide()}),e.getAllDockedShapes().each(function(e){var t=e.getLabels();t.length>0&&t.each(function(e){e.hide()})}),e.getChildren().each(function(e){e instanceof ORYX.Core.Shape&&this.hideAllLabels(e)}.bind(this))},afterDrag:function(){},showAllLabels:function(e){for(var t=0;t<e.length;t++){var i=e[t];i.show()}for(var n=e.getAllDockedShapes(),t=0;t<n.length;t++){var s=n[t],o=s.getLabels();o.length>0&&o.each(function(e){e.show()})}for(var t=0;t<e.children.length;t++){var a=e.children[t];a instanceof ORYX.Core.Shape&&this.showAllLabels(a)}},onSelectionChanged:function(e){var t=e.elements;if(this.dragEnable=!1,this.dragIntialized=!1,this.resizerSE.hide(),this.resizerNW.hide(),t&&0!=t.length){this.currentShapes=t;var i=this.facade.getCanvas().getShapesWithSharedParent(t);this.toMoveShapes=i,this.toMoveShapes=this.toMoveShapes.findAll(function(e){return e instanceof ORYX.Core.Node&&(0===e.dockers.length||!t.member(e.dockers.first().getDockedShape()))}),t.each(function(e){if(e instanceof ORYX.Core.Edge){var i=e.getDockers(),n=t.member(i.first().getDockedShape()),s=t.member(i.last().getDockedShape());if(!n&&!s){var o=!i.first().getDockedShape()&&!i.last().getDockedShape();o&&(this.toMoveShapes=this.toMoveShapes.concat(i))}e.dockers.length>2&&n&&s&&(this.toMoveShapes=this.toMoveShapes.concat(i.findAll(function(e,t){return t>0&&t<i.length-1})))}}.bind(this));var n=void 0;if(this.toMoveShapes.each(function(e){var t=e;e instanceof ORYX.Core.Controls.Docker&&(t=e.parent),n?n.include(t.absoluteBounds()):n=t.absoluteBounds()}.bind(this)),n||t.each(function(e){n?n.include(e.absoluteBounds()):n=e.absoluteBounds()}),this.dragBounds=n,this.oldDragBounds=n.clone(),this.resizeRectangle(n),this.selectedRect.show(),1==t.length&&t[0].isResizable){var s=t[0].getStencil().fixedAspectRatio()?t[0].bounds.width()/t[0].bounds.height():void 0;this.resizerSE.setBounds(this.dragBounds,t[0].minimumSize,t[0].maximumSize,s),this.resizerSE.show(),this.resizerNW.setBounds(this.dragBounds,t[0].minimumSize,t[0].maximumSize,s),this.resizerNW.show()}else this.resizerSE.setBounds(void 0),this.resizerNW.setBounds(void 0);ORYX.CONFIG.GRID_ENABLED&&(this.distPoints=[],this.distPointTimeout&&window.clearTimeout(this.distPointTimeout),this.distPointTimeout=window.setTimeout(function(){var e=this.facade.getCanvas().getChildShapes(!0).findAll(function(e){for(var i=e.parent;i;){if(t.member(i))return!1;i=i.parent}return!0});e.each(function(e){if(!(e instanceof ORYX.Core.Edge)){var t=e.absoluteXY(),i=e.bounds.width(),n=e.bounds.height();this.distPoints.push({ul:{x:t.x,y:t.y},c:{x:t.x+i/2,y:t.y+n/2},lr:{x:t.x+i,y:t.y+n}})}}.bind(this))}.bind(this),10))}else this.selectedRect.hide(),this.currentShapes=[],this.toMoveShapes=[],this.dragBounds=void 0,this.oldDragBounds=void 0},snapToGrid:function(e){var t,i,n,s,o=this.dragBounds,a=10,r=this.vLine?this.vLine.getScale():1,h={x:e.x/r,y:e.y/r},c={x:e.x/r+o.width()/2,y:e.y/r+o.height()/2};({x:e.x/r+o.width(),y:e.y/r+o.height()});return this.distPoints.each(function(e){var o,r,h,d;Math.abs(e.c.x-c.x)<a&&(o=e.c.x-c.x,h=e.c.x),Math.abs(e.c.y-c.y)<a&&(r=e.c.y-c.y,d=e.c.y),void 0!==o&&(t=void 0===t?o:Math.abs(o)<Math.abs(t)?o:t,t===o&&(n=h)),void 0!==r&&(i=void 0===i?r:Math.abs(r)<Math.abs(i)?r:i,i===r&&(s=d))}),void 0!==t?(h.x+=t,h.x*=r,this.vLine&&n&&this.vLine.update(n)):(h.x=e.x-e.x%(ORYX.CONFIG.GRID_DISTANCE/2),this.vLine&&this.vLine.hide()),void 0!==i?(h.y+=i,h.y*=r,this.hLine&&s&&this.hLine.update(s)):(h.y=e.y-e.y%(ORYX.CONFIG.GRID_DISTANCE/2),this.hLine&&this.hLine.hide()),h},showGridLine:function(){},resizeRectangle:function(e){this.selectedRect.resize(e)}}),ORYX.Plugins.SelectedRect=Clazz.extend({construct:function(e){this.parentId=e,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",$(e),["g"]),this.dashedArea=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["rect",{x:0,y:0,"stroke-width":1,stroke:"#777777",fill:"none","stroke-dasharray":"2,2","pointer-events":"none"}]),this.hide()},hide:function(){this.node.setAttributeNS(null,"display","none")},show:function(){this.node.setAttributeNS(null,"display","")},resize:function(e){var t=e.upperLeft(),i=ORYX.CONFIG.SELECTED_AREA_PADDING;this.dashedArea.setAttributeNS(null,"width",e.width()+2*i),this.dashedArea.setAttributeNS(null,"height",e.height()+2*i),this.node.setAttributeNS(null,"transform","translate("+(t.x-i)+", "+(t.y-i)+")")}}),ORYX.Plugins.GridLine=Clazz.extend({construct:function(e,t){ORYX.Plugins.GridLine.DIR_HORIZONTAL!==t&&ORYX.Plugins.GridLine.DIR_VERTICAL!==t&&(t=ORYX.Plugins.GridLine.DIR_HORIZONTAL),this.parent=$(e),this.direction=t,this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parent,["g"]),this.line=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["path",{"stroke-width":1,stroke:"silver",fill:"none","stroke-dasharray":"5,5","pointer-events":"none"}]),this.hide()},hide:function(){this.node.setAttributeNS(null,"display","none")},show:function(){this.node.setAttributeNS(null,"display","")},getScale:function(){try{return this.parent.parentNode.transform.baseVal.getItem(0).matrix.a}catch(e){return 1}},update:function(e){if(this.direction===ORYX.Plugins.GridLine.DIR_HORIZONTAL){var t=e instanceof Object?e.y:e,i=this.parent.parentNode.parentNode.width.baseVal.value/this.getScale();this.line.setAttributeNS(null,"d","M 0 "+t+" L "+i+" "+t)}else{var n=e instanceof Object?e.x:e,s=this.parent.parentNode.parentNode.height.baseVal.value/this.getScale();this.line.setAttributeNS(null,"d","M"+n+" 0 L "+n+" "+s)}this.show()}}),ORYX.Plugins.GridLine.DIR_HORIZONTAL="hor",ORYX.Plugins.GridLine.DIR_VERTICAL="ver",ORYX.Plugins.Resizer=Clazz.extend({construct:function(e,t,i){this.parentId=e,this.orientation=t,this.facade=i,this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$("canvasSection"),["div",{"class":"resizer_"+this.orientation,style:"left:0px; top:0px;position:absolute;"}]),this.node.addEventListener(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this),!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.handleMouseMove.bind(this),!1),this.dragEnable=!1,this.offSetPosition={x:0,y:0},this.bounds=void 0,this.canvasNode=this.facade.getCanvas().node,this.minSize=void 0,this.maxSize=void 0,this.aspectRatio=void 0,this.resizeCallbacks=[],this.resizeStartCallbacks=[],this.resizeEndCallbacks=[],this.hide(),this.scrollNode=this.node.parentNode.parentNode.parentNode},handleMouseDown:function(e){this.dragEnable=!0,this.offsetScroll={x:this.scrollNode.scrollLeft,y:this.scrollNode.scrollTop},this.offSetPosition={x:Event.pointerX(e)-this.position.x,y:Event.pointerY(e)-this.position.y},this.resizeStartCallbacks.each(function(e){e(this.bounds)}.bind(this))},handleMouseUp:function(e){this.dragEnable=!1,this.containmentParentNode=null,this.resizeEndCallbacks.each(function(e){e(this.bounds)}.bind(this))},handleMouseMove:function(e){if(this.dragEnable){e.shiftKey||e.ctrlKey?this.aspectRatio=this.bounds.width()/this.bounds.height():this.aspectRatio=void 0;var t={x:Event.pointerX(e)-this.offSetPosition.x,y:Event.pointerY(e)-this.offSetPosition.y};t.x-=this.offsetScroll.x-this.scrollNode.scrollLeft,t.y-=this.offsetScroll.y-this.scrollNode.scrollTop,t.x=Math.min(t.x,this.facade.getCanvas().bounds.width()),t.y=Math.min(t.y,this.facade.getCanvas().bounds.height());var i={x:t.x-this.position.x,y:t.y-this.position.y};this.aspectRatio&&(newAspectRatio=(this.bounds.width()+i.x)/(this.bounds.height()+i.y),newAspectRatio>this.aspectRatio?i.x=this.aspectRatio*(this.bounds.height()+i.y)-this.bounds.width():newAspectRatio<this.aspectRatio&&(i.y=(this.bounds.width()+i.x)/this.aspectRatio-this.bounds.height())),"northwest"===this.orientation?(this.bounds.width()-i.x>this.maxSize.width&&(i.x=-(this.maxSize.width-this.bounds.width()),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.width()-i.x<this.minSize.width&&(i.x=-(this.minSize.width-this.bounds.width()),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.height()-i.y>this.maxSize.height&&(i.y=-(this.maxSize.height-this.bounds.height()),this.aspectRatio&&(i.x=i.y/this.aspectRatio)),this.bounds.height()-i.y<this.minSize.height&&(i.y=-(this.minSize.height-this.bounds.height()),this.aspectRatio&&(i.x=i.y/this.aspectRatio))):(this.bounds.width()+i.x>this.maxSize.width&&(i.x=this.maxSize.width-this.bounds.width(),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.width()+i.x<this.minSize.width&&(i.x=this.minSize.width-this.bounds.width(),this.aspectRatio&&(i.y=this.aspectRatio*i.x)),this.bounds.height()+i.y>this.maxSize.height&&(i.y=this.maxSize.height-this.bounds.height(),this.aspectRatio&&(i.x=i.y/this.aspectRatio)),this.bounds.height()+i.y<this.minSize.height&&(i.y=this.minSize.height-this.bounds.height(),this.aspectRatio&&(i.x=i.y/this.aspectRatio))),"northwest"===this.orientation?(this.bounds.extend({x:-i.x,y:-i.y}),this.bounds.moveBy(i)):this.bounds.extend(i),this.update(),this.resizeCallbacks.each(function(e){e(this.bounds)}.bind(this)),Event.stop(e)}},registerOnResizeStart:function(e){this.resizeStartCallbacks.member(e)||this.resizeStartCallbacks.push(e)},unregisterOnResizeStart:function(e){this.resizeStartCallbacks.member(e)&&(this.resizeStartCallbacks=this.resizeStartCallbacks.without(e))},registerOnResizeEnd:function(e){this.resizeEndCallbacks.member(e)||this.resizeEndCallbacks.push(e)},unregisterOnResizeEnd:function(e){this.resizeEndCallbacks.member(e)&&(this.resizeEndCallbacks=this.resizeEndCallbacks.without(e))},registerOnResize:function(e){this.resizeCallbacks.member(e)||this.resizeCallbacks.push(e)},unregisterOnResize:function(e){this.resizeCallbacks.member(e)&&(this.resizeCallbacks=this.resizeCallbacks.without(e))},hide:function(){this.node.style.display="none"},show:function(){this.bounds&&(this.node.style.display="")},setBounds:function(e,t,i,n){this.bounds=e,t||(t={width:ORYX.CONFIG.MINIMUM_SIZE,height:ORYX.CONFIG.MINIMUM_SIZE}),i||(i={width:ORYX.CONFIG.MAXIMUM_SIZE,height:ORYX.CONFIG.MAXIMUM_SIZE}),this.minSize=t,this.maxSize=i,this.aspectRatio=n,this.update()},update:function(){if(this.bounds){var e=this.bounds.upperLeft();this.bounds.width()<this.minSize.width&&this.bounds.set(e.x,e.y,e.x+this.minSize.width,e.y+this.bounds.height()),this.bounds.height()<this.minSize.height&&this.bounds.set(e.x,e.y,e.x+this.bounds.width(),e.y+this.minSize.height),this.bounds.width()>this.maxSize.width&&this.bounds.set(e.x,e.y,e.x+this.maxSize.width,e.y+this.bounds.height()),this.bounds.height()>this.maxSize.height&&this.bounds.set(e.x,e.y,e.x+this.bounds.width(),e.y+this.maxSize.height);var t=this.canvasNode.getScreenCTM();e.x*=t.a,e.y*=t.d;var i=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var n=navigator.userAgent;if(n.indexOf("MSIE")>=0){var s=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==s&&(i=s/100)}}if(1===i)e.y=e.y-jQuery("#canvasSection").offset().top+t.f,e.x=e.x-jQuery("#canvasSection").offset().left+t.e;else{var o=jQuery("#canvasSection").offset().left,a=jQuery("#canvasSection").scrollLeft(),r=jQuery("#canvasSection").scrollTop(),h=t.e-o*i,c=0;h>10&&(c=h/i-h),e.y=e.y-jQuery("#canvasSection").offset().top*i+(r*i-r)+t.f,e.x=e.x-o*i+c+(a*i-a)+t.e}"northwest"===this.orientation?(e.x-=13,e.y-=13):(e.x+=t.a*this.bounds.width()+3,e.y+=t.d*this.bounds.height()+3),this.position=e,this.node.style.left=this.position.x+"px",this.node.style.top=this.position.y+"px"}}}),ORYX.Core.Command.Move=ORYX.Core.Command.extend({construct:function(e,t,i,n,s){this.moveShapes=e,this.selectedShapes=n,this.offset=t,this.plugin=s,this.newParents=e.collect(function(e){return i||e.parent}),this.oldParents=e.collect(function(e){return e.parent}),this.dockedNodes=e.findAll(function(e){return e instanceof ORYX.Core.Node&&1==e.dockers.length}).collect(function(e){return{docker:e.dockers[0],dockedShape:e.dockers[0].getDockedShape(),refPoint:e.dockers[0].referencePoint}})},execute:function(){this.dockAllShapes(),this.move(this.offset),this.addShapeToParent(this.newParents),this.selectCurrentShapes(),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()},rollback:function(){var e={x:-this.offset.x,y:-this.offset.y};this.move(e),this.addShapeToParent(this.oldParents),this.dockAllShapes(!0),this.selectCurrentShapes(),this.plugin.facade.getCanvas().update(),this.plugin.facade.updateSelection()},move:function(e,t){for(var i=0;i<this.moveShapes.length;i++){var n=this.moveShapes[i];if(n.bounds.moveBy(e),n instanceof ORYX.Core.Node){(n.dockers||[]).each(function(t){t.bounds.moveBy(e)});var s=[].concat(n.getIncomingShapes()).concat(n.getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge&&!this.moveShapes.any(function(t){return t==e||t instanceof ORYX.Core.Controls.Docker&&t.parent==e})}.bind(this)).findAll(function(e){return!(e.dockers.first().getDockedShape()!=n&&this.moveShapes.include(e.dockers.first().getDockedShape())||e.dockers.last().getDockedShape()!=n&&this.moveShapes.include(e.dockers.last().getDockedShape()))}.bind(this));this.plugin.layoutEdges(n,s,e);for(var o=[].concat(n.getIncomingShapes()).concat(n.getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge&&e.dockers.first().isDocked()&&e.dockers.last().isDocked()&&!this.moveShapes.include(e)&&!this.moveShapes.any(function(t){return t==e||t instanceof ORYX.Core.Controls.Docker&&t.parent==e})}.bind(this)).findAll(function(e){return this.moveShapes.indexOf(e.dockers.first().getDockedShape())>i||this.moveShapes.indexOf(e.dockers.last().getDockedShape())>i}.bind(this)),a=0;a<o.length;a++)for(var r=1;r<o[a].dockers.length-1;r++){var h=o[a].dockers[r];h.getDockedShape()||this.moveShapes.include(h)||h.bounds.moveBy(e)}}}},dockAllShapes:function(e){for(var t=0;t<this.dockedNodes.length;t++){var i=this.dockedNodes[t].docker;i.setDockedShape(e?this.dockedNodes[t].dockedShape:void 0),i.getDockedShape()&&i.setReferencePoint(this.dockedNodes[t].refPoint)}},addShapeToParent:function(e){for(var t=0;t<this.moveShapes.length;t++){var i=this.moveShapes[t];if(i instanceof ORYX.Core.Node&&i.parent!==e[t]){var n=e[t].absoluteXY(),s=i.absoluteXY(),o=s.x-n.x,a=s.y-n.y;if(e[t].add(i),i.getOutgoingShapes(function(i){i instanceof ORYX.Core.Node&&!this.moveShapes.member(i)&&e[t].add(i)}.bind(this)),i instanceof ORYX.Core.Node&&1==i.dockers.length){var r=i.bounds;o+=r.width()/2,a+=r.height()/2,i.dockers.first().bounds.centerMoveTo(o,a)}else i.bounds.moveTo(o,a)}}},selectCurrentShapes:function(){this.plugin.facade.setSelection(this.selectedShapes)}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.DragDocker=Clazz.extend({construct:function(e){this.facade=e,this.VALIDCOLOR=ORYX.CONFIG.SELECTION_VALID_COLOR,this.INVALIDCOLOR=ORYX.CONFIG.SELECTION_INVALID_COLOR,this.shapeSelection=void 0,this.docker=void 0,this.dockerParent=void 0,this.dockerSource=void 0,this.dockerTarget=void 0,this.lastUIObj=void 0,this.isStartDocker=void 0,this.isEndDocker=void 0,this.undockTreshold=10,this.initialDockerPosition=void 0,this.outerDockerNotMoved=void 0,this.isValid=!1,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DOCKERDRAG,this.handleDockerDrag.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOVER,this.handleMouseOver.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEOUT,this.handleMouseOut.bind(this))},handleMouseOut:function(e,t){!this.docker&&t instanceof ORYX.Core.Controls.Docker?t.hide():!this.docker&&t instanceof ORYX.Core.Edge&&t.dockers.each(function(e){e.hide()})},handleMouseOver:function(e,t){!this.docker&&t instanceof ORYX.Core.Controls.Docker?t.show():!this.docker&&t instanceof ORYX.Core.Edge&&t.dockers.each(function(e){e.show()})},handleDockerDrag:function(e,t){this.handleMouseDown(e.uiEvent,t)},handleMouseDown:function(e,t){if(t instanceof ORYX.Core.Controls.Docker&&t.isMovable){this.shapeSelection=this.facade.getSelection(),this.facade.setSelection(),this.docker=t,this.initialDockerPosition=this.docker.bounds.center(),this.outerDockerNotMoved=!1,this.dockerParent=t.parent,this._commandArg={docker:t,dockedShape:t.getDockedShape(),refPoint:t.referencePoint||t.bounds.center()},this.docker.show(),t.parent instanceof ORYX.Core.Edge&&(t.parent.dockers.first()==t||t.parent.dockers.last()==t)?t.parent.dockers.first()==t&&t.parent.dockers.last().getDockedShape()?this.dockerTarget=t.parent.dockers.last().getDockedShape():t.parent.dockers.last()==t&&t.parent.dockers.first().getDockedShape()&&(this.dockerSource=t.parent.dockers.first().getDockedShape()):(this.dockerSource=void 0,this.dockerTarget=void 0),this.isStartDocker=this.docker.parent.dockers.first()===this.docker,this.isEndDocker=this.docker.parent.dockers.last()===this.docker,this.facade.getCanvas().add(this.docker.parent),this.docker.parent.getLabels().each(function(e){e.hide()});var i=this.facade.eventCoordinates(e),n=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var s=navigator.userAgent;if(s.indexOf("MSIE")>=0){var o=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==o&&(n=o/100)}}1!==n&&(i.x=i.x/n,i.y=i.y/n),(this.isStartDocker||this.isEndDocker)&&this.docker.isDocked()?this.outerDockerNotMoved=!0:(this.docker.setDockedShape(void 0),this.docker.bounds.centerMoveTo(i),this.dockerParent._update());var a={movedCallback:this.dockerMoved.bind(this),upCallback:this.dockerMovedFinished.bind(this)};this.startEventPos=i,ORYX.Core.UIEnableDrag(e,t,a)}},dockerMoved:function(e){this.outerDockerNotMoved=!1;var t=void 0;if(this.docker.parent&&(this.isStartDocker||this.isEndDocker)){var i=this.facade.eventCoordinates(e),n=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var s=navigator.userAgent;if(s.indexOf("MSIE")>=0){var o=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==o&&(n=o/100)}}if(1!==n&&(i.x=i.x/n,i.y=i.y/n),this.docker.isDocked()){var a=ORYX.Core.Math.getDistancePointToPoint(i,this.initialDockerPosition);if(a<this.undockTreshold)return void(this.outerDockerNotMoved=!0);this.docker.setDockedShape(void 0),this.dockerParent._update()}var r=this.facade.getCanvas().getAbstractShapesAtPosition(i),h=r.pop();if(this.docker.parent===h&&(h=r.pop()),this.lastUIObj==h);else if(h instanceof ORYX.Core.Shape){if(this.docker.parent instanceof ORYX.Core.Edge){var c=this.getHighestParentBeforeCanvas(h);if(c instanceof ORYX.Core.Edge&&this.docker.parent===c)return this.isValid=!1,void this.dockerParent._update();this.isValid=!1;for(var d=h,l=h;!this.isValid&&d&&!(d instanceof ORYX.Core.Canvas);)h=d,this.isValid=this.facade.getRules().canConnect({sourceShape:this.dockerSource?this.dockerSource:this.isStartDocker?h:void 0,edgeShape:this.docker.parent,targetShape:this.dockerTarget?this.dockerTarget:this.isEndDocker?h:void 0}),d=d.parent;this.isValid||(h=l)}else this.isValid=this.facade.getRules().canConnect({sourceShape:h,edgeShape:this.docker.parent,targetShape:this.docker.parent});this.lastUIObj&&this.hideMagnets(this.lastUIObj),this.isValid&&this.showMagnets(h),this.showHighlight(h,this.isValid?this.VALIDCOLOR:this.INVALIDCOLOR),this.lastUIObj=h}else this.hideHighlight(),this.lastUIObj?this.hideMagnets(this.lastUIObj):null,this.lastUIObj=void 0,this.isValid=!1;this.lastUIObj&&this.isValid&&!e.shiftKey&&!e.ctrlKey&&(t=this.lastUIObj.magnets.find(function(e){return e.absoluteBounds().isIncluded(i)}),t&&this.docker.bounds.centerMoveTo(t.absoluteCenterXY()))}if(!e.shiftKey&&!e.ctrlKey&&!t){var u=ORYX.CONFIG.DOCKER_SNAP_OFFSET,g=u+1,f=u+1,p=this.docker.bounds.center();if(this.docker.parent)if(this.docker.parent.dockers.each(function(e){if(this.docker!=e){var t=e.referencePoint?e.getAbsoluteReferencePoint():e.bounds.center();g=Math.abs(g)>Math.abs(t.x-p.x)?t.x-p.x:g,f=Math.abs(f)>Math.abs(t.y-p.y)?t.y-p.y:f}}.bind(this)),Math.abs(g)<u||Math.abs(f)<u)g=Math.abs(g)<u?g:0,f=Math.abs(f)<u?f:0,this.docker.bounds.centerMoveTo(p.x+g,p.y+f);else{var O=this.docker.parent.dockers[Math.max(this.docker.parent.dockers.indexOf(this.docker)-1,0)],R=this.docker.parent.dockers[Math.min(this.docker.parent.dockers.indexOf(this.docker)+1,this.docker.parent.dockers.length-1)];if(O&&R&&O!==this.docker&&R!==this.docker){var S=O.bounds.center(),m=R.bounds.center(),v=this.docker.bounds.center();if(ORYX.Core.Math.isPointInLine(v.x,v.y,S.x,S.y,m.x,m.y,10)){var E=(Number(m.y)-Number(S.y))/(Number(m.x)-Number(S.x)),N=(S.y-S.x*E-(v.y-v.x*-Math.pow(E,-1)))/(-Math.pow(E,-1)-E),C=S.y-S.x*E+E*N;if(isNaN(N)||isNaN(C))return;this.docker.bounds.centerMoveTo(N,C)}}}}this.dockerParent._update()},dockerMovedFinished:function(e){if(this.facade.setSelection(this.shapeSelection),this.hideHighlight(),this.dockerParent.getLabels().each(function(e){e.show()}),this.lastUIObj&&(this.isStartDocker||this.isEndDocker)&&(this.isValid&&(this.docker.setDockedShape(this.lastUIObj),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED,docker:this.docker,parent:this.docker.parent,target:this.lastUIObj})),this.hideMagnets(this.lastUIObj)),this.docker.hide(),this.outerDockerNotMoved){var t=this.facade.eventCoordinates(e),i=this.facade.getCanvas().getAbstractShapesAtPosition(t),n=i.findAll(function(e){return e instanceof ORYX.Core.Node});i=n.length?n:i,this.facade.setSelection(i)}else{var s=ORYX.Core.Command.extend({construct:function(e,t,i,n,s,o){this.docker=e,this.index=e.parent.dockers.indexOf(e),this.newPosition=t,this.newDockedShape=n,this.oldPosition=i,this.oldDockedShape=s,this.facade=o,this.index=e.parent.dockers.indexOf(e),this.shape=e.parent},execute:function(){this.docker.parent||(this.docker=this.shape.dockers[this.index]),this.dock(this.newDockedShape,this.newPosition),this.removedDockers=this.shape.removeUnusedDockers(),this.facade.updateSelection()},rollback:function(){this.dock(this.oldDockedShape,this.oldPosition),(this.removedDockers||$H({})).each(function(e){this.shape.add(e.value,Number(e.key)),this.shape._update(!0)}.bind(this)),this.facade.updateSelection()},dock:function(e,t){this.docker.setDockedShape(void 0),e?(this.docker.setDockedShape(e),this.docker.setReferencePoint(t)):this.docker.bounds.centerMoveTo(t),this.facade.getCanvas().update()}});if(this.docker.parent){var o=new s(this.docker,this.docker.getDockedShape()?this.docker.referencePoint:this.docker.bounds.center(),this._commandArg.refPoint,this.docker.getDockedShape(),this._commandArg.dockedShape,this.facade);this.facade.executeCommands([o])}}this.docker=void 0,this.dockerParent=void 0,this.dockerSource=void 0,this.dockerTarget=void 0,this.lastUIObj=void 0},hideHighlight:function(){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"validDockedShape"})},showHighlight:function(e,t){this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"validDockedShape",elements:[e],color:t})},showMagnets:function(e){e.magnets.each(function(e){e.show()})},hideMagnets:function(e){e.magnets.each(function(e){e.hide()})},getHighestParentBeforeCanvas:function(e){if(e instanceof ORYX.Core.Shape){for(var t=e.parent;t&&!(t.parent instanceof ORYX.Core.Canvas);)t=t.parent;return t}}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.AddDocker=Clazz.extend({construct:function(e){this.facade=e,this.enableAdd=!1,this.enableRemove=!1,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this))},setEnableAdd:function(e){this.enableAdd=e,this.enableAdd?jQuery("#add-bendpoint-button").addClass("pressed"):(jQuery("#add-bendpoint-button").removeClass("pressed"),jQuery("#add-bendpoint-button").blur())},setEnableRemove:function(e){this.enableRemove=e,this.enableRemove?jQuery("#remove-bendpoint-button").addClass("pressed"):(jQuery("#remove-bendpoint-button").removeClass("pressed"),jQuery("#remove-bendpoint-button").blur())},enabledAdd:function(e){return this.enableAdd},enabledRemove:function(){return this.enableRemove},handleMouseDown:function(e,t){this.enabledAdd()&&t instanceof ORYX.Core.Edge?(this.newDockerCommand({edge:t,position:this.facade.eventCoordinates(e)}),this.setEnableAdd(!1)):this.enabledRemove()&&t instanceof ORYX.Core.Controls.Docker&&t.parent instanceof ORYX.Core.Edge&&(this.newDockerCommand({edge:t.parent,docker:t}),this.setEnableRemove(!1)),document.body.style.cursor="default"},newDockerCommand:function(e){if(e.edge){var t=ORYX.Core.Command.extend({construct:function(e,t,i,n,s,o){this.addEnabled=e,this.deleteEnabled=t,this.edge=i,this.docker=n,this.pos=s,this.facade=o},execute:function(){this.addEnabled?this.docker?this.edge.add(this.docker,this.index):(this.docker=this.edge.addDocker(this.pos),this.index=this.edge.dockers.indexOf(this.docker)):this.deleteEnabled&&(this.index=this.edge.dockers.indexOf(this.docker),this.pos=this.docker.bounds.center(),this.edge.removeDocker(this.docker)),this.edge.getLabels().invoke("show"),this.facade.getCanvas().update(),this.facade.updateSelection()},rollback:function(){this.addEnabled?this.docker instanceof ORYX.Core.Controls.Docker&&this.edge.removeDocker(this.docker):this.deleteEnabled&&this.edge.add(this.docker,this.index),this.edge.getLabels().invoke("show"),this.facade.getCanvas().update(),this.facade.updateSelection()}}),i=new t(this.enabledAdd(),this.enabledRemove(),e.edge,e.docker,e.position,this.facade);this.facade.executeCommands([i])}}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.SelectionFrame=Clazz.extend({construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_MOUSEDOWN,this.handleMouseDown.bind(this)),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEUP,this.handleMouseUp.bind(this),!0),this.position={x:0,y:0},this.size={width:0,height:0},this.offsetPosition={x:0,y:0},this.moveCallback=void 0,this.offsetScroll={x:0,y:0},this.node=ORYX.Editor.graft("http://www.w3.org/1999/xhtml",$("canvasSection"),["div",{"class":"Oryx_SelectionFrame"}]),this.hide()},handleMouseDown:function(e,t){if(t instanceof ORYX.Core.Canvas){var i=t.rootNode.parentNode.parentNode,n=this.facade.getCanvas().node.getScreenCTM();this.offsetPosition={x:n.e,y:n.f},this.setPos({x:Event.pointerX(e)-jQuery("#canvasSection").offset().left,y:Event.pointerY(e)-jQuery("#canvasSection").offset().top+5}),this.resize({width:0,height:0}),this.moveCallback=this.handleMouseMove.bind(this),document.documentElement.addEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1),this.offsetScroll={x:i.scrollLeft,y:i.scrollTop},this.show()}Event.stop(e)},handleMouseUp:function(e){if(this.moveCallback){this.hide(),document.documentElement.removeEventListener(ORYX.CONFIG.EVENT_MOUSEMOVE,this.moveCallback,!1),this.moveCallback=void 0;var t=this.facade.getCanvas().node.getScreenCTM(),i={x:this.size.width>0?this.position.x:this.position.x+this.size.width,y:this.size.height>0?this.position.y:this.position.y+this.size.height
},n={x:i.x+Math.abs(this.size.width),y:i.y+Math.abs(this.size.height)},s=1;if(!isNaN(screen.logicalXDPI)&&!isNaN(screen.systemXDPI)){var o=navigator.userAgent;if(o.indexOf("MSIE")>=0){var a=Math.round(screen.deviceXDPI/screen.logicalXDPI*100);100!==a&&(s=a/100)}}if(1===s)i.x=i.x-(t.e-jQuery("#canvasSection").offset().left),i.y=i.y-(t.f-jQuery("#canvasSection").offset().top),n.x=n.x-(t.e-jQuery("#canvasSection").offset().left),n.y=n.y-(t.f-jQuery("#canvasSection").offset().top);else{var r=jQuery("#canvasSection").offset().left,h=jQuery("#canvasSection").scrollLeft(),c=jQuery("#canvasSection").scrollTop(),d=i.e-r*s,l=0;d>10&&(l=d/s-d),i.x=i.x-(t.e-r*s+l+(h*s-h)),i.y=i.y-(t.f-jQuery("#canvasSection").offset().top*s+(c*s-c)),n.x=n.x-(t.e-r*s+l+(h*s-h)),n.y=n.y-(t.f-jQuery("#canvasSection").offset().top*s+(c*s-c))}i.x/=t.a,i.y/=t.d,n.x/=t.a,n.y/=t.d;var u=this.facade.getCanvas().getChildShapes(!0).findAll(function(e){var t=e.absoluteBounds(),s=t.upperLeft(),o=t.lowerRight();return s.x>i.x&&s.y>i.y&&o.x<n.x&&o.y<n.y});this.facade.setSelection(u)}},handleMouseMove:function(e){var t={width:Event.pointerX(e)-this.position.x-jQuery("#canvasSection").offset().left,height:Event.pointerY(e)-this.position.y-jQuery("#canvasSection").offset().top+5},i=this.facade.getCanvas().rootNode.parentNode.parentNode;t.width-=this.offsetScroll.x-i.scrollLeft,t.height-=this.offsetScroll.y-i.scrollTop,this.resize(t),Event.stop(e)},hide:function(){this.node.style.display="none"},show:function(){this.node.style.display=""},setPos:function(e){this.node.style.top=e.y+"px",this.node.style.left=e.x+"px",this.position=e},resize:function(e){this.setPos(this.position),this.size=Object.clone(e),e.width<0&&(this.node.style.left=this.position.x+e.width+"px",e.width=-e.width),e.height<0&&(this.node.style.top=this.position.y+e.height+"px",e.height=-e.height),this.node.style.width=e.width+"px",this.node.style.height=e.height+"px"}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.ShapeHighlighting=Clazz.extend({construct:function(e){this.parentNode=e.getCanvas().getSvgContainer(),this.node=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.parentNode,["g"]),this.highlightNodes={},e.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,this.setHighlight.bind(this)),e.registerOnEvent(ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,this.hideHighlight.bind(this))},setHighlight:function(e){if(e&&e.highlightId){var t=this.highlightNodes[e.highlightId];t||(t=ORYX.Editor.graft("http://www.w3.org/2000/svg",this.node,["path",{"stroke-width":2,fill:"none"}]),this.highlightNodes[e.highlightId]=t),e.elements&&e.elements.length>0?(this.setAttributesByStyle(t,e),this.show(t)):this.hide(t)}},hideHighlight:function(e){e&&e.highlightId&&this.highlightNodes[e.highlightId]&&this.hide(this.highlightNodes[e.highlightId])},hide:function(e){e.setAttributeNS(null,"display","none")},show:function(e){e.setAttributeNS(null,"display","")},setAttributesByStyle:function(e,t){if(t.style&&t.style==ORYX.CONFIG.SELECTION_HIGHLIGHT_STYLE_RECTANGLE){var i=t.elements[0].absoluteBounds(),n=t.strokewidth?t.strokewidth:ORYX.CONFIG.BORDER_OFFSET;e.setAttributeNS(null,"d",this.getPathRectangle(i.a,i.b,n)),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:.2),e.setAttributeNS(null,"stroke-width",n)}else if(1==t.elements.length&&t.elements[0]instanceof ORYX.Core.Edge&&"selection"!=t.highlightId){var s=this.getPathEdge(t.elements[0].dockers);s&&s.length>0&&e.setAttributeNS(null,"d",s),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:.2),e.setAttributeNS(null,"stroke-width",ORYX.CONFIG.OFFSET_EDGE_BOUNDS)}else{var s=this.getPathByElements(t.elements);s&&s.length>0&&e.setAttributeNS(null,"d",s),e.setAttributeNS(null,"stroke",t.color?t.color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR),e.setAttributeNS(null,"stroke-opacity",t.opacity?t.opacity:1),e.setAttributeNS(null,"stroke-width",t.strokewidth?t.strokewidth:2)}},getPathByElements:function(e){if(e&&!(e.length<=0)){var t=ORYX.CONFIG.SELECTED_AREA_PADDING,i="";return e.each(function(e){if(e){var n=e.absoluteBounds();n.widen(t);var s=n.upperLeft(),o=n.lowerRight();i+=this.getPath(s,o)}}.bind(this)),i}},getPath:function(e,t){return this.getPathCorners(e,t)},getPathCorners:function(e,t){var i=ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE,n="";return n=n+"M"+e.x+" "+(e.y+i)+" l0 -"+i+" l"+i+" 0 ",n=n+"M"+e.x+" "+(t.y-i)+" l0 "+i+" l"+i+" 0 ",n=n+"M"+t.x+" "+(t.y-i)+" l0 "+i+" l-"+i+" 0 ",n=n+"M"+t.x+" "+(e.y+i)+" l0 -"+i+" l-"+i+" 0 "},getPathRectangle:function(e,t,i){var n=(ORYX.CONFIG.SELECTION_HIGHLIGHT_SIZE,""),s=i/2;return n=n+"M"+(e.x+s)+" "+e.y,n=n+" L"+(e.x+s)+" "+(t.y-s),n=n+" L"+(t.x-s)+" "+(t.y-s),n=n+" L"+(t.x-s)+" "+(e.y+s),n=n+" L"+(e.x+s)+" "+(e.y+s)},getPathEdge:function(e){var t=e.length,n="M"+e[0].bounds.center().x+" "+e[0].bounds.center().y;for(i=1;i<t;i++){var s=e[i].bounds.center();n=n+" L"+s.x+" "+s.y}return n}}),ORYX.Plugins.HighlightingSelectedShapes=Clazz.extend({construct:function(e){this.facade=e,this.opacityFull=.9,this.opacityLow=.4},onSelectionChanged:function(e){e.elements&&e.elements.length>1?(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"selection",elements:e.elements.without(e.subSelection),color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:e.subSelection?this.opacityLow:this.opacityFull}),e.subSelection?this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_SHOW,highlightId:"subselection",elements:[e.subSelection],color:ORYX.CONFIG.SELECTION_HIGHLIGHT_COLOR,opacity:this.opacityFull}):this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"})):(this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"selection"}),this.facade.raiseEvent({type:ORYX.CONFIG.EVENT_HIGHLIGHT_HIDE,highlightId:"subselection"}))}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.Overlay=Clazz.extend({facade:void 0,styleNode:void 0,construct:function(e){this.facade=e,this.changes=[],this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_SHOW,this.show.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_OVERLAY_HIDE,this.hide.bind(this)),this.styleNode=document.createElement("style"),this.styleNode.setAttributeNS(null,"type","text/css"),document.getElementsByTagName("head")[0].appendChild(this.styleNode)},show:function(e){if(!(!e||!e.shapes||!e.shapes instanceof Array||!e.id||!e.id instanceof String||0==e.id.length)){e.attributes&&e.shapes.each(function(t){!t instanceof ORYX.Core.Shape||this.setAttributes(t.node,e.attributes)}.bind(this));var t=!0;try{t=e.node&&e.node instanceof SVGElement}catch(i){}e.node&&t&&(e._temps=[],e.shapes.each(function(t,i){if(!(!t instanceof ORYX.Core.Shape)){var n={};if(n.svg=e.dontCloneNode?e.node:e.node.cloneNode(!0),t.node.firstChild.appendChild(n.svg),t instanceof ORYX.Core.Edge&&!e.nodePosition&&(e.nodePosition="START"),e.nodePosition){var s=t.bounds,o=e.nodePosition.toUpperCase();t instanceof ORYX.Core.Node&&"START"==o?o="NW":t instanceof ORYX.Core.Node&&"END"==o?o="SE":t instanceof ORYX.Core.Edge&&"START"==o?s=t.getDockers().first().bounds:t instanceof ORYX.Core.Edge&&"END"==o&&(s=t.getDockers().last().bounds),n.callback=function(){var e=0,i=0;if("NW"==o);else if("N"==o)e=s.width()/2;else if("NE"==o)e=s.width();else if("E"==o)e=s.width(),i=s.height()/2;else if("SE"==o)e=s.width(),i=s.height();else if("S"==o)e=s.width()/2,i=s.height();else if("SW"==o)i=s.height();else if("W"==o)i=s.height()/2;else{if("START"!=o&&"END"!=o)return;e=s.width()/2,i=s.height()/2}t instanceof ORYX.Core.Edge&&(e+=s.upperLeft().x,i+=s.upperLeft().y),n.svg.setAttributeNS(null,"transform","translate("+e+", "+i+")")}.bind(this),n.element=t,n.callback(),s.registerCallback(n.callback)}e._temps.push(n)}}.bind(this))),this.changes[e.id]||(this.changes[e.id]=[]),this.changes[e.id].push(e)}},hide:function(e){e&&e.id&&!(!e.id instanceof String)&&0!=e.id.length&&this.changes[e.id]&&(this.changes[e.id].each(function(e){e.shapes.each(function(e,t){!e instanceof ORYX.Core.Shape||this.deleteAttributes(e.node)}.bind(this)),e._temps&&e._temps.each(function(e){e.svg&&e.svg.parentNode&&e.svg.parentNode.removeChild(e.svg),e.callback&&e.element&&e.element.bounds.unregisterCallback(e.callback)}.bind(this))}.bind(this)),this.changes[e.id]=null)},setAttributes:function(e,t){var i=this.getAllChilds(e.firstChild.firstChild),n=[];i.each(function(e){n.push($A(e.attributes).findAll(function(e){return e.nodeValue.startsWith("url(#")}))}),n=n.flatten().compact(),n=n.collect(function(e){return e.nodeValue}).uniq(),n=n.collect(function(e){return e.slice(5,e.length-1)}),n.unshift(e.id+" .me");var s,o=$H(t),a=o.toJSON().gsub(",",";").gsub('"',""),r=t.stroke?a.slice(0,a.length-1)+"; fill:"+t.stroke+";}":a;if(t.fill){var h=Object.clone(t);h.fill="black",s=$H(h).toJSON().gsub(",",";").gsub('"',"")}csstags=n.collect(function(e,t){return"#"+e+" * "+(t?r:a)+(s?" #"+e+" text * "+s:"")});var c=csstags.join(" ")+"\n";this.styleNode.appendChild(document.createTextNode(c))},deleteAttributes:function(e){var t=$A(this.styleNode.childNodes).findAll(function(t){return t.textContent.include("#"+e.id)});t.each(function(e){e.parentNode.removeChild(e)})},getAllChilds:function(e){var t=$A(e.childNodes);return $A(e.childNodes).each(function(e){t.push(this.getAllChilds(e))}.bind(this)),t.flatten()}}),ORYX.Plugins||(ORYX.Plugins=new Object),ORYX.Plugins.KeysMove=ORYX.Plugins.AbstractPlugin.extend({facade:void 0,construct:function(e){this.facade=e,this.copyElements=[],this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:65,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.selectAll.bind(this)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_LEFT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_LEFT,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_RIGHT,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_RIGHT,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_RIGHT,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_UP,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_UP,!0)}),this.facade.offer({keyCodes:[{metaKeys:[ORYX.CONFIG.META_KEY_META_CTRL],keyCode:ORYX.CONFIG.KEY_CODE_DOWN,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!1)}),this.facade.offer({keyCodes:[{keyCode:ORYX.CONFIG.KEY_CODE_DOWN,keyAction:ORYX.CONFIG.KEY_ACTION_DOWN}],functionality:this.move.bind(this,ORYX.CONFIG.KEY_CODE_DOWN,!0)})},selectAll:function(e){Event.stop(e.event),this.facade.setSelection(this.facade.getCanvas().getChildShapes(!0))},move:function(e,t,i){Event.stop(i.event);var n=t?20:5,s=this.facade.getSelection(),o=this.facade.getSelection(),a={x:0,y:0};switch(e){case ORYX.CONFIG.KEY_CODE_LEFT:a.x=-1*n;break;case ORYX.CONFIG.KEY_CODE_RIGHT:a.x=n;break;case ORYX.CONFIG.KEY_CODE_UP:a.y=-1*n;break;case ORYX.CONFIG.KEY_CODE_DOWN:a.y=n}s=s.findAll(function(e){if(e instanceof ORYX.Core.Node&&1==e.dockers.length&&s.include(e.dockers.first().getDockedShape()))return!1;var t=e.parent;do if(s.include(t))return!1;while(t=t.parent);return!0});var r=!0,h=s.all(function(e){return e instanceof ORYX.Core.Edge&&(e.isDocked()&&(r=!1),!0)});if((!h||r)&&(s=s.map(function(e){if(e instanceof ORYX.Core.Node)return e;if(e instanceof ORYX.Core.Edge){var t=e.dockers;return s.include(e.dockers.first().getDockedShape())&&(t=t.without(e.dockers.first())),s.include(e.dockers.last().getDockedShape())&&(t=t.without(e.dockers.last())),t}return null}).flatten().compact(),s.size()>0)){var c=[this.facade.getCanvas().bounds.lowerRight().x,this.facade.getCanvas().bounds.lowerRight().y,0,0];if(s.each(function(e){c[0]=Math.min(c[0],e.bounds.upperLeft().x),c[1]=Math.min(c[1],e.bounds.upperLeft().y),c[2]=Math.max(c[2],e.bounds.lowerRight().x),c[3]=Math.max(c[3],e.bounds.lowerRight().y)}),c[0]+a.x<0&&(a.x=-c[0]),c[1]+a.y<0&&(a.y=-c[1]),c[2]+a.x>this.facade.getCanvas().bounds.lowerRight().x&&(a.x=this.facade.getCanvas().bounds.lowerRight().x-c[2]),c[3]+a.y>this.facade.getCanvas().bounds.lowerRight().y&&(a.y=this.facade.getCanvas().bounds.lowerRight().y-c[3]),0!=a.x||0!=a.y){var d=[new ORYX.Core.Command.Move(s,a,null,o,this)];this.facade.executeCommands(d)}}},getUndockedCommant:function(e){var t=ORYX.Core.Command.extend({construct:function(e){this.dockers=e.collect(function(e){return e instanceof ORYX.Core.Controls.Docker?{docker:e,dockedShape:e.getDockedShape(),refPoint:e.referencePoint}:void 0}).compact()},execute:function(){this.dockers.each(function(e){e.docker.setDockedShape(void 0)})},rollback:function(){this.dockers.each(function(e){e.docker.setDockedShape(e.dockedShape),e.docker.setReferencePoint(e.refPoint)})}});return command=new t(e),command.execute(),command}}),ORYX.Plugins||(ORYX.Plugins={}),ORYX.Plugins.Layouter||(ORYX.Plugins.Layouter={}),new function(){ORYX.Plugins.Layouter.EdgeLayouter=ORYX.Plugins.AbstractLayouter.extend({layouted:["http://b3mn.org/stencilset/bpmn1.1#SequenceFlow","http://b3mn.org/stencilset/bpmn1.1#MessageFlow","http://b3mn.org/stencilset/timjpdl3#SequenceFlow","http://b3mn.org/stencilset/jbpm4#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0#MessageFlow","http://b3mn.org/stencilset/bpmn2.0#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0choreography#MessageFlow","http://b3mn.org/stencilset/bpmn2.0choreography#SequenceFlow","http://b3mn.org/stencilset/bpmn2.0conversation#ConversationLink","http://b3mn.org/stencilset/epc#ControlFlow","http://www.signavio.com/stencilsets/processmap#ProcessLink","http://www.signavio.com/stencilsets/organigram#connection"],layout:function(e){e.each(function(e){this.doLayout(e)}.bind(this))},doLayout:function(e){var t=e.getIncomingNodes()[0],i=e.getOutgoingNodes()[0];if(t&&i){var n=this.getPositions(t,i,e);n.length>0&&this.setDockers(e,n[0].a,n[0].b)}},getPositions:function(e,t,i){var n=e.absoluteBounds(),s=t.absoluteBounds(),o=n.center(),a=s.center(),r=n.midPoint(),h=s.midPoint(),c=Object.clone(i.dockers.first().referencePoint),d=Object.clone(i.dockers.last().referencePoint),l=i.dockers.first().getAbsoluteReferencePoint(),u=i.dockers.last().getAbsoluteReferencePoint();if(Math.abs(l.x-u.x)<1||Math.abs(l.y-u.y)<1)return[];var g={};g.x=o.x<a.x?(a.x-s.width()/2-(o.x+n.width()/2))/2+(o.x+n.width()/2):(o.x-n.width()/2-(a.x+s.width()/2))/2+(a.x+s.width()/2),g.y=o.y<a.y?(a.y-s.height()/2-(o.y+n.height()/2))/2+(o.y+n.height()/2):(o.y-n.height()/2-(a.y+s.height()/2))/2+(a.y+s.height()/2),n.widen(5),s.widen(20);var f=[],p=this.getOffset.bind(this);return n.isIncluded(a.x,o.y)||s.isIncluded(a.x,o.y)||f.push({a:{x:a.x+p(d,h,"x"),y:o.y+p(c,r,"y")},z:this.getWeight(e,o.x<a.x?"r":"l",t,o.y<a.y?"t":"b",i)}),n.isIncluded(o.x,a.y)||s.isIncluded(o.x,a.y)||f.push({a:{x:o.x+p(c,r,"x"),y:a.y+p(d,h,"y")},z:this.getWeight(e,o.y<a.y?"b":"t",t,o.x<a.x?"l":"r",i)}),n.isIncluded(g.x,o.y)||s.isIncluded(g.x,a.y)||f.push({a:{x:g.x,y:o.y+p(c,r,"y")},b:{x:g.x,y:a.y+p(d,h,"y")},z:this.getWeight(e,"r",t,"l",i,o.x>a.x)}),n.isIncluded(o.x,g.y)||s.isIncluded(a.x,g.y)||f.push({a:{x:o.x+p(c,r,"x"),y:g.y},b:{x:a.x+p(d,h,"x"),y:g.y},z:this.getWeight(e,"b",t,"t",i,o.y>a.y)}),f.sort(function(e,t){return e.z<t.z?1:(e.z==t.z,-1)})},getOffset:function(e,t,i){return e[i]-t[i]},getWeight:function(e,t,i,n,s,o){t=(t||"").toLowerCase(),n=(n||"").toLowerCase(),["t","r","b","l"].include(t)||(t="r"),["t","r","b","l"].include(n)||(t="l"),o&&(t="t"==t?"b":"r"==t?"l":"b"==t?"t":"r",n="t"==n?"b":"r"==n?"l":"b"==n?"t":"r");var a=this.facade.getRules().getLayoutingRules(e,s).out,r=this.facade.getRules().getLayoutingRules(i,s)["in"],h=a[t],c=r[n],d=function(e,t,i){switch(e){case"t":return Math.abs(t.x-i.x)<2&&t.y<i.y;case"r":return t.x>i.x&&Math.abs(t.y-i.y)<2;case"b":return Math.abs(t.x-i.x)<2&&t.y>i.y;case"l":return t.x<i.x&&Math.abs(t.y-i.y)<2;default:return!1}},l=e.getIncomingShapes().findAll(function(e){return e instanceof ORYX.Core.Edge}).any(function(e){return d(t,e.dockers[e.dockers.length-2].bounds.center(),e.dockers.last().bounds.center())}),u=i.getOutgoingShapes().findAll(function(e){return e instanceof ORYX.Core.Edge}).any(function(e){return d(n,e.dockers[1].bounds.center(),e.dockers.first().bounds.center())});return l||u?0:h+c},setDockers:function(e,t,i){e&&(e.dockers.each(function(t){e.removeDocker(t)}),[t,i].compact().each(function(t){var i=e.createDocker(void 0,t);i.bounds.centerMoveTo(t)}),e.dockers.each(function(e){e.update()}),e._update(!0))}})},ORYX.Plugins||(ORYX.Plugins=new Object),new function(){ORYX.Plugins.BPMN2_0={construct:function(e){this.facade=e,this.facade.registerOnEvent(ORYX.CONFIG.EVENT_DRAGDOCKER_DOCKED,this.handleDockerDocked.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_PROPWINDOW_PROP_CHANGED,this.handlePropertyChanged.bind(this)),this.facade.registerOnEvent("layout.bpmn2_0.pool",this.handleLayoutPool.bind(this)),this.facade.registerOnEvent("layout.bpmn2_0.subprocess",this.handleSubProcess.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_SHAPEREMOVED,this.handleShapeRemove.bind(this)),this.facade.registerOnEvent(ORYX.CONFIG.EVENT_LOADED,this.afterLoad.bind(this)),this.namespace=void 0},afterLoad:function(){this.facade.getCanvas().getChildNodes().each(function(e){e.getStencil().id().endsWith("Pool")&&this.handleLayoutPool({shape:e})}.bind(this))},onSelectionChanged:function(e){var t=e.elements;if(t&&1===t.length){var i=this.getNamespace(),n=t[0];if("Pool"===n.getStencil().idWithoutNs()&&0===n.getChildNodes().length){var s={type:i+"Lane",position:{x:0,y:0},namespace:n.getStencil().namespace(),parent:n};this.facade.createShape(s),this.facade.getCanvas().update(),this.facade.setSelection([n])}}if(t.any(function(e){return e instanceof ORYX.Core.Node&&e.getStencil().id().endsWith("Lane")})){var o=t.findAll(function(e){return e instanceof ORYX.Core.Node&&e.getStencil().id().endsWith("Lane")}),a=[],r=[];o.each(function(e){a.push(this.getParentPool(e))}.bind(this)),a=a.uniq().findAll(function(e){var i=this.getLanes(e,!0);return i.all(function(e){return o.include(e)})?(r=r.concat(i),!0):!(!t.include(e)||!i.any(function(e){return o.include(e)}))&&(r=r.concat(i),!0)}.bind(this)),r.length>0&&a.length>0&&(t=t.without.apply(t,r),t=t.concat(a),this.facade.setSelection(t.uniq()))}},handleShapeRemove:function(t){var i=t.shape,n=t.parent;if(i instanceof ORYX.Core.Node&&"Lane"===i.getStencil().idWithoutNs()&&this.facade.isExecutingCommands()){var s=this.getParentPool(n);if(s&&s.parent){var o=function(e){return!e.getChildNodes().any(function(e){return"Lane"===e.getStencil().idWithoutNs()})},a=o(i),r=n.getChildNodes().any(function(e){return"Lane"===e.getStencil().idWithoutNs()});if(a&&r){var h=new e(i,n,s,this);this.facade.executeCommands([h])}else if(a||this.facade.getSelection().any(function(e){return e instanceof ORYX.Core.Node&&"Lane"===e.getStencil().idWithoutNs()&&e.isParent(i)&&o(e)}))a&&!r&&n==s&&n.add(i);else{var c=ORYX.Core.Command.extend({construct:function(e,t){this.children=e.getChildNodes(!0),this.facade=t},execute:function(){this.children.each(function(e){e.bounds.moveBy(30,0)})},rollback:function(){this.children.each(function(e){e.bounds.moveBy(-30,0)})}});this.facade.executeCommands([new c(i,this.facade)])}}}},hashedSubProcesses:{},hashChildShapes:function(e){var t=e.getChildNodes();t.each(function(e){this.hashedSubProcesses[e.id]&&(this.hashedSubProcesses[e.id]=e.absoluteXY(),this.hashedSubProcesses[e.id].width=e.bounds.width(),this.hashedSubProcesses[e.id].height=e.bounds.height(),this.hashChildShapes(e))}.bind(this))},handleSubProcess:function(e){var t=e.shape;if(!this.hashedSubProcesses[t.id])return this.hashedSubProcesses[t.id]=t.absoluteXY(),this.hashedSubProcesses[t.id].width=t.bounds.width(),void(this.hashedSubProcesses[t.id].height=t.bounds.height());var i=t.absoluteXY();i.x-=this.hashedSubProcesses[t.id].x,i.y-=this.hashedSubProcesses[t.id].y;var n=this.hashedSubProcesses[t.id].width!==t.bounds.width()||this.hashedSubProcesses[t.id].height!==t.bounds.height();this.hashedSubProcesses[t.id]=t.absoluteXY(),this.hashedSubProcesses[t.id].width=t.bounds.width(),this.hashedSubProcesses[t.id].height=t.bounds.height(),this.hashChildShapes(t),this.facade.isExecutingCommands()&&!n&&this.moveChildDockers(t,i)},moveChildDockers:function(e,t){if(t.x||t.y){var i=e.getChildNodes(!0),n=i.map(function(e){return[].concat(e.getIncomingShapes()).concat(e.getOutgoingShapes())}).flatten().uniq().map(function(e){return e.dockers.length>2?e.dockers.slice(1,e.dockers.length-1):[]}).flatten(),s=e.absoluteBounds();s.moveBy(-t.x,-t.y);var o={};n.each(function(e){if(!e.isChanged){var n=Object.clone(t);if(!s.isIncluded(e.bounds.center())){var a=e.parent.dockers.indexOf(e),r=e.parent.dockers.length,h=e.parent.getSource(),c=e.parent.getTarget(),d=i.include(h)&&i.include(c);if(!d){var l=0!==a&&s.isIncluded(e.parent.dockers[a-1].bounds.center()),u=a!==r-1&&s.isIncluded(e.parent.dockers[a+1].bounds.center());if(!l&&!u)return;var g=e.parent.dockers[l?a-1:a+1];if(Math.abs(-Math.abs(g.bounds.center().x-e.bounds.center().x))<2)n.y=0;else{if(!(Math.abs(-Math.abs(g.bounds.center().y-e.bounds.center().y))<2))return;n.x=0}}}o[e.getId()]={docker:e,offset:n}}}),this.facade.executeCommands([new ORYX.Core.MoveDockersCommand(o)])}},handleDockerDocked:function(e){var t=this.getNamespace(),i=e.parent,n=e.target;if(i.getStencil().id()===t+"SequenceFlow"){var s=n.getStencil().groups().find(function(e){if("Gateways"==e)return e});s||"Expression"!=i.properties["oryx-conditiontype"]?i.setProperty("oryx-showdiamondmarker",!1):i.setProperty("oryx-showdiamondmarker",!0),this.facade.getCanvas().update()}},handlePropertyChanged:function(e){var t=this.getNamespace(),i=e.elements,n=e.key,s=e.value,o=!1;i.each(function(e){if(e.getStencil().id()===t+"SequenceFlow"&&"oryx-conditiontype"===n){if("Expression"!=s)e.setProperty("oryx-showdiamondmarker",!1);else{var i=e.getIncomingShapes();i||e.setProperty("oryx-showdiamondmarker",!0);var a=i.find(function(e){var t=e.getStencil().groups().find(function(e){if("Gateways"==e)return e});if(t)return t});a?e.setProperty("oryx-showdiamondmarker",!1):e.setProperty("oryx-showdiamondmarker",!0)}o=!0}}.bind(this)),o&&this.facade.getCanvas().update()},hashedPoolPositions:{},hashedLaneDepth:{},hashedBounds:{},hashedPositions:{},handleLayoutPool:function(e){var t=e.shape,i=this.facade.getSelection(),n=i.include(t)?t:i.first();if(n=n||t,this.currentPool=t,(n.getStencil().id().endsWith("Pool")||n.getStencil().id().endsWith("Lane"))&&(n===t||n.isParent(t)||this.hashedBounds[t.id][n.id])){this.hashedBounds[t.id]||(this.hashedBounds[t.id]={});var s=this.getLanes(t);if(!(s.length<=0)){var o=this.getLanes(t,!0),a=o.clone(),r=new Hash;if(o.each(function(e){r.set(e.id,e.bounds.upperLeft())}),1===s.length&&this.getLanes(s.first()).length<=0){var h=s.first().properties.get("oryx-name").trim().length>0;s.first().setProperty("oryx-showcaption",h);var c=s.first().node.getElementsByTagName("rect");c[0].setAttributeNS(null,"display","none")}else o.invoke("setProperty","oryx-showcaption",!0),o.each(function(e){var t=e.node.getElementsByTagName("rect");t[0].removeAttributeNS(null,"display")});for(var d=[],l=[],u=-1;++u<o.length;)this.hashedBounds[t.id][o[u].id]||l.push(o[u]);l.length>0&&(n=l.first());for(var g=$H(this.hashedBounds[t.id]).keys(),u=-1;++u<g.length;)o.any(function(e){return e.id==g[u]})||(d.push(this.hashedBounds[t.id][g[u]]),i=i.without(function(e){return e.id==g[u]}));var f,p,O,R;if(d.length>0||l.length>0)f=1===l.length&&1===this.getLanes(l[0].parent).length?this.adjustHeight(s,l[0].parent):this.updateHeight(t),p=this.adjustWidth(s,t.bounds.width()),t.update();else if(t==n){if(1===i.length&&this.isResized(t,this.hashedPoolPositions[t.id])){var S=this.hashedPoolPositions[t.id].upperLeft(),m=t.bounds.upperLeft(),v=0;if(this.shouldScale(t)){var E=this.hashedPoolPositions[t.id];v=E.height()/t.bounds.height()}this.adjustLanes(t,o,S.x-m.x,S.y-m.y,v)}f=this.adjustHeight(s,void 0,t.bounds.height()),p=this.adjustWidth(s,t.bounds.width())}else{if(1===i.length&&this.isResized(n,this.hashedBounds[t.id][n.id])){var S=this.hashedBounds[t.id][n.id].upperLeft(),m=n.absoluteXY();O=S.x-m.x,R=S.y-m.y,(O||R)&&(a=a.without(n),this.adjustLanes(t,this.getAllExcludedLanes(t,n),O,0));var N=this.getLanes(n,!0);if(N.length>0)if(this.shouldScale(n)){var E=this.hashedBounds[t.id][n.id],v=E.height()/n.bounds.height();this.adjustLanes(t,N,O,R,v)}else this.adjustLanes(t,N,O,R,0)}var C=o.map(function(e){return{shape:e,bounds:e.bounds.clone()}});f=this.adjustHeight(s,n),this.checkForChanges(o,C),p=this.adjustWidth(s,n.bounds.width()+30*this.getDepth(n,t))}if(this.setDimensions(t,p,f,O,R),this.facade.isExecutingCommands()&&(0===d.length||0!==l.length)){this.updateDockers(a,t);var b=this.hashedPositions[t.id];if(b&&b.keys().any(function(e,t){return(o[t]||{}).id!==e})){var _=ORYX.Core.Command.extend({construct:function(e,t,i,n,s){this.originPosition=Object.clone(e),this.newPosition=Object.clone(t),this.lanes=i,this.plugin=n,this.pool=s},execute:function(){this.executed||(this.executed=!0,this.lanes.each(function(e){this.newPosition[e.id]&&e.bounds.moveTo(this.newPosition[e.id])}.bind(this)),this.plugin.hashedPositions[this.pool]=Object.clone(this.newPosition))},rollback:function(){this.lanes.each(function(e){this.originPosition[e.id]&&e.bounds.moveTo(this.originPosition[e.id])}.bind(this)),this.plugin.hashedPositions[this.pool]=Object.clone(this.originPosition)}}),y=new Hash;o.each(function(e){y.set(e.id,e.bounds.upperLeft())});var I=new _(r,y,o,this,t.id);this.facade.executeCommands([I])}}this.hashedBounds[t.id]={},this.hashedPositions[t.id]=r;for(var u=-1;++u<o.length;)this.hashedBounds[t.id][o[u].id]=o[u].absoluteBounds(),this.hashChildShapes(o[u]),this.hashedLaneDepth[o[u].id]=this.getDepth(o[u],t),this.forceToUpdateLane(o[u]);this.hashedPoolPositions[t.id]=t.bounds.clone()}}},shouldScale:function(e){var t=e.getChildNodes().findAll(function(e){return e.getStencil().id().endsWith("Lane")});return t.length>1||t.any(function(e){return this.shouldScale(e)}.bind(this))},checkForChanges:function(e,t){if(this.facade.isExecutingCommands()&&t.any(function(e){return e.shape.bounds.toString()!==e.bounds.toString()})){var i=ORYX.Core.Command.extend({construct:function(e){this.oldState=e,this.newState=e.map(function(e){return{shape:e.shape,bounds:e.bounds.clone()}})},execute:function(){this.executed&&this.applyState(this.newState),this.executed=!0},rollback:function(){this.applyState(this.oldState)},applyState:function(e){e.each(function(e){e.shape.bounds.set(e.bounds.upperLeft(),e.bounds.lowerRight())})}});this.facade.executeCommands([new i(t)])}},isResized:function(e,t){if(!t||!e)return!1;var i=t;return 0!==Math.round(i.width()-e.bounds.width())||0!==Math.round(i.height()-e.bounds.height())},adjustLanes:function(e,t,i,n,s){s=s||0,t.each(function(t){t.getChildNodes().each(function(e){if(!e.getStencil().id().endsWith("Lane")){var t=s?e.bounds.center().y-e.bounds.center().y/s:-n;e.bounds.moveBy(i||0,-t),s&&e.getStencil().id().endsWith("Subprocess")&&this.moveChildDockers(e,{x:0,y:-t})}}.bind(this)),this.hashedBounds[e.id][t.id].moveBy(-(i||0),s?0:-n),s&&(t.isScaled=!0)}.bind(this))},getAllExcludedLanes:function(e,t){var i=[];return e.getChildNodes().each(function(e){t&&e===t||!e.getStencil().id().endsWith("Lane")||(i.push(e),i=i.concat(this.getAllExcludedLanes(e,t)))}.bind(this)),i},forceToUpdateLane:function(e){e.bounds.height()!==e._svgShapes[0].height&&(e.isChanged=!0,e.isResized=!0,e._update())},getDepth:function(e,t){for(var i=0;e&&e.parent&&e!==t;)e=e.parent,++i;return i},updateDepth:function(e,t,i){var n=30*(t-i);e.getChildNodes().each(function(e){e.bounds.moveBy(n,0),[].concat(children[j].getIncomingShapes()).concat(children[j].getOutgoingShapes())})},setDimensions:function(e,t,i,n,s){var o=e.getStencil().id().endsWith("Lane");e.bounds.set(o?30:e.bounds.a.x-(n||0),o?e.bounds.a.y:e.bounds.a.y-(s||0),t?e.bounds.a.x+t-(o?30:n||0):e.bounds.b.x,i?e.bounds.a.y+i-(o?0:s||0):e.bounds.b.y)},setLanePosition:function(e,t){e.bounds.moveTo(30,t)},adjustWidth:function(e,t){return(e||[]).each(function(e){this.setDimensions(e,t),this.adjustWidth(this.getLanes(e),t-30)}.bind(this)),t},adjustHeight:function(e,t,i){var n=0;if(!t&&i)for(var s=-1;++s<e.length;)n+=e[s].bounds.height();for(var s=-1,o=0;++s<e.length;){if(e[s]===t)this.adjustHeight(this.getLanes(e[s]),void 0,e[s].bounds.height()),e[s].bounds.set({x:30,y:o},{x:e[s].bounds.width()+30,y:e[s].bounds.height()+o});else if(!t&&i){var a=e[s].bounds.height()*i/n;this.adjustHeight(this.getLanes(e[s]),void 0,a),this.setDimensions(e[s],null,a),this.setLanePosition(e[s],o)}else{var a=this.adjustHeight(this.getLanes(e[s]),t,i);a||(a=e[s].bounds.height()),this.setDimensions(e[s],null,a),this.setLanePosition(e[s],o)}o+=e[s].bounds.height()}return o},updateHeight:function(e){var t=this.getLanes(e);if(0==t.length)return e.bounds.height();for(var i=0,n=-1;++n<t.length;)this.setLanePosition(t[n],i),i+=this.updateHeight(t[n]);return this.setDimensions(e,null,i),i},getOffset:function(e,t,i){var n={x:0,y:0},n=e.absoluteXY(),s=this.hashedBounds[i.id][e.id]||(t===!0?this.hashedPoolPositions[e.id]:void 0);return s?(n.x-=s.upperLeft().x,n.y-=s.upperLeft().y,n):{x:0,y:0}},getNextLane:function(e){for(;e&&!e.getStencil().id().endsWith("Lane");){if(e instanceof ORYX.Core.Canvas)return null;e=e.parent}return e},getParentPool:function(e){for(;e&&!e.getStencil().id().endsWith("Pool");){if(e instanceof ORYX.Core.Canvas)return null;e=e.parent}return e},updateDockers:function(e,t){for(var i,n=t.absoluteBounds(),s=[],o=(this.hashedPoolPositions[t.id]||n).clone(),a=-1,r=-1,h=-1,c=-1,d={};++a<e.length;)if(this.hashedBounds[t.id][e[a].id]){var l=e[a].isScaled;delete e[a].isScaled;var u=e[a].getChildNodes(),g=e[a].absoluteBounds(),f=this.hashedBounds[t.id][e[a].id]||g,p=this.getOffset(e[a],!0,t),O=0,R=this.getDepth(e[a],t);for(void 0!==this.hashedLaneDepth[e[a].id]&&this.hashedLaneDepth[e[a].id]!==R&&(O=30*(this.hashedLaneDepth[e[a].id]-R),p.x+=O),r=-1;++r<u.length;){O&&!u[r].getStencil().id().endsWith("Lane")&&(s.push({xOffset:O,shape:u[r]}),u[r].bounds.moveBy(O,0)),u[r].getStencil().id().endsWith("Subprocess")&&this.moveChildDockers(u[r],p);var S=[].concat(u[r].getIncomingShapes()).concat(u[r].getOutgoingShapes()).findAll(function(e){return e instanceof ORYX.Core.Edge});for(h=-1;++h<S.length;)if(S[h].getStencil().id().endsWith("MessageFlow"))this.layoutEdges(u[r],[S[h]],p);else for(c=-1;++c<S[h].dockers.length;)if(i=S[h].dockers[c],!i.getDockedShape()&&!i.isChanged){pos=i.bounds.center();var m=f.isIncluded(pos),v=(!o.isIncluded(pos),0==c?m:f.isIncluded(S[h].dockers[c-1].bounds.center()),c==S[h].dockers.length-1?m:f.isIncluded(S[h].dockers[c+1].bounds.center()),Object.clone(p));if(l&&m&&this.isResized(e[a],this.hashedBounds[t.id][e[a].id])){var E=pos.y-g.upperLeft().y+v.y;v.y-=E-E*(g.height()/f.height())}m&&(d[i.id]={docker:i,offset:v})}}}var N=ORYX.Core.Command.extend({construct:function(e){this.state=e},execute:function(){this.executed&&this.state.each(function(e){e.shape.bounds.moveBy(e.xOffset,0)}),this.executed=!0},rollback:function(){this.state.each(function(e){e.shape.bounds.moveBy(-e.xOffset,0)})}});this.facade.executeCommands([new ORYX.Core.MoveDockersCommand(d),new N(s)]);
},moveBy:function(e,t){return e.x+=t.x,e.y+=t.y,e},getHashedBounds:function(e){return this.currentPool&&this.hashedBounds[this.currentPool.id][e.id]?this.hashedBounds[this.currentPool.id][e.id]:e.absoluteBounds()},getLanes:function(e,t){var i=this.getNamespace(),n=e.getChildNodes(t||!1).findAll(function(e){return e.getStencil().id()===i+"Lane"});return n=n.sort(function(e,t){var i=Math.round(e.bounds.upperLeft().y),n=Math.round(t.bounds.upperLeft().y),s=Math.round(e.bounds.lowerRight().y),o=Math.round(t.bounds.lowerRight().y),a=this.getHashedBounds(e),r=this.getHashedBounds(t),h=Math.round(a.upperLeft().y),c=Math.round(r.upperLeft().y),d=Math.round(a.lowerRight().y),l=Math.round(r.lowerRight().y);if(i==n&&s==o&&(i=h,n=c,s=d,o=l),0===Math.round(e.bounds.height()-a.height())&&0===Math.round(t.bounds.height()-r.height()))return i<n?-1:i>n?1:0;var u=i<n&&s<o,g=i>n&&s>o,f=i<n&&s>=o&&d<l,p=i>=n&&s<o&&h<c,O=i>n&&s<=o&&d>l,R=i<=n&&s>o&&h>c;return u||f||p?-1:g||O||R?1:0}.bind(this))},getNamespace:function(){if(!this.namespace){var e=this.facade.getStencilSets();if(!e.keys())return;this.namespace=e.keys()[0]}return this.namespace}};var e=ORYX.Core.Command.extend({construct:function(e,t,i,n){this.facade=n.facade,this.plugin=n,this.shape=e,this.changes,this.pool=i,this.parent=t,this.shapeChildren=[],this.shape.getChildShapes().each(function(e){this.shapeChildren.push({shape:e,bounds:{a:{x:e.bounds.a.x,y:e.bounds.a.y},b:{x:e.bounds.b.x,y:e.bounds.b.y}}})}.bind(this)),this.shapeUpperLeft=this.shape.bounds.upperLeft(),this.parentHeight=this.parent.bounds.height()},getLeafLanes:function(e){var t=this.plugin.getLanes(e).map(function(e){return this.getLeafLanes(e)}.bind(this)).flatten();return t.length>0?t:[e]},findNewLane:function(){var e=(this.plugin.getLanes(this.parent),this.getLeafLanes(this.parent));this.lane=e.find(function(e){return e.bounds.upperLeft().y>=this.shapeUpperLeft.y}.bind(this))||e.last(),this.laneUpperLeft=this.lane.bounds.upperLeft()},execute:function(){if(this.changes)return void this.executeAgain();if(this.lane||this.findNewLane(),this.lane){var e=this.laneUpperLeft,t=this.shapeUpperLeft,i=this.plugin.getDepth(this.lane,this.parent)-1;this.changes=$H({}),e.y>=t.y?(this.lane.getChildShapes().each(function(e){this.changes[e.getId()]||(this.changes[e.getId()]=this.computeChanges(e,this.lane,this.lane,this.shape.bounds.height())),e.bounds.moveBy(0,this.shape.bounds.height())}.bind(this)),this.plugin.hashChildShapes(this.lane),this.shapeChildren.each(function(e){e.shape.bounds.set(e.bounds),e.shape.bounds.moveBy(t.x-30-30*i,0),this.changes[e.shape.getId()]||(this.changes[e.shape.getId()]=this.computeChanges(e.shape,this.shape,this.lane,0)),this.lane.add(e.shape)}.bind(this)),this.lane.bounds.moveBy(0,t.y-e.y)):t.y>e.y&&this.shapeChildren.each(function(e){e.shape.bounds.set(e.bounds),e.shape.bounds.moveBy(t.x-30-30*i,this.lane.bounds.height()),this.changes[e.shape.getId()]||(this.changes[e.shape.getId()]=this.computeChanges(e.shape,this.shape,this.lane,0)),this.lane.add(e.shape)}.bind(this))}var n=this.lane.bounds.height(),s=1===this.lane.length?this.parentHeight:this.lane.bounds.height()+this.shape.bounds.height();this.setHeight(s,n,this.parent,this.parentHeight,!0),this.plugin.getLanes(this.parent).each(function(e){this.changes[e.getId()]||e===this.lane||e===this.shape||(this.changes[e.getId()]=this.computeChanges(e,this.parent,this.parent,0))}.bind(this)),this.update()},setHeight:function(e,t,i,n,s){this.plugin.setDimensions(this.lane,this.lane.bounds.width(),e),this.plugin.hashedBounds[this.pool.id][this.lane.id]=this.lane.absoluteBounds(),this.plugin.adjustHeight(this.plugin.getLanes(i),this.lane),s===!0&&(this.changes[this.shape.getId()]=this.computeChanges(this.shape,i,i,0,t,e)),this.plugin.setDimensions(i,i.bounds.width(),n),i!==this.pool&&this.plugin.setDimensions(this.pool,this.pool.bounds.width(),this.pool.bounds.height()+(e-t))},update:function(){this.plugin.hashedBounds[this.pool.id].REMOVED=!0},rollback:function(){var e=this.laneUpperLeft,t=this.shapeUpperLeft;this.changes.each(function(i){var n=i.value.oldParent,s=i.value.shape,o=(i.value.parentHeight,i.value.oldHeight),a=i.value.newHeight;s.getStencil().id().endsWith("Lane")&&s.bounds.moveTo(i.value.oldPosition),o?(this.setHeight(o,a,n,n.bounds.height()+(o-a)),e.y>=t.y&&this.lane.bounds.moveBy(0,this.shape.bounds.height()-1)):(n.add(s),s.bounds.moveTo(i.value.oldPosition))}.bind(this))},executeAgain:function(){this.changes.each(function(e){var t=e.value.newParent,i=e.value.shape,n=e.value.newHeight,s=e.value.oldHeight;if(n){var o=this.laneUpperLeft.y,a=this.shapeUpperLeft.y;o>=a&&this.lane.bounds.moveBy(0,a-o),this.setHeight(n,s,t,t.bounds.height()+(n-s))}else t.add(i),i.bounds.moveTo(e.value.newPosition)}.bind(this)),this.update()},computeChanges:function(e,t,i,n,s,o){t=this.changes[e.getId()]?this.changes[e.getId()].oldParent:t;var a=this.changes[e.getId()]?this.changes[e.getId()].oldPosition:e.bounds.upperLeft(),r=e.bounds.upperLeft(),h={x:r.x,y:r.y+n},c={shape:e,parentHeight:t.bounds.height(),oldParent:t,oldPosition:a,oldHeight:s,newParent:i,newPosition:h,newHeight:o};return c}});ORYX.Plugins.BPMN2_0=ORYX.Plugins.AbstractPlugin.extend(ORYX.Plugins.BPMN2_0)};